org jhotdraw samples pert import util prefs * import org jhotdraw gui * import org jhotdraw * import org jhotdraw undo * import org jhotdraw util * import awt * import beans * import * import lang reflect * import javax swing * import javax swing border * import org jhotdraw app * import org jhotdraw app action * import org jhotdraw draw * import org jhotdraw draw action * import org jhotdraw xml * import org jhotdraw samples pert figures * pert project project { private undo redo manager undo private drawing editor editor private grid constrainer visible constrainer = new grid constrainer 10 10 private grid constrainer invisible constrainer = new grid constrainer 1 1 private preferences prefs pert project { } init { super init init components panel zoom button panel = new panel new border layout scroll pane set layout new placard scroll pane layout scroll pane set border new empty border 0 0 0 0 set editor new default drawing editor view set dom factory new pert factory undo = new undo redo manager view set drawing new default drawing view get drawing add undoable edit listener undo init actions undo add property change listener new property change listener { property change property change event evt { set has unsaved changes undo has significant edits } } resource bundle util labels = resource bundle util get bundle org jhotdraw draw labels panel placard panel = new panel new border layout javax swing button button button = tool bar button factory create zoom button view button put client property quaqua button style placard button put client property quaqua component visual margin new insets 0 0 0 0 button set font manager get font small font placard panel add button border layout button = tool bar button factory create toggle grid button view button put client property quaqua button style placard button put client property quaqua component visual margin new insets 0 0 0 0 button set font manager get font small font labels configure tool bar button button align grid small placard panel add button border layout scroll pane add placard panel scroll pane LOWER_LEFT_CORNER prefs = preferences user node for get set grid visible prefs get project grid visible set scale factor prefs get project scale factor 1d } drawing editor get editor { editor } set editor drawing editor new value { drawing editor old value = editor if old value != { old value remove view } editor = new value if new value != { new value add view } } set grid visible new value { old value = grid visible constrainer = new value ? visible constrainer invisible constrainer view set constrainer fire property change grid visible old value new value prefs put project grid visible new value } grid visible { view get constrainer == visible constrainer } get scale factor { view get scale factor } set scale factor new value { old value = get scale factor view set scale factor new value fire property change scale factor old value new value prefs put project scale factor new value } private init actions { put action undo action undo get undo action put action redo action undo get redo action } set has unsaved changes new value { super set has unsaved changes new value undo set has significant edits new value } write { output stream out = try { out = new buffered output stream new output stream nano xml lite dom output domo = new nano xml lite dom output view get dom factory domo open element pert diagram domo write view get drawing domo close element domo save out } finally { if out != try { out close } catch {} } } read { input stream = try { = new buffered input stream new input stream nano xml lite dom input domi = new nano xml lite dom input view get dom factory domi open element pert diagram drawing drawing = drawing domi read domi close element swing utilities and wait new runnable { run { view get drawing remove undoable edit listener undo view set drawing drawing view get drawing add undoable edit listener undo undo discard all edits }} } catch interrupted { internal = new internal init cause } catch invocation target { internal = new internal init cause } finally { if != try { close } catch {} } } set drawing editor drawing editor new value { if editor != { editor remove view } editor = new value if editor != { editor add view } } drawing editor get drawing editor { editor } clear { view set drawing new default drawing undo discard all edits } @ chooser create open chooser { chooser = super create open chooser add choosable filter new extension filter pert diagram xml } @ chooser create save chooser { chooser = super create save chooser add choosable filter new extension filter pert diagram xml } private init components { scroll pane = new javax swing scroll pane view = new org jhotdraw draw default drawing view set layout new awt border layout scroll pane set horizontal scroll bar policy javax swing scroll pane constants HORIZONTAL_SCROLLBAR_ALWAYS scroll pane set vertical scroll bar policy javax swing scroll pane constants VERTICAL_SCROLLBAR_ALWAYS scroll pane set viewport view view add scroll pane awt border layout } private javax swing scroll pane scroll pane private org jhotdraw draw default drawing view view } 