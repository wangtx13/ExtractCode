org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import org jhotdraw draw attribute keys * import org jhotdraw geom * chop box connector connector { chop box connector { } chop box connector figure owner { super owner } point2 find start connection figure connection { figure start figure = connection get start connector get owner point2 from if connection get point count <= 2 || connection get liner != { if connection get connector == { from = connection get point } else { rectangle2 r1 = get connector target connection get connector get owner get bounds from = new point2 r1 + r1 width/2 r1 + r1 height/2 } } else { from = connection get point 1 } chop start figure from } point2 find connection figure connection { figure figure = connection get connector get owner point2 from if connection get point count <= 2 || connection get liner != { if connection get start connector == { from = connection get start point } else { rectangle2 r1 = get connector target connection get start connector get owner get bounds from = new point2 r1 + r1 width/2 r1 + r1 height/2 } } else { from = connection get point connection get point count 2 } chop figure from } point2 chop figure target point2 from { target = get connector target target rectangle2 = target get bounds if STROKE_COLOR get target != { grow switch STROKE_PLACEMENT get target { case default grow = attribute keys get stroke total width target / 2d break case sid grow = attribute keys get stroke total width target break case sid grow = 0d break } geom grow grow grow } geom angle to point geom point to angle from } } 