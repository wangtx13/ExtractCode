org jhotdraw draw import org jhotdraw geom dimension2 import org jhotdraw geom geom import org jhotdraw util * import awt * import awt geom * import org jhotdraw xml dom input import org jhotdraw xml dom output import org jhotdraw xml dom storable bezier label locator implements locator dom storable { private relative position private angle private distance bezier label locator { } bezier label locator relative position angle distance { this relative position = relative position this angle = angle this distance = distance } point2 locate figure owner { get relative point bezier figure owner } point2 locate figure owner figure label { point2 relative point = get relative label point bezier figure owner label relative point } point2 get relative point bezier figure owner { point2 point = owner get point path float relative position 3 point2 next point = owner get point path relative position < 0 5 ? float relative position + 0 1f float relative position 0 1f 3 dir = math atan2 next point point next point point if relative position >= 0 5 { dir += math } alpha = dir + angle point2 = new point2 point + distance * math cos alpha point + distance * math sin alpha if = point } point2 get relative label point bezier figure owner figure label { point2 point = owner get point path float relative position 3 if point == { new point2 0 0 } point2 next point = owner get point path relative position < 0 5 ? float relative position + 0 1f float relative position 0 1f 3 dir = math atan2 next point point next point point if relative position >= 0 5 { dir += math } alpha = dir + angle point2 = new point2 point + distance * math cos alpha point + distance * math sin alpha if = point dimension2 label dim = label get preferred size if relative position == 0 5 >= point distance / 2 <= point + distance / 2 { if >= point { new point2 label dim width / 2 } else { new point2 label dim width / 2 label dim height } } else { if >= point { if >= point { new point2 } else { new point2 label dim height } } else { if >= point { new point2 label dim width } else { new point2 label dim width label dim height } } } } read dom input { relative position = get attribute relative position 0d angle = get attribute angle 0d distance = get attribute distance 0 } write dom output out { out add attribute relative position relative position out add attribute angle angle out add attribute distance distance } } 