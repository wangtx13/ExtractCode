org jhotdraw undo import awt event * import beans * import javax swing * import javax swing event * import javax swing undo * import util * import org jhotdraw util * undo redo manager undo manager { property change support property support = new property change support this private = private resource bundle util labels private has significant edits = private undo redo progress undoable edit DISCARD_ALL_EDITS = new undoable edit { can undo { } can redo { } } private undo action action { undo action { labels configure action this undo set enabled } action performed action event evt { try { undo } catch cannot undo { cannot undo +e stack trace } } } private redo action action { redo action { labels configure action this redo set enabled } action performed action event evt { try { redo } catch cannot redo { out cannot redo +e } } } private undo action undo action private redo action redo action resource bundle util get labels { if labels == { labels = resource bundle util get bundle org jhotdraw undo labels } labels } undo redo manager { get labels undo action = new undo action redo action = new redo action } set locale locale { labels = resource bundle util get bundle org jhotdraw undo labels } discard all edits { super discard all edits update actions set has significant edits } set has significant edits new value { old value = has significant edits has significant edits = new value fire property change has significant edits old value new value } has significant edits { has significant edits } add edit undoable edit edit { if out undo redo manager add +an edit if undo redo progress { edit die } success = super add edit edit update actions if success edit significant edit to be undone == edit { set has significant edits } success } action get undo action { undo action } action get redo action { redo action } private update actions { label if out undo manager update actions + edit to be undone + can undo= +can undo + can redo= +can redo if can undo { undo action set enabled label = get undo presentation } else { undo action set enabled label = labels get undo } undo action put value action label undo action put value action SHORT_DESCRIPTION label if can redo { redo action set enabled label = get redo presentation } else { redo action set enabled label = labels get redo } redo action put value action label redo action put value action SHORT_DESCRIPTION label } undo cannot undo { undo redo progress = try { super undo } finally { undo redo progress = update actions } } redo cannot undo { undo redo progress = try { super redo } finally { undo redo progress = update actions } } undo redo cannot undo cannot redo { undo redo progress = try { super undo redo } finally { undo redo progress = update actions } } add property change listener property change listener listener { property support add property change listener listener } add property change listener property property change listener listener { property support add property change listener property listener } remove property change listener property change listener listener { property support remove property change listener listener } remove property change listener property property change listener listener { property support remove property change listener property listener } fire property change property old value new value { property support fire property change property old value new value } fire property change property old value new value { property support fire property change property old value new value } fire property change property old value new value { property support fire property change property old value new value } } 