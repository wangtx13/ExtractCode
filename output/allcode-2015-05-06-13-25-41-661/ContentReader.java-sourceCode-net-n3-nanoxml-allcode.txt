net n3 nanoxml import reader import content reader reader { private xml reader reader private buffer private buffer index private xml entity resolver resolver content reader xml reader reader xml entity resolver resolver buffer { this reader = reader this resolver = resolver this buffer = buffer this buffer index = 0 } finalize throwable { this reader = this resolver = this buffer = super finalize } read char output buffer offset size { try { chars read = 0 buffer length = this buffer length if offset + size > output buffer length { size = output buffer length offset } while chars read < size { = char ch if this buffer index >= buffer length { = xml util read this reader ' ' ch = char 0 } else { ch = this buffer char this buffer index this buffer index++ output buffer chars read = ch chars read++ continue } if ch == '<' { this reader unread ch break } if ch == ' ' length > 1 { if char 1 == '#' { ch = xml util process char literal } else { xml util process entity this reader this resolver continue } } output buffer chars read = ch chars read++ } if chars read == 0 { chars read = 1 } chars read } catch xml parse { new get message } } close { try { buffer length = this buffer length for { = char ch if this buffer index >= buffer length { = xml util read this reader ' ' ch = char 0 } else { ch = this buffer char this buffer index this buffer index++ continue } if ch == '<' { this reader unread ch break } if ch == ' ' length > 1 { if char 1 != '#' { xml util process entity this reader this resolver } } } } catch xml parse { new get message } } } 