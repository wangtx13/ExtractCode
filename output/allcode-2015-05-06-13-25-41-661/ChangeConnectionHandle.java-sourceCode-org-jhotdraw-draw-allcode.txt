org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import util * change connection handle handle { private connector original target private figure target figure private connection figure connection private point start private liner liner change connection handle figure owner { super owner set connection connection figure owner set target figure } combinable with handle handle { } connector get target disconnect connect connector set location point2 point2 get location connector get source { if get target == get connection get start connector { get connection get connector } get connection get start connector } track start point anchor modifiers { original target = get target start = anchor liner = connection get liner connection set liner } track step point anchor point modifiers { point2 = view view to drawing figure = find connectable figure view get drawing if != get target figure { if get target figure != { get target figure set connectors visible } set target figure if get source == { if get target figure != { get target figure set connectors visible get connection } } else { if get target figure != can connect get source get owner get target figure { get target figure set connectors visible get connection } } } connector target = find connection target view get drawing if target != { = target get anchor } set location } track point anchor point modifiers { point2 = view view to drawing connector target = find connection target view get drawing if target == { target = original target } set location if target != original target { disconnect connect target } connection set liner liner get connection update connection if get target figure != { get target figure set connectors visible set target figure } } private connector find connection target point2 drawing drawing { figure target figure = find connectable figure drawing if get source == target figure != { find connector target figure get connection } else { if target figure != target figure can connect target figure != original target !target figure includes get owner can connect get source get owner target figure { find connector target figure get connection } } } can connect figure existing figure target connector find connector point2 figure connection figure prototype { find connector prototype } draw graphics2 { draw circle get target == ? color red color green color black } private figure find connectable figure point2 drawing drawing { for figure drawing get figures front to back { if ! includes get connection can connect contains { } } } set connection connection figure new connection { connection = new connection } connection figure get connection { connection } set target figure figure new target { target figure = new target } figure get target figure { target figure } rectangle basic get bounds { point center = view drawing to view get location new rectangle center get handlesize / 2 center get handlesize / 2 get handlesize get handlesize } } 