net n3 nanoxml import util hashtable import reader import reader xml entity resolver implements xml entity resolver { private hashtable entities xml entity resolver { this entities = new hashtable this entities put amp #38 this entities put #34 this entities put apos #39 this entities put lt #60 this entities put #62 } finalize throwable { this entities clear this entities = super finalize } add internal entity value { if ! this entities contains key { this entities put value } } add external entity publicid systemid { if ! this entities contains key { this entities put new { publicid systemid } } } reader get entity xml reader xml reader xml parse { = this entities get if == { } else if instanceof lang { new reader } else { = this open external entity xml reader 0 1 } } external entity { = this entities get ! instanceof lang } reader open external entity xml reader xml reader publicid systemid xml parse { parent systemid = xml reader get systemid try { xml reader open stream publicid systemid } catch { new xml parse parent systemid xml reader get line nr could not open external entity + + systemid } } } 