org jhotdraw draw action import org jhotdraw draw drawing import org jhotdraw draw DrawingEditor drawing editor import org jhotdraw draw DrawingView drawing view import org jhotdraw draw FigureSelectionEvent figure selection event import org jhotdraw draw FigureSelectionListener figure selection listener import javax swing * import beans * import javax swing undo * import org jhotdraw util * import util * AbstractSelectedAction selected action AbstractAction action { private DrawingEditor drawing editor editor ResourceBundleUtil resource bundle util labels = ResourceBundleUtil resource bundle util getLAFBundle get bundle org jhotdraw draw labels locale getDefault get default private PropertyChangeListener property change listener propertyChangeHandler property change handler = new PropertyChangeListener property change listener { propertyChange property change PropertyChangeEvent property change event evt { if evt getPropertyName get property equals enabled { updateEnabledState update enabled state } } } private EventHandler event handler implements PropertyChangeListener property change listener FigureSelectionListener figure selection listener { propertyChange property change PropertyChangeEvent property change event evt { if evt getPropertyName get property equals focusedView focused view { if evt getOldValue get old value != { DrawingView drawing view view = DrawingView drawing view evt getOldValue get old value view removeFigureSelectionListener remove figure selection listener this view removePropertyChangeListener remove property change listener propertyChangeHandler property change handler } if evt getNewValue get new value != { DrawingView drawing view view = DrawingView drawing view evt getNewValue get new value view addFigureSelectionListener add figure selection listener this view addPropertyChangeListener add property change listener propertyChangeHandler property change handler } updateEnabledState update enabled state } } selectionChanged selection changed FigureSelectionEvent figure selection event evt { updateEnabledState update enabled state } } private EventHandler event handler eventHandler event handler = new EventHandler event handler AbstractSelectedAction selected action DrawingEditor drawing editor editor { setEditor set editor editor updateEnabledState update enabled state } updateEnabledState update enabled state { if getView get view != { setEnabled set enabled getView get view isEnabled enabled getView get view getSelectionCount get selection count > 0 } else { setEnabled set enabled } } dispose { if this editor != { this editor removePropertyChangeListener remove property change listener eventHandler event handler if this editor getView get view != { this editor getView get view removeFigureSelectionListener remove figure selection listener eventHandler event handler } } this editor = } setEditor set editor DrawingEditor drawing editor editor { if this editor != { this editor removePropertyChangeListener remove property change listener eventHandler event handler if getView get view != { getView get view removeFigureSelectionListener remove figure selection listener eventHandler event handler } } this editor = editor if this editor != { this editor addPropertyChangeListener add property change listener eventHandler event handler } } DrawingEditor drawing editor getEditor get editor { editor } DrawingView drawing view getView get view { editor == ? editor getFocusedView get focused view } drawing getDrawing get drawing { getView get view == ? getView get view getDrawing get drawing } fireUndoableEditHappened fire undoable edit happened UndoableEdit undoable edit edit { getDrawing get drawing fireUndoableEditHappened fire undoable edit happened edit } } 