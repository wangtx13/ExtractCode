org jhotdraw app action import org jhotdraw util * import awt event * import javax swing * import util * import beans * import awt * import org jhotdraw app DefaultOSXApplication default application OSXTogglePaletteAction toggle palette action AbstractAction action { private window palette private DefaultOSXApplication default application app private WindowListener window listener windowHandler window handler OSXTogglePaletteAction toggle palette action DefaultOSXApplication default application app window palette label { super label this app = app windowHandler window handler = new WindowAdapter window adapter { windowClosing window closing WindowEvent window event evt { putValue put value actions SELECTED_KEY } } setPalette set palette palette putValue put value actions SELECTED_KEY } putValue put value key newValue new value { super putValue put value key newValue new value if key == actions SELECTED_KEY { if palette != { = newValue new value if { app addPalette add palette palette palette setVisible set visible } else { app removePalette remove palette palette palette setVisible set visible } } } } setPalette set palette window newValue new value { if palette != { palette removeWindowListener remove window listener windowHandler window handler } palette = newValue new value if palette != { palette addWindowListener add window listener windowHandler window handler if getValue get value actions SELECTED_KEY == TRUE { app addPalette add palette palette palette setVisible set visible } else { app removePalette remove palette palette palette setVisible set visible } } } actionPerformed action performed ActionEvent action event { if palette != { putValue put value actions SELECTED_KEY ! palette isVisible visible } } } 