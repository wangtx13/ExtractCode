org jhotdraw app action import awt * import awt event * import beans * import javax swing * import javax swing event * import org jhotdraw app application import org jhotdraw app project AbstractProjectAction project action AbstractAction action { private application app private PropertyChangeListener property change listener applicationListener application listener = new PropertyChangeListener property change listener { propertyChange property change PropertyChangeEvent property change event evt { if evt getPropertyName get property == currentProject current project { updateProject update project project evt getOldValue get old value project evt getNewValue get new value } } } private PropertyChangeListener property change listener projectListener project listener = new PropertyChangeListener property change listener { propertyChange property change PropertyChangeEvent property change event evt { if evt getPropertyName get property == enabled { updateEnabled update enabled evt getOldValue get old value evt getNewValue get new value } } } AbstractProjectAction project action application app { this app = app if app != { app addPropertyChangeListener add property change listener applicationListener application listener updateProject update project app getCurrentProject get current project } } updateProject update project project oldValue old value project newValue new value { if oldValue old value != { uninstallProjectListeners uninstall project listeners oldValue old value } if newValue new value != { installProjectListeners install project listeners newValue new value } firePropertyChange fire property change project oldValue old value newValue new value updateEnabled update enabled oldValue old value != oldValue old value isEnabled enabled newValue new value != newValue new value isEnabled enabled } installProjectListeners install project listeners project { addPropertyChangeListener add property change listener projectListener project listener } uninstallProjectListeners uninstall project listeners project { removePropertyChangeListener remove property change listener projectListener project listener } updateEnabled update enabled oldValue old value newValue new value { setEnabled set enabled super isEnabled enabled firePropertyChange fire property change projectEnabled project enabled oldValue old value newValue new value } application getApplication get application { app } project getCurrentProject get current project { app getCurrentProject get current project } @Override @ isEnabled enabled { getCurrentProject get current project != getCurrentProject get current project isEnabled enabled || super isEnabled enabled } @Override @ setEnabled set enabled newValue new value { oldValue old value = this enabled this enabled = newValue new value projIsEnabled proj enabled = getCurrentProject get current project != getCurrentProject get current project isEnabled enabled firePropertyChange fire property change enabled valueOf value of oldValue old value projIsEnabled proj enabled valueOf value of newValue new value projIsEnabled proj enabled } } 