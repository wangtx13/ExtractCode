org jhotdraw draw import awt * import awt event * import javax swing event * import util * TextTool text tool CreationTool creation tool implements ActionListener action listener { private FloatingTextField floating text field textField text field private TextHolder text holder typingTarget typing target TextTool text tool TextHolder text holder prototype { super prototype } TextTool text tool figure prototype map attributes { super prototype attributes } deactivate DrawingEditor drawing editor editor { endEdit edit super deactivate editor } mousePressed mouse pressed MouseEvent mouse event { TextHolder text holder textHolder text holder = figure pressedFigure pressed figure = getDrawing get drawing findFigureInside find figure inside getView get view viewToDrawing view to drawing new point getX get getY get if pressedFigure pressed figure instanceof TextHolder text holder { textHolder text holder = TextHolder text holder pressedFigure pressed figure getLabelFor get label for if !textHolder !text holder isEditable editable textHolder text holder = } if textHolder text holder != { beginEdit begin edit textHolder text holder } if typingTarget typing target != { endEdit edit fireToolDone fire tool done } else { super mousePressed mouse pressed textHolder text holder = TextHolder text holder getCreatedFigure get created figure beginEdit begin edit textHolder text holder } } mouseDragged mouse dragged awt event MouseEvent mouse event { } beginEdit begin edit TextHolder text holder textHolder text holder { if textField text field == { textField text field = new FloatingTextField floating text field textField text field addActionListener add action listener this } if textHolder text holder != typingTarget typing target typingTarget typing target != { endEdit edit } textField text field createOverlay create overlay getView get view textHolder text holder textField text field setBounds set bounds getFieldBounds get field bounds textHolder text holder textHolder text holder getText get text textField text field requestFocus request focus typingTarget typing target = textHolder text holder } private rectangle getFieldBounds get field bounds TextHolder text holder figure { rectangle box = getView get view drawingToView drawing to view figure getBounds get bounds insets insets = textField text field getInsets get insets new rectangle box - insets left box - insets top box width + insets left + insets right box height + insets top + insets bottom } mouseReleased mouse released MouseEvent mouse event evt { } endEdit edit { if typingTarget typing target != { if textField text field getText get text length > 0 { typingTarget typing target setText set text textField text field getText get text if createdFigure created figure != { getDrawing get drawing fireUndoableEditHappened fire undoable edit happened creationEdit creation edit createdFigure created figure = } } else { if createdFigure created figure != { getDrawing get drawing remove figure getAddedFigure get added figure } else { typingTarget typing target setText set text } } typingTarget typing target = textField text field endOverlay overlay } } actionPerformed action performed ActionEvent action event event { endEdit edit fireToolDone fire tool done } } 