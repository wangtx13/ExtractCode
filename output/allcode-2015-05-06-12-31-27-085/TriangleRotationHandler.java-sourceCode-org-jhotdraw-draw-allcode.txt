org jhotdraw draw import awt * import awt geom * import org jhotdraw draw AttributeKeys attribute keys * import org jhotdraw geom * TriangleRotationHandler triangle rotation handler AbstractHandle handle { private rectangle centerBox center box private AttributeKeys attribute keys orientation oldValue old value private AttributeKeys attribute keys orientation newValue new value TriangleRotationHandler triangle rotation handler TriangleFigure triangle figure owner { super owner } isCombinableWith combinable with handle { } private Point2D point2 getLocation get location { Rectangle2D rectangle2 = getOwner get owner getBounds get bounds Point2D point2 offset = getHandlesize get handlesize switch ORIENTATION get getOwner get owner { case NORTH default = new Point2D point2 + width / 2d + offset break case NORTH_EAST = new Point2D point2 + width - offset + offset break case EAST = new Point2D point2 + width - offset + height / 2d break case SOUTH_EAST = new Point2D point2 + width - offset + height - offset break case SOUTH = new Point2D point2 + width / 2d + height - offset break case SOUTH_WEST = new Point2D point2 + offset + height - offset break case WEST = new Point2D point2 + offset + height / 2d break case NORTH_WEST = new Point2D point2 + offset + offset break } } rectangle basicGetBounds basic get bounds { point = view drawingToView drawing to view getLocation get location rectangle = new rectangle grow getHandlesize get handlesize / 2 getHandlesize get handlesize / 2 } trackStart track start point anchor modifiersEx modifiers { oldValue old value = ORIENTATION get getOwner get owner centerBox center box = view drawingToView drawing to view getOwner get owner getBounds get bounds centerBox center box grow centerBox center box width / -3 centerBox center box height / -3 } trackStep track step point anchor point modifiersEx modifiers { rectangle leadRect rect = new rectangle switch geom outcode centerBox center box leadRect rect { case geom OUT_TOP default newValue new value = AttributeKeys attribute keys orientation NORTH break case geom OUT_TOP | geom OUT_RIGHT newValue new value = AttributeKeys attribute keys orientation NORTH_EAST break case geom OUT_RIGHT newValue new value = AttributeKeys attribute keys orientation EAST break case geom OUT_BOTTOM | geom OUT_RIGHT newValue new value = AttributeKeys attribute keys orientation SOUTH_EAST break case geom OUT_BOTTOM newValue new value = AttributeKeys attribute keys orientation SOUTH break case geom OUT_BOTTOM | geom OUT_LEFT newValue new value = AttributeKeys attribute keys orientation SOUTH_WEST break case geom OUT_LEFT newValue new value = AttributeKeys attribute keys orientation WEST break case geom OUT_TOP | geom OUT_LEFT newValue new value = AttributeKeys attribute keys orientation NORTH_WEST break } getOwner get owner willChange will change ORIENTATION basicSet basic set getOwner get owner newValue new value getOwner get owner changed updateBounds update bounds } draw Graphics2D graphics2 { drawDiamond draw diamond color yellow color black } trackEnd track point anchor point modifiersEx modifiers { if newValue new value != oldValue old value { fireUndoableEditHappened fire undoable edit happened new AttributeChangeEdit attribute change edit getOwner get owner ORIENTATION oldValue old value newValue new value } } } 