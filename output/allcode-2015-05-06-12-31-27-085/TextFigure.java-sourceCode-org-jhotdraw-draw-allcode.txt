org jhotdraw draw import org jhotdraw util * import awt * import awt font * import awt geom * import util * import * import org jhotdraw draw AttributeKeys attribute keys * import org jhotdraw geom * import org jhotdraw xml DOMInput dom input import org jhotdraw xml DOMOutput dom output TextFigure text figure AttributedFigure attributed figure implements TextHolder text holder { Point2D point2 origin = new Point2D point2 private editable = transient private TextLayout text layout textLayout text layout TextFigure text figure { this text } TextFigure text figure text { setText set text text } getText get text { getAttribute get attribute TEXT } setText set text newText new text { setAttribute set attribute TEXT newText new text } basicTransform basic transform AffineTransform affine transform tx { tx transform origin origin } basicSetBounds basic set bounds Point2D point2 anchor Point2D point2 { origin = new Point2D point2 anchor anchor } contains Point2D point2 { if getBounds get bounds contains { } if decorator != { updateDecoratorBounds update decorator bounds decorator contains } } drawStroke draw stroke awt Graphics2D graphics2 { } drawFill draw fill awt Graphics2D graphics2 { } drawText draw text awt Graphics2D graphics2 { if getText get text != || isEditable editable { TextLayout text layout layout = getTextLayout get text layout layout draw float origin float origin + layout getAscent get ascent } } invalidate { super invalidate textLayout text layout = } TextLayout text layout getTextLayout get text layout { if textLayout text layout == { text = getText get text if text == || text length == 0 { text = } FontRenderContext font render context frc = getFontRenderContext get font render context HashMap<TextAttribute hash map< text attribute object> textAttributes text attributes = new HashMap<TextAttribute hash map< text attribute object> textAttributes text attributes put TextAttribute text attribute FONT getFont get font if FONT_UNDERLINED get this { textAttributes text attributes put TextAttribute text attribute UNDERLINE TextAttribute text attribute UNDERLINE_LOW_ONE_PIXEL } textLayout text layout = new TextLayout text layout text textAttributes text attributes frc } textLayout text layout } Rectangle2D rectangle2 getBounds get bounds { TextLayout text layout layout = getTextLayout get text layout Rectangle2D rectangle2 = new Rectangle2D rectangle2 origin origin layout getAdvance get advance layout getAscent get ascent + layout getDescent get descent } Dimension2DDouble dimension2 getPreferredSize get preferred size { Rectangle2D rectangle2 = getBounds get bounds new Dimension2DDouble dimension2 width height } Rectangle2D rectangle2 getFigureDrawBounds get figure draw bounds { if getText get text == { getBounds get bounds } else { TextLayout text layout layout = getTextLayout get text layout Rectangle2D rectangle2 = new Rectangle2D rectangle2 origin origin layout getAdvance get advance layout getAscent get ascent Rectangle2D rectangle2 lBounds bounds = layout getBounds get bounds if ! lBounds bounds isEmpty empty ! isNaN lBounds bounds getX get { add new Rectangle2D rectangle2 lBounds bounds getX get +origin lBounds bounds getY get +origin y+layout getAscent get ascent lBounds bounds getWidth get width lBounds bounds getHeight get height } geom grow 2d 2d } } Collection<Handle> collection< handle> createHandles create handles detailLevel detail level { LinkedList<Handle> linked list< handle> handles = new LinkedList<Handle> linked list< handle> if detailLevel detail level == 0 { handles add new MoveHandle move handle this RelativeLocator relative locator northWest north west handles add new MoveHandle move handle this RelativeLocator relative locator northEast north east handles add new MoveHandle move handle this RelativeLocator relative locator southEast south east handles add new FontSizeHandle font size handle this } handles } validate { super validate textLayout text layout = } isEditable editable { editable } setEditable set editable { this editable = } getTextColumns get text columns { getText get text == ? 4 math max getText get text length 4 } tool getTool get tool Point2D point2 { isEditable editable contains ? new TextTool text tool this } read DOMInput dom input IOException { setBounds set bounds new Point2D point2 getAttribute get attribute 0d getAttribute get attribute 0d new Point2D point2 0 0 readAttributes read attributes } write DOMOutput dom output out IOException { Rectangle2D rectangle2 = getBounds get bounds out addAttribute add attribute out addAttribute add attribute writeAttributes write attributes out } getTabSize get tab size { 8 } TextHolder text holder getLabelFor get label for { this } Insets2DDouble insets2 getInsets get insets { new Insets2DDouble insets2 0 0 0 0 } restoreTo restore to geometry { Point2D point2 = Point2D point2 geometry origin = origin = } getRestoreData get restore data { origin clone } TextFigure text figure clone { TextFigure text figure that = TextFigure text figure super clone that origin = Point2D point2 this origin clone that textLayout text layout = that } font getFont get font { AttributeKeys attribute keys getFont get font this } color getTextColor get text color { TEXT_COLOR get this } color getFillColor get fill color { FILL_COLOR get this } setFontSize set font size float size { FONT_SIZE set this new size } float getFontSize get font size { FONT_SIZE get this floatValue float value } } 