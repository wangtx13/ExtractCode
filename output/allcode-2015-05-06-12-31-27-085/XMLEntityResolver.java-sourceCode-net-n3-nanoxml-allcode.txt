net n3 nanoxml import util hashtable import reader import StringReader reader XMLEntityResolver xml entity resolver implements IXMLEntityResolver xml entity resolver { private hashtable entities XMLEntityResolver xml entity resolver { this entities = new hashtable this entities put amp #38 this entities put #34 this entities put apos #39 this entities put lt #60 this entities put #62 } finalize throwable { this entities clear this entities = super finalize } addInternalEntity add internal entity value { if ! this entities containsKey contains key { this entities put value } } addExternalEntity add external entity publicid systemid { if ! this entities containsKey contains key { this entities put new { publicid systemid } } } reader getEntity get entity IXMLReader xml reader xmlReader xml reader XMLParseException xml parse { = this entities get if == { } else if instanceof lang { new StringReader reader } else { = this openExternalEntity open external entity xmlReader xml reader 0 1 } } isExternalEntity external entity { = this entities get ! instanceof lang } reader openExternalEntity open external entity IXMLReader xml reader xmlReader xml reader publicid systemid XMLParseException xml parse { parentSystemID parent systemid = xmlReader xml reader getSystemID get systemid try { xmlReader xml reader openStream open stream publicid systemid } catch { new XMLParseException xml parse parentSystemID parent systemid xmlReader xml reader getLineNr get line nr could not open external entity + + systemid } } } 