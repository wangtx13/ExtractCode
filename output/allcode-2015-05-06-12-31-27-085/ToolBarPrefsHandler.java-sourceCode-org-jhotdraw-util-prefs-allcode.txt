org jhotdraw util prefs import awt * import awt event * import util prefs * import javax swing * import javax swing plaf basic * import javax swing event * ToolBarPrefsHandler tool bar prefs handler implements ComponentListener component listener AncestorListener ancestor listener { private JToolBar tool bar toolbar private prefsPrefix prefs prefix private preferences prefs private firstTimeShown first time shown ToolBarPrefsHandler tool bar prefs handler JToolBar tool bar toolbar prefsPrefix prefs prefix preferences prefs { this toolbar = toolbar this prefsPrefix prefs prefix = prefsPrefix prefs prefix this prefs = prefs constraint = prefs get prefsPrefix+ prefs prefix+ constraint BorderLayout border layout NORTH orientation = constraint equals BorderLayout border layout NORTH || constraint equals BorderLayout border layout SOUTH ? JToolBar tool bar HORIZONTAL z JToolBar tool bar VERTICAL toolbar setOrientation set orientation orientation toolbar getParent get parent add constraint toolbar toolbar setVisible set visible prefs getBoolean get prefsPrefix+ prefs prefix+ visible toolbar addComponentListener add component listener this toolbar addAncestorListener add ancestor listener this } componentHidden component hidden ComponentEvent component event { prefs putBoolean put prefsPrefix+ prefs prefix+ visible } componentMoved component moved ComponentEvent component event { locationChanged location changed } private locationChanged location changed { if toolbar getUI get instanceof BasicToolBarUI basic tool bar { BasicToolBarUI basic tool bar ui = BasicToolBarUI basic tool bar toolbar getUI get floating = ui isFloating floating prefs putBoolean put prefsPrefix+ prefs prefix+ isFloating floating floating if floating { window window = SwingUtilities swing utilities getWindowAncestor get window ancestor toolbar prefs putInt put prefsPrefix+ prefs prefix+ floatingX floating window getX get prefs putInt put prefsPrefix+ prefs prefix+ floatingY floating window getY get } else if toolbar getParent get parent != { = toolbar getX get = toolbar getY get insets insets = toolbar getParent get parent getInsets get insets constraint if == insets left == insets top { constraint = toolbar getOrientation get orientation == JToolBar tool bar HORIZONTAL z ? BorderLayout border layout NORTH BorderLayout border layout WEST } else { constraint = toolbar getOrientation get orientation == JToolBar tool bar HORIZONTAL z ? BorderLayout border layout SOUTH BorderLayout border layout EAST } prefs put prefsPrefix+ prefs prefix+ constraint constraint } } else { if toolbar getParent get parent != { = toolbar getX get = toolbar getY get insets insets = toolbar getParent get parent getInsets get insets constraint if == insets left == insets top { constraint = toolbar getOrientation get orientation == JToolBar tool bar HORIZONTAL z ? BorderLayout border layout NORTH BorderLayout border layout WEST } else { constraint = toolbar getOrientation get orientation == JToolBar tool bar HORIZONTAL z ? BorderLayout border layout SOUTH BorderLayout border layout EAST } prefs put prefsPrefix+ prefs prefix+ constraint constraint } } } componentResized component resized ComponentEvent component event { locationChanged location changed } componentShown component shown ComponentEvent component event { prefs putBoolean put prefsPrefix+ prefs prefix+ visible } ancestorAdded ancestor added AncestorEvent ancestor event event { locationChanged location changed } ancestorMoved ancestor moved AncestorEvent ancestor event event { if toolbar getUI get instanceof BasicToolBarUI basic tool bar { if BasicToolBarUI basic tool bar toolbar getUI get isFloating floating { locationChanged location changed } } } ancestorRemoved ancestor removed AncestorEvent ancestor event event { if toolbar getUI get instanceof BasicToolBarUI basic tool bar { if BasicToolBarUI basic tool bar toolbar getUI get isFloating floating { locationChanged location changed } } } } 