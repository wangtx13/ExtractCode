org jhotdraw draw import org jhotdraw undo CompositeEdit composite edit import awt * import awt geom * import awt event * import util * CreationTool creation tool AbstractTool tool { private Map<AttributeKey map< attribute key object> attributes private private dimension minimalSizeTreshold minimal size treshold = new dimension 10 10 private dimension minimalSize minimal size = new dimension 40 40 private figure prototype figure createdFigure created figure CompositeEdit composite edit creationEdit creation edit CreationTool creation tool prototypeClassName prototype { this prototypeClassName prototype } CreationTool creation tool prototypeClassName prototype Map<AttributeKey map< attribute key object> attributes { this prototypeClassName prototype attributes } CreationTool creation tool prototypeClassName prototype Map<AttributeKey map< attribute key object> attributes { try { this prototype = figure forName for prototypeClassName prototype newInstance new instance } catch { InternalError internal = new InternalError internal unable to create figure from +prototypeClassName +prototype initCause init cause } this attributes = attributes this = } CreationTool creation tool figure prototype { this prototype } CreationTool creation tool figure prototype Map<AttributeKey map< attribute key object> attributes { this prototype attributes } CreationTool creation tool figure prototype Map<AttributeKey map< attribute key object> attributes { this prototype = prototype this attributes = attributes this = } figure getPrototype get prototype { prototype } activate DrawingEditor drawing editor editor { super activate editor } deactivate DrawingEditor drawing editor editor { super deactivate editor if getView get view != { getView get view setCursor set cursor cursor getDefaultCursor get default cursor } if createdFigure created figure != { if createdFigure created figure instanceof CompositeFigure composite figure { CompositeFigure composite figure createdFigure created figure layout } createdFigure created figure = } } mousePressed mouse pressed MouseEvent mouse event evt { super mousePressed mouse pressed evt getView get view clearSelection clear selection creationEdit creation edit = new CompositeEdit composite edit figur erstellen getDrawing get drawing fireUndoableEditHappened fire undoable edit happened creationEdit creation edit createdFigure created figure = createFigure create figure Point2D point2 = constrainPoint constrain point viewToDrawing view to drawing anchor anchor = evt getX get anchor = evt getY get createdFigure created figure willChange will change createdFigure created figure basicSetBounds basic set bounds createdFigure created figure changed getDrawing get drawing add createdFigure created figure } figure createFigure create figure { figure = figure prototype clone getEditor get editor applyDefaultAttributesTo apply default attributes to if attributes != { for map Entry<AttributeKey entry< attribute key object> entry attributes entrySet entry set { setAttribute set attribute entry getKey get key entry getValue get value } } } figure getCreatedFigure get created figure { createdFigure created figure } figure getAddedFigure get added figure { createdFigure created figure } mouseDragged mouse dragged MouseEvent mouse event evt { if createdFigure created figure != { Point2D point2 = constrainPoint constrain point new point evt getX get evt getY get createdFigure created figure willChange will change createdFigure created figure basicSetBounds basic set bounds constrainPoint constrain point new point anchor anchor createdFigure created figure changed } } mouseReleased mouse released MouseEvent mouse event evt { if createdFigure created figure != { Rectangle2D rectangle2 bounds = createdFigure created figure getBounds get bounds if bounds width == 0 bounds height == 0 { getDrawing get drawing remove createdFigure created figure } else { if math anchor - evt getX get < minimalSizeTreshold minimal size treshold width math anchor - evt getY get < minimalSizeTreshold minimal size treshold height { createdFigure created figure basicSetBounds basic set bounds constrainPoint constrain point new point anchor anchor constrainPoint constrain point new point anchor + math max bounds width minimalSize minimal size width anchor + math max bounds height minimalSize minimal size height } getView get view addToSelection add to selection createdFigure created figure } if createdFigure created figure instanceof CompositeFigure composite figure { CompositeFigure composite figure createdFigure created figure layout } createdFigure created figure = getDrawing get drawing fireUndoableEditHappened fire undoable edit happened creationEdit creation edit fireToolDone fire tool done } } } 