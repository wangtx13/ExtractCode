org jhotdraw undo import awt event * import beans * import javax swing * import javax swing event * import javax swing undo * import util * import org jhotdraw util * UndoRedoManager undo redo manager UndoManager undo manager { PropertyChangeSupport property change support propertySupport property support = new PropertyChangeSupport property change support this private DEBUG = private ResourceBundleUtil resource bundle util labels private hasSignificantEdits has significant edits = private undoOrRedoInProgress undo redo progress UndoableEdit undoable edit DISCARD_ALL_EDITS = new AbstractUndoableEdit undoable edit { canUndo can undo { } canRedo can redo { } } private UndoAction undo action AbstractAction action { UndoAction undo action { labels configureAction configure action this undo setEnabled set enabled } actionPerformed action performed ActionEvent action event evt { try { undo } catch CannotUndoException cannot undo { cannot undo +e printStackTrace stack trace } } } private RedoAction redo action AbstractAction action { RedoAction redo action { labels configureAction configure action this redo setEnabled set enabled } actionPerformed action performed ActionEvent action event evt { try { redo } catch CannotRedoException cannot redo { out cannot redo +e } } } private UndoAction undo action undoAction undo action private RedoAction redo action redoAction redo action ResourceBundleUtil resource bundle util getLabels get labels { if labels == { labels = ResourceBundleUtil resource bundle util getLAFBundle get bundle org jhotdraw undo labels } labels } UndoRedoManager undo redo manager { getLabels get labels undoAction undo action = new UndoAction undo action redoAction redo action = new RedoAction redo action } setLocale set locale locale { labels = ResourceBundleUtil resource bundle util getLAFBundle get bundle org jhotdraw undo labels } discardAllEdits discard all edits { super discardAllEdits discard all edits updateActions update actions setHasSignificantEdits set has significant edits } setHasSignificantEdits set has significant edits newValue new value { oldValue old value = hasSignificantEdits has significant edits hasSignificantEdits has significant edits = newValue new value firePropertyChange fire property change hasSignificantEdits has significant edits oldValue old value newValue new value } hasSignificantEdits has significant edits { hasSignificantEdits has significant edits } addEdit add edit UndoableEdit undoable edit anEdit edit { if DEBUG out UndoRedoManager undo redo manager add +anEdit +an edit if undoOrRedoInProgress undo redo progress { anEdit edit die } success = super addEdit add edit anEdit edit updateActions update actions if success anEdit edit isSignificant significant editToBeUndone edit to be undone == anEdit edit { setHasSignificantEdits set has significant edits } success } action getUndoAction get undo action { undoAction undo action } action getRedoAction get redo action { redoAction redo action } private updateActions update actions { label if DEBUG out UndoManager undo manager updateActions update actions + editToBeUndone edit to be undone + canUndo= can undo= +canUndo +can undo + canRedo= can redo= +canRedo +can redo if canUndo can undo { undoAction undo action setEnabled set enabled label = getUndoPresentationName get undo presentation } else { undoAction undo action setEnabled set enabled label = labels getString get undo } undoAction undo action putValue put value action NAME label undoAction undo action putValue put value action SHORT_DESCRIPTION label if canRedo can redo { redoAction redo action setEnabled set enabled label = getRedoPresentationName get redo presentation } else { redoAction redo action setEnabled set enabled label = labels getString get redo } redoAction redo action putValue put value action NAME label redoAction redo action putValue put value action SHORT_DESCRIPTION label } undo CannotUndoException cannot undo { undoOrRedoInProgress undo redo progress = try { super undo } finally { undoOrRedoInProgress undo redo progress = updateActions update actions } } redo CannotUndoException cannot undo { undoOrRedoInProgress undo redo progress = try { super redo } finally { undoOrRedoInProgress undo redo progress = updateActions update actions } } undoOrRedo undo redo CannotUndoException cannot undo CannotRedoException cannot redo { undoOrRedoInProgress undo redo progress = try { super undoOrRedo undo redo } finally { undoOrRedoInProgress undo redo progress = updateActions update actions } } addPropertyChangeListener add property change listener PropertyChangeListener property change listener listener { propertySupport property support addPropertyChangeListener add property change listener listener } addPropertyChangeListener add property change listener propertyName property PropertyChangeListener property change listener listener { propertySupport property support addPropertyChangeListener add property change listener propertyName property listener } removePropertyChangeListener remove property change listener PropertyChangeListener property change listener listener { propertySupport property support removePropertyChangeListener remove property change listener listener } removePropertyChangeListener remove property change listener propertyName property PropertyChangeListener property change listener listener { propertySupport property support removePropertyChangeListener remove property change listener propertyName property listener } firePropertyChange fire property change propertyName property oldValue old value newValue new value { propertySupport property support firePropertyChange fire property change propertyName property oldValue old value newValue new value } firePropertyChange fire property change propertyName property oldValue old value newValue new value { propertySupport property support firePropertyChange fire property change propertyName property oldValue old value newValue new value } firePropertyChange fire property change propertyName property oldValue old value newValue new value { propertySupport property support firePropertyChange fire property change propertyName property oldValue old value newValue new value } } 