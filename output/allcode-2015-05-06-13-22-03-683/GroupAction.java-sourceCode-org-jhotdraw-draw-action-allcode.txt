org jhotdraw draw action import org jhotdraw draw * import org jhotdraw undo * import util * import javax swing * import javax swing undo * GroupAction group action AbstractSelectedAction selected action { = selectionGroup selection group private CompositeFigure composite figure prototype GroupAction group action DrawingEditor drawing editor editor { this editor new GroupFigure group figure } GroupAction group action DrawingEditor drawing editor editor CompositeFigure composite figure prototype { super editor this prototype = prototype labels configureAction configure action this } @Override @ updateEnabledState update enabled state { if getView get view != { setEnabled set enabled canGroup can group } else { setEnabled set enabled } } canGroup can group { getView get view getSelectionCount get selection count > 1 } actionPerformed action performed awt event ActionEvent action event { if canGroup can group { DrawingView drawing view view = getView get view LinkedList<Figure> linked list< figure> ungroupedFigures ungrouped figures = new LinkedList<Figure> linked list< figure> view getSelectedFigures get selected figures CompositeFigure composite figure group = CompositeFigure composite figure prototype clone CompositeEdit composite edit edit = new CompositeEdit composite edit labels getString get selectionGroup selection group { redo CannotRedoException cannot redo { super redo groupFigures group figures view group ungroupedFigures ungrouped figures } undo CannotUndoException cannot undo { ungroupFigures ungroup figures view group super undo } addEdit add edit UndoableEdit undoable edit anEdit edit { super addEdit add edit anEdit edit } } fireUndoableEditHappened fire undoable edit happened edit groupFigures group figures view group ungroupedFigures ungrouped figures fireUndoableEditHappened fire undoable edit happened edit } } Collection<Figure> collection< figure> ungroupFigures ungroup figures DrawingView drawing view view CompositeFigure composite figure group { LinkedList<Figure> linked list< figure> figures = new LinkedList<Figure> linked list< figure> group getChildren get children view clearSelection clear selection group basicRemoveAllChildren basic remove all children view getDrawing get drawing basicAddAll basic add all figures view getDrawing get drawing remove group view addToSelection add to selection figures figures } groupFigures group figures DrawingView drawing view view CompositeFigure composite figure group Collection<Figure> collection< figure> figures { Collection<Figure> collection< figure> sorted = view getDrawing get drawing sort figures view getDrawing get drawing basicRemoveAll basic remove all figures view clearSelection clear selection view getDrawing get drawing add group group willChange will change for figure sorted { group basicAdd basic add } group changed view addToSelection add to selection group } } 