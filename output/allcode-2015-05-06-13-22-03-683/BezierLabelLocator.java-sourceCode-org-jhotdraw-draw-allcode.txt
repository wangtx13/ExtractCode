org jhotdraw draw import org jhotdraw geom Dimension2DDouble dimension2 import org jhotdraw geom geom import org jhotdraw util * import awt * import awt geom * import org jhotdraw xml DOMInput dom input import org jhotdraw xml DOMOutput dom output import org jhotdraw xml DOMStorable dom storable BezierLabelLocator bezier label locator implements locator DOMStorable dom storable { private relativePosition relative position private angle private distance BezierLabelLocator bezier label locator { } BezierLabelLocator bezier label locator relativePosition relative position angle distance { this relativePosition relative position = relativePosition relative position this angle = angle this distance = distance } Point2D point2 locate figure owner { getRelativePoint get relative point BezierFigure bezier figure owner } Point2D point2 locate figure owner figure label { Point2D point2 relativePoint relative point = getRelativeLabelPoint get relative label point BezierFigure bezier figure owner label relativePoint relative point } Point2D point2 getRelativePoint get relative point BezierFigure bezier figure owner { Point2D point2 point = owner getPointOnPath get point path float relativePosition relative position 3 Point2D point2 nextPoint next point = owner getPointOnPath get point path relativePosition relative position < 0 5 ? float relativePosition relative position + 0 1f float relativePosition relative position 0 1f 3 dir = math atan2 nextPoint next point point nextPoint next point point if relativePosition relative position >= 0 5 { dir += math PI } alpha = dir + angle Point2D point2 = new Point2D point2 point + distance * math cos alpha point + distance * math sin alpha if isNaN = point } Point2D point2 getRelativeLabelPoint get relative label point BezierFigure bezier figure owner figure label { Point2D point2 point = owner getPointOnPath get point path float relativePosition relative position 3 if point == { new Point2D point2 0 0 } Point2D point2 nextPoint next point = owner getPointOnPath get point path relativePosition relative position < 0 5 ? float relativePosition relative position + 0 1f float relativePosition relative position 0 1f 3 dir = math atan2 nextPoint next point point nextPoint next point point if relativePosition relative position >= 0 5 { dir += math PI } alpha = dir + angle Point2D point2 = new Point2D point2 point + distance * math cos alpha point + distance * math sin alpha if isNaN = point Dimension2DDouble dimension2 labelDim label dim = label getPreferredSize get preferred size if relativePosition relative position == 0 5 >= point distance / 2 <= point + distance / 2 { if >= point { new Point2D point2 labelDim label dim width / 2 } else { new Point2D point2 labelDim label dim width / 2 labelDim label dim height } } else { if >= point { if >= point { new Point2D point2 } else { new Point2D point2 labelDim label dim height } } else { if >= point { new Point2D point2 labelDim label dim width } else { new Point2D point2 labelDim label dim width labelDim label dim height } } } } read DOMInput dom input { relativePosition relative position = getAttribute get attribute relativePosition relative position 0d angle = getAttribute get attribute angle 0d distance = getAttribute get attribute distance 0 } write DOMOutput dom output out { out addAttribute add attribute relativePosition relative position relativePosition relative position out addAttribute add attribute angle angle out addAttribute add attribute distance distance } } 