org jhotdraw draw action import org jhotdraw draw * import org jhotdraw undo * import util * import javax swing * import javax swing undo * UngroupAction ungroup action AbstractSelectedAction selected action { = selectionUngroup selection ungroup private CompositeFigure composite figure prototype UngroupAction ungroup action DrawingEditor drawing editor editor { this editor new GroupFigure group figure } UngroupAction ungroup action DrawingEditor drawing editor editor CompositeFigure composite figure prototype { super editor this prototype = prototype labels configureAction configure action this } @Override @ updateEnabledState update enabled state { if getView get view != { setEnabled set enabled canUngroup can ungroup } else { setEnabled set enabled } } canUngroup can ungroup { getView get view getSelectionCount get selection count == 1 getView get view getSelectedFigures get selected figures iterator next getClass get equals prototype getClass get } actionPerformed action performed awt event ActionEvent action event { if canUngroup can ungroup { DrawingView drawing view view = getView get view CompositeFigure composite figure group = CompositeFigure composite figure getView get view getSelectedFigures get selected figures iterator next LinkedList<Figure> linked list< figure> ungroupedFigures ungrouped figures = new LinkedList<Figure> linked list< figure> CompositeEdit composite edit edit = new CompositeEdit composite edit labels getString get selectionUngroup selection ungroup { redo CannotRedoException cannot redo { super redo ungroupFigures ungroup figures view group } undo CannotUndoException cannot undo { groupFigures group figures view group ungroupedFigures ungrouped figures super undo } } fireUndoableEditHappened fire undoable edit happened edit ungroupedFigures ungrouped figures addAll add all ungroupFigures ungroup figures view group fireUndoableEditHappened fire undoable edit happened edit } } Collection<Figure> collection< figure> ungroupFigures ungroup figures DrawingView drawing view view CompositeFigure composite figure group { LinkedList<Figure> linked list< figure> figures = new LinkedList<Figure> linked list< figure> group getChildren get children view clearSelection clear selection group basicRemoveAllChildren basic remove all children view getDrawing get drawing basicAddAll basic add all figures view getDrawing get drawing remove group view addToSelection add to selection figures figures } groupFigures group figures DrawingView drawing view view CompositeFigure composite figure group Collection<Figure> collection< figure> figures { Collection<Figure> collection< figure> sorted = view getDrawing get drawing sort figures view getDrawing get drawing basicRemoveAll basic remove all figures view clearSelection clear selection view getDrawing get drawing add group group willChange will change for figure sorted { group basicAdd basic add } group changed view addToSelection add to selection group } } 