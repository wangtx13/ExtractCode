org jhotdraw app action import awt * import awt event * import javax swing * import * import org jhotdraw app * import org jhotdraw * import org jhotdraw util * import org jhotdraw gui * import org jhotdraw gui event * SaveAction save action AbstractProjectAction project action { = save private saveAs save private component oldFocusOwner old focus owner SaveAction save action application app { this app } SaveAction save action application app saveAs save { super app this saveAs save = saveAs save ResourceBundleUtil resource bundle util labels = ResourceBundleUtil resource bundle util getLAFBundle get bundle org jhotdraw app labels labels configureAction configure action this } actionPerformed action performed ActionEvent action event evt { project project = getCurrentProject get current project if project isEnabled enabled { oldFocusOwner old focus owner = SwingUtilities swing utilities getWindowAncestor get window ancestor project getComponent get component getFocusOwner get focus owner project setEnabled set enabled saveToFile save to if !saveAs !save project getFile get != { saveToFile save to project project getFile get } else { JFileChooser chooser fileChooser chooser = project getSaveChooser get save chooser JSheet sheet showSaveSheet show save sheet fileChooser chooser project getComponent get component new SheetListener sheet listener { optionSelected option selected SheetEvent sheet event evt { if evt getOption get option == JFileChooser chooser APPROVE_OPTION { if evt getFileChooser get chooser getFileFilter get filter instanceof ExtensionFileFilter extension filter { = ExtensionFileFilter extension filter evt getFileChooser get chooser getFileFilter get filter makeAcceptable make acceptable evt getFileChooser get chooser getSelectedFile get selected } else { = evt getFileChooser get chooser getSelectedFile get selected } saveToFile save to project } else { project setEnabled set enabled if oldFocusOwner old focus owner != { oldFocusOwner old focus owner requestFocus request focus } } } } } } } saveToFile save to project project { project execute new worker { construct { try { project write } catch IOException { } } finished value { fileSaved saved project value } } } fileSaved saved project project value { if value == { project setFile set project markChangesAsSaved mark changes saved multiOpenId multi open = 1 for project project getApplication get application projects { if != project getFile get != getFile get equals { multiOpenId multi open = math max multiOpenId multi open getMultipleOpenId get multiple open + 1 } } getApplication get application addRecentFile add recent project setMultipleOpenId set multiple open multiOpenId multi open } else { JSheet sheet showMessageSheet show message sheet project getComponent get component <html> +UIManager + manager getString get OptionPane option pane css + <b>Couldn't <b> couldn't save to the \ +file+ \ <p> + reason +value JOptionPane option pane ERROR_MESSAGE } project setEnabled set enabled SwingUtilities swing utilities getWindowAncestor get window ancestor project getComponent get component toFront to front if oldFocusOwner old focus owner != { oldFocusOwner old focus owner requestFocus request focus } } } 