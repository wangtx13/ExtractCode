org jhotdraw draw action import awt * import beans * import javax swing * import javax swing border * import javax swing event * import awt event * JPopupButton popup button javax swing JButton button { private JPopupMenu popup menu popupMenu popup menu private columnCount column count = 1 private action action private rectangle actionArea action area private font itemFont item font font ITEM_FONT = new font dialog font PLAIN 10 JPopupButton popup button { initComponents init components setFocusable set focusable itemFont item font = ITEM_FONT } setItemFont set item font font newValue new value { itemFont item font = newValue new value if popupMenu popup menu != { updateFont update font popupMenu popup menu } } setAction set action action action rectangle actionArea action area { this action = action this actionArea action area = actionArea action area action addPropertyChangeListener add property change listener new PropertyChangeListener property change listener { propertyChange property change PropertyChangeEvent property change event evt { if evt getPropertyName get property equals enabled { setEnabled set enabled evt getNewValue get new value booleanValue value } else { repaint } } } } getColumnCount get column count { columnCount column count } setColumnCount set column count count isVertical vertical { columnCount column count = count getPopupMenu get popup menu setLayout set layout new VerticalGridLayout vertical grid layout 0 getColumnCount get column count isVertical vertical } add action action { JMenuItem menu item item = getPopupMenu get popup menu add action if getColumnCount get column count > 1 { item setUI set new PaletteMenuItemUI palette menu item } item setFont set font itemFont item font } add JMenu menu submenu { JMenuItem menu item item = getPopupMenu get popup menu add submenu updateFont update font submenu } private updateFont update font MenuElement menu element menu { menu getComponent get component setFont set font itemFont item font for MenuElement menu element child menu getSubElements get sub elements { updateFont update font child } } add JMenuItem menu item item { getPopupMenu get popup menu add item item setFont set font itemFont item font } addSeparator add separator { getPopupMenu get popup menu addSeparator add separator } setPopupMenu set popup menu JPopupMenu popup menu popupMenu popup menu { this popupMenu popup menu = popupMenu popup menu } JPopupMenu popup menu getPopupMenu get popup menu { if popupMenu popup menu == { popupMenu popup menu = new JPopupMenu popup menu popupMenu popup menu setLayout set layout new VerticalGridLayout vertical grid layout 0 getColumnCount get column count } popupMenu popup menu } private initComponents init components { FormListener form listener formListener form listener = new FormListener form listener addMouseListener add mouse listener formListener form listener } private FormListener form listener implements awt event MouseListener mouse listener { mouseClicked mouse clicked awt event MouseEvent mouse event evt { } mouseEntered mouse entered awt event MouseEvent mouse event evt { } mouseExited mouse exited awt event MouseEvent mouse event evt { } mousePressed mouse pressed awt event MouseEvent mouse event evt { if evt getSource get source == JPopupButton popup button this { JPopupButton popup button this showPopup show popup evt } } mouseReleased mouse released awt event MouseEvent mouse event evt { if evt getSource get source == JPopupButton popup button this { JPopupButton popup button this performAction perform action evt } } } private performAction perform action awt event MouseEvent mouse event evt { if actionArea action area != actionArea action area contains evt getX get getInsets get insets left evt getY get getInsets get insets top { action actionPerformed action performed new ActionEvent action event this ActionEvent action event ACTION_PERFORMED evt getWhen get when evt getModifiers get modifiers } } private showPopup show popup awt event MouseEvent mouse event evt { if popupMenu popup menu != actionArea action area == || ! actionArea action area contains evt getX get getInsets get insets left evt getY get getInsets get insets top { = 0 = getHeight get height if getParent get parent instanceof JToolBar tool bar { JToolBar tool bar toolbar = JToolBar tool bar getParent get parent if toolbar getOrientation get orientation == JToolBar tool bar VERTICAL { = 0 if toolbar getX get > toolbar getParent get parent getInsets get insets left { = popupMenu popup menu getPreferredSize get preferred size width } else { = getWidth get width } } else { if toolbar getY get > toolbar getParent get parent getInsets get insets top { = popupMenu popup menu getPreferredSize get preferred size height } } } popupMenu popup menu show this } } } 