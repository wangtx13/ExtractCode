net n3 nanoxml import reader import IOException CDATAReader reader reader { private IXMLReader xml reader reader private char savedChar saved char private atEndOfData of data CDATAReader reader IXMLReader xml reader reader { this reader = reader this savedChar saved char = 0 this atEndOfData of data = } finalize throwable { this reader = super finalize } read char buffer offset size IOException { charsRead chars read = 0 if this atEndOfData of data { 1 } if offset + size > buffer length { size = buffer length offset } while charsRead chars read < size { char ch = this savedChar saved char if ch == 0 { ch = this reader read } else { this savedChar saved char = 0 } if ch == ' ' { char ch2 = this reader read if ch2 == ' ' { char ch3 = this reader read if ch3 == '>' { this atEndOfData of data = break } this savedChar saved char = ch2 this reader unread ch3 } else { this reader unread ch2 } } buffer charsRead chars read = ch charsRead++ chars read++ } if charsRead chars read == 0 { charsRead chars read = 1 } charsRead chars read } close IOException { while ! this atEndOfData of data { char ch = this savedChar saved char if ch == 0 { ch = this reader read } else { this savedChar saved char = 0 } if ch == ' ' { char ch2 = this reader read if ch2 == ' ' { char ch3 = this reader read if ch3 == '>' { break } this savedChar saved char = ch2 this reader unread ch3 } else { this reader unread ch2 } } } this atEndOfData of data = } } 