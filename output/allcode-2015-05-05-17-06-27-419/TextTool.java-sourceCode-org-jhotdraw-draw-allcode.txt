org jhotdraw draw import awt * import awt event * import javax swing event * import util * Text Tool Creation Tool implements Action Listener { private Floating Text Field text Field private Text Holder typing Target Text Tool Text Holder prototype { super prototype } Text Tool Figure prototype Map attributes { super prototype attributes } deactivate Drawing Editor editor { Edit super deactivate editor } mouse Pressed Mouse Event { Text Holder text Holder = Figure pressed Figure = get Drawing find Figure Inside get View view To Drawing new Point get X get Y if pressed Figure instanceof Text Holder { text Holder = Text Holder pressed Figure get Label For if !text Holder Editable text Holder = } if text Holder != { begin Edit text Holder } if typing Target != { Edit fire Tool Done } else { super mouse Pressed text Holder = Text Holder get Created Figure begin Edit text Holder } } mouse Dragged awt event Mouse Event { } begin Edit Text Holder text Holder { if text Field == { text Field = new Floating Text Field text Field add Action Listener this } if text Holder != typing Target typing Target != { Edit } text Field create Overlay get View text Holder text Field set Bounds get Field Bounds text Holder text Holder get Text text Field request Focus typing Target = text Holder } private Rectangle get Field Bounds Text Holder figure { Rectangle box = get View drawing To View figure get Bounds Insets insets = text Field get Insets new Rectangle box - insets left box - insets top box width + insets left + insets right box height + insets top + insets bottom } mouse Released Mouse Event evt { } Edit { if typing Target != { if text Field get Text length > 0 { typing Target set Text text Field get Text if created Figure != { get Drawing fire Undoable Edit Happened creation Edit created Figure = } } else { if created Figure != { get Drawing remove Figure get Added Figure } else { typing Target set Text } } typing Target = text Field Overlay } } action Performed Action Event event { Edit fire Tool Done } } 