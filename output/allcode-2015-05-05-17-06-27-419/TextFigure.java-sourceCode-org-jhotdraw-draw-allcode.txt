org jhotdraw draw import org jhotdraw util * import awt * import awt font * import awt geom * import util * import * import org jhotdraw draw Attribute Keys * import org jhotdraw geom * import org jhotdraw xml Dom Input import org jhotdraw xml Dom Output Text Figure Attributed Figure implements Text Holder { Point2 origin = new Point2 private editable = transient private Text Layout text Layout Text Figure { this Text } Text Figure String text { set Text text } String get Text { String get Attribute T E X T } set Text String new Text { set Attribute T E X T new Text } basic Transform Affine Transform tx { tx transform origin origin } basic Set Bounds Point2 anchor Point2 { origin = new Point2 anchor anchor } contains Point2 { if get Bounds contains { } if decorator != { update Decorator Bounds decorator contains } } draw Stroke awt Graphics2 { } draw Fill awt Graphics2 { } draw Text awt Graphics2 { if get Text != || Editable { Text Layout layout = get Text Layout layout draw float origin float origin + layout get Ascent } } invalidate { super invalidate text Layout = } Text Layout get Text Layout { if text Layout == { String text = get Text if text == || text length == 0 { text = } Font Render Context frc = get Font Render Context Hash Map< Text Attribute Object> text Attributes = new Hash Map< Text Attribute Object> text Attributes put Text Attribute F O N T get Font if FONT_UNDERLINED get this { text Attributes put Text Attribute U N E R L I N E Text Attribute UNDERLINE_LOW_ONE_PIXEL } text Layout = new Text Layout text text Attributes frc } text Layout } Rectangle2 get Bounds { Text Layout layout = get Text Layout Rectangle2 = new Rectangle2 origin origin layout get Advance layout get Ascent + layout get Descent } Dimension2 get Preferred Size { Rectangle2 = get Bounds new Dimension2 width height } Rectangle2 get Figure Draw Bounds { if get Text == { get Bounds } else { Text Layout layout = get Text Layout Rectangle2 = new Rectangle2 origin origin layout get Advance layout get Ascent Rectangle2 Bounds = layout get Bounds if ! Bounds Empty ! Na N Bounds get X { add new Rectangle2 Bounds get X +origin Bounds get Y +origin y+layout get Ascent Bounds get Width Bounds get Height } Geom grow 2d 2d } } Collection< Handle> create Handles detail Level { Linked List< Handle> handles = new Linked List< Handle> if detail Level == 0 { handles add new Move Handle this Relative Locator north West handles add new Move Handle this Relative Locator north East handles add new Move Handle this Relative Locator south East handles add new Font Size Handle this } handles } validate { super validate text Layout = } Editable { editable } set Editable { this editable = } get Text Columns { get Text == ? 4 Math max get Text length 4 } Tool get Tool Point2 { Editable contains ? new Text Tool this } read Dom Input I O Exception { set Bounds new Point2 get Attribute 0d get Attribute 0d new Point2 0 0 read Attributes } write Dom Output out I O Exception { Rectangle2 = get Bounds out add Attribute out add Attribute write Attributes out } get Tab Size { 8 } Text Holder get Label For { this } Insets2 get Insets { new Insets2 0 0 0 0 } restore To Object geometry { Point2 = Point2 geometry origin = origin = } Object get Restore Data { origin clone } Text Figure clone { Text Figure that = Text Figure super clone that origin = Point2 this origin clone that text Layout = that } Font get Font { Attribute Keys get Font this } Color get Text Color { TEXT_COLOR get this } Color get Fill Color { FILL_COLOR get this } set Font Size float size { FONT_SIZE set this new size } float get Font Size { FONT_SIZE get this float Value } } 