org jhotdraw app action import awt * import awt event * import javax swing * import * import org jhotdraw app * import org jhotdraw * import org jhotdraw util * import org jhotdraw gui * import org jhotdraw gui event * Save Action Abstract Project Action { String = save private save As private Component old Focus Owner Save Action Application app { this app } Save Action Application app save As { super app this save As = save As Resource Bundle Util labels = Resource Bundle Util get L A F Bundle org jhotdraw app Labels labels configure Action this } action Performed Action Event evt { Project project = get Current Project if project Enabled { old Focus Owner = Swing Utilities get Window Ancestor project get Component get Focus Owner project set Enabled File save To File if !save As project get File != { save To File project project get File } else { J File Chooser Chooser = project get Save Chooser J Sheet show Save Sheet Chooser project get Component new Sheet Listener { option Selected Sheet Event evt { if evt get Option == J File Chooser APPROVE_OPTION { File if evt get File Chooser get File Filter instanceof Extension File Filter { = Extension File Filter evt get File Chooser get File Filter make Acceptable evt get File Chooser get Selected File } else { = evt get File Chooser get Selected File } save To File project } else { project set Enabled if old Focus Owner != { old Focus Owner request Focus } } } } } } } save To File Project project File { project execute new Worker { Object construct { try { project write } catch I O Exception { } } finished Object value { Saved project value } } } Saved Project project File Object value { if value == { project set File project mark Changes As Saved multi Open Id = 1 for Project project get Application projects { if != project get File != get File equals { multi Open Id = Math max multi Open Id get Multiple Open Id + 1 } } get Application add Recent File project set Multiple Open Id multi Open Id } else { J Sheet show Message Sheet project get Component <html> + U I Manager get String Option Pane css + <b> Couldn't save to the \ +file+ \ <p> + Reason +value J Option Pane ERROR_MESSAGE } project set Enabled Swing Utilities get Window Ancestor project get Component to Front if old Focus Owner != { old Focus Owner request Focus } } } 