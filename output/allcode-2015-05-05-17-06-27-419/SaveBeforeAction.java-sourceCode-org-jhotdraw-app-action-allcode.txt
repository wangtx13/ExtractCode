org jhotdraw app action import org jhotdraw * import org jhotdraw gui * import org jhotdraw gui event * import org jhotdraw util * import awt * import awt event * import javax swing * import * import org jhotdraw app Application import org jhotdraw app Project Save Before Action Abstract Project Action { private Component old Focus Owner Save Before Action Application app { super app } action Performed Action Event evt { Project = get Current Project if Enabled { Resource Bundle Util labels = Resource Bundle Util get L A F Bundle org jhotdraw app Labels Window Ancestor = Swing Utilities get Window Ancestor get Component old Focus Owner = Ancestor == ? Ancestor get Focus Owner set Enabled if has Unsaved Changes { J Option Pane pane = new J Option Pane <html> + U I Manager get String Option Pane css + labels get String save Before Message J Option Pane WARNING_MESSAGE Object options = { labels get String save labels get String cancel labels get String dont Save } pane set Options options pane set Initial Value options 0 pane put Client Property Quaqua Option Pane destructive Option new Integer 2 J Sheet show Sheet pane get Component new Sheet Listener { option Selected Sheet Event evt { Object value = evt get Value if value == || value equals labels get String cancel { set Enabled } else if value equals labels get String dont Save { It set Enabled } else if value equals labels get String save { save Changes } } } } else { It set Enabled if old Focus Owner != { old Focus Owner request Focus } } } } save Changes Project { if get File == { J File Chooser Chooser = get Save Chooser J Sheet show Save Sheet Chooser get Component new Sheet Listener { option Selected Sheet Event evt { if evt get Option == J File Chooser APPROVE_OPTION { File if evt get File Chooser get File Filter instanceof Extension File Filter { = Extension File Filter evt get File Chooser get File Filter make Acceptable evt get File Chooser get Selected File } else { = evt get File Chooser get Selected File } save To File } else { set Enabled if old Focus Owner != { old Focus Owner request Focus } } } } } else { save To File get File } } save To File Project File { execute new Worker { Object construct { try { write } catch I O Exception { } } finished Object value { Saved value } } } Saved Project File Object value { if value == { set File mark Changes As Saved It } else { Resource Bundle Util labels = Resource Bundle Util get L A F Bundle org jhotdraw app Labels J Sheet show Message Sheet get Component <html> + U I Manager get String Option Pane css + labels get Formatted couldnt Save value J Option Pane ERROR_MESSAGE } set Enabled if old Focus Owner != { old Focus Owner request Focus } } It Project } 