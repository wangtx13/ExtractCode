org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import util * Change Connection Handle Abstract Handle { private Connector original Target private Figure target Figure private Connection Figure connection private Point start private Liner liner Change Connection Handle Figure owner { super owner set Connection Connection Figure owner set Target Figure } Combinable With Handle handle { } Connector get Target disconnect connect Connector set Location Point2 Point2 get Location Connector get Source { if get Target == get Connection get Start Connector { get Connection get End Connector } get Connection get Start Connector } track Start Point anchor modifiers Ex { original Target = get Target start = anchor liner = connection get Liner connection set Liner } track Step Point anchor Point modifiers Ex { Point2 = view view To Drawing Figure = find Connectable Figure view get Drawing if != get Target Figure { if get Target Figure != { get Target Figure set Connectors Visible } set Target Figure if get Source == { if get Target Figure != { get Target Figure set Connectors Visible get Connection } } else { if get Target Figure != can Connect get Source get Owner get Target Figure { get Target Figure set Connectors Visible get Connection } } } Connector target = find Connection Target view get Drawing if target != { = target get Anchor } set Location } track End Point anchor Point modifiers Ex { Point2 = view view To Drawing Connector target = find Connection Target view get Drawing if target == { target = original Target } set Location if target != original Target { disconnect connect target } connection set Liner liner get Connection update Connection if get Target Figure != { get Target Figure set Connectors Visible set Target Figure } } private Connector find Connection Target Point2 Drawing drawing { Figure target Figure = find Connectable Figure drawing if get Source == target Figure != { find Connector target Figure get Connection } else { if target Figure != target Figure can Connect target Figure != original Target !target Figure includes get Owner can Connect get Source get Owner target Figure { find Connector target Figure get Connection } } } can Connect Figure existing End Figure target End Connector find Connector Point2 Figure Connection Figure prototype { find Connector prototype } draw Graphics2 { draw Circle get Target == ? Color red Color green Color black } private Figure find Connectable Figure Point2 Drawing drawing { for Figure drawing get Figures Front To Back { if ! includes get Connection can Connect contains { } } } set Connection Connection Figure new Connection { connection = new Connection } Connection Figure get Connection { connection } set Target Figure Figure new Target { target Figure = new Target } Figure get Target Figure { target Figure } Rectangle basic Get Bounds { Point center = view drawing To View get Location new Rectangle center - get Handlesize / 2 center - get Handlesize / 2 get Handlesize get Handlesize } } 