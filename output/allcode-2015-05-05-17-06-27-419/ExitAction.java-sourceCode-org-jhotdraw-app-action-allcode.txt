org jhotdraw app action import org jhotdraw gui * import org jhotdraw gui event * import org jhotdraw util * import awt * import awt event * import util * import javax swing * import * import org jhotdraw app Application import org jhotdraw app Project Exit Action Abstract Application Action { String = exit private Component old Focus Owner private Project unsaved Project Exit Action Application app { super app Resource Bundle Util labels = Resource Bundle Util get L A F Bundle org jhotdraw app Labels labels configure Action this } action Performed Action Event evt { Application app = get Application if app Enabled { app set Enabled unsaved Projects Count = 0 Project document To Be Reviewed = for Project app projects { if has Unsaved Changes { if Enabled { document To Be Reviewed = } unsaved Projects Count++ } } if unsaved Projects Count > 0 document To Be Reviewed == { app set Enabled } switch unsaved Projects Count { case 0 { Exit break } case 1 { unsaved Project = document To Be Reviewed old Focus Owner = Swing Utilities get Window Ancestor unsaved Project get Component get Focus Owner unsaved Project set Enabled J Option Pane pane = new J Option Pane <html> + U I Manager get String Option Pane css + <b> you want to save changes to this document + before exiting?</b><p> + If you don't save your changes will be lost J Option Pane WARNING_MESSAGE Object options = { Save Cancel Don't Save } pane set Options options pane set Initial Value options 0 pane put Client Property Quaqua Option Pane destructive Option new Integer 2 J Sheet show Sheet pane unsaved Project get Component new Sheet Listener { option Selected Sheet Event evt { Object value = evt get Value if value == || value equals Cancel { unsaved Project set Enabled app set Enabled } else if value equals Don't Save { Exit unsaved Project set Enabled } else if value equals Save { save Changes } } } break } default { J Option Pane pane = new J Option Pane <html> + U I Manager get Option Pane css + <b> You have +unsaved Projects Count+ documents with unsaved changes + you want to + review these changes before quitting?</b><p> + If you don't review your documents + all your changes will be lost J Option Pane QUESTION_MESSAGE Object options = { Review Changes Cancel Discard Changes } pane set Options options pane set Initial Value options 0 pane put Client Property Quaqua Option Pane destructive Option new Integer 2 J Dialog dialog = pane create Dialog app get Component dialog set Visible Object value = pane get Value if value == || value equals Cancel { app set Enabled } else if value equals Discard Changes { Exit app set Enabled } else if value equals Review Changes { unsaved Project = document To Be Reviewed review Changes } } } } } save Changes { if unsaved Project get File == { J File Chooser Chooser = unsaved Project get Save Chooser J Sheet show Save Sheet Chooser unsaved Project get Component new Sheet Listener { option Selected Sheet Event evt { if evt get Option == J File Chooser APPROVE_OPTION { File = evt get File Chooser get Selected File save To File } else { unsaved Project set Enabled if old Focus Owner != { old Focus Owner request Focus } get Application set Enabled } } } } else { save To File unsaved Project get File } } review Changes { if unsaved Project Enabled { old Focus Owner = Swing Utilities get Window Ancestor unsaved Project get Component get Focus Owner unsaved Project set Enabled J Option Pane pane = new J Option Pane <html> + U I Manager get String Option Pane css + <b> you want to save changes to this document + before exiting?</b><p> + If you don't save your changes will be lost J Option Pane WARNING_MESSAGE Object options = { Save Cancel Don't Save } pane set Options options pane set Initial Value options 0 pane put Client Property Quaqua Option Pane destructive Option new Integer 2 J Sheet show Sheet pane unsaved Project get Component new Sheet Listener { option Selected Sheet Event evt { Object value = evt get Value if value == || value equals Cancel { unsaved Project set Enabled get Application set Enabled } else if value equals Don't Save { get Application dispose unsaved Project review Next } else if value equals Save { save Changes And Review Next } } } } else { get Application set Enabled System out review silently aborted } } save Changes And Review Next { if unsaved Project get File == { J File Chooser Chooser = unsaved Project get Save Chooser J Sheet show Save Sheet Chooser unsaved Project get Component new Sheet Listener { option Selected Sheet Event evt { if evt get Option == J File Chooser APPROVE_OPTION { File = evt get File Chooser get Selected File save To File And Review Next } else { unsaved Project set Enabled if old Focus Owner != { old Focus Owner request Focus } get Application set Enabled } } } } else { save To File And Review Next unsaved Project get File } } review Next { unsaved Projects Count = 0 Project document To Be Reviewed = for Project get Application projects { if has Unsaved Changes { if Enabled { document To Be Reviewed = } unsaved Projects Count++ } } if unsaved Projects Count == 0 { Exit } else if document To Be Reviewed != { unsaved Project = document To Be Reviewed review Changes } else { get Application set Enabled } } save To File File { unsaved Project execute new Worker { Object construct { try { unsaved Project write } catch I O Exception { } } finished Object value { Saved unsaved Project value } } } save To File And Review Next File { unsaved Project execute new Worker { Object construct { try { unsaved Project write } catch I O Exception { } } finished Object value { Saved And Review Next unsaved Project value } } } Saved Project unsaved Project File Object value { if value == { unsaved Project set File Exit } else { J Sheet show Message Sheet unsaved Project get Component <html> + U I Manager get String Option Pane css + <b> Couldn't save to the \ +file+ \ <p> + Reason +value J Option Pane ERROR_MESSAGE } unsaved Project set Enabled if old Focus Owner != { old Focus Owner request Focus } get Application set Enabled } Saved And Review Next Project unsaved Project File Object value { if value == { unsaved Project set File get Application dispose unsaved Project review Next } else { J Sheet show Message Sheet unsaved Project get Component <html> + U I Manager get String Option Pane css + <b> Couldn't save to the \ +file+ \ <p> + Reason +value J Option Pane ERROR_MESSAGE } unsaved Project set Enabled if old Focus Owner != { old Focus Owner request Focus } get Application set Enabled } Exit { get Application stop System exit 0 } } 