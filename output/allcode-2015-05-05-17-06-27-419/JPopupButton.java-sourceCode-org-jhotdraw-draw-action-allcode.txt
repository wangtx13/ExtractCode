org jhotdraw draw action import awt * import beans * import javax swing * import javax swing border * import javax swing event * import awt event * J Popup Button javax swing J Button { private J Popup Menu popup Menu private column Count = 1 private Action action private Rectangle action Area private Font item Font Font ITEM_FONT = new Font Dialog Font P L A I N 10 J Popup Button { init Components set Focusable item Font = ITEM_FONT } set Item Font Font new Value { item Font = new Value if popup Menu != { update Font popup Menu } } set Action Action action Rectangle action Area { this action = action this action Area = action Area action add Property Change Listener new Property Change Listener { property Change Property Change Event evt { if evt get Property Name equals enabled { set Enabled Boolean evt get New Value Value } else { repaint } } } } get Column Count { column Count } set Column Count count Vertical { column Count = count get Popup Menu set Layout new Vertical Grid Layout 0 get Column Count Vertical } add Action action { J Menu Item item = get Popup Menu add action if get Column Count > 1 { item set U I new Palette Menu Item U I } item set Font item Font } add J Menu submenu { J Menu Item item = get Popup Menu add submenu update Font submenu } private update Font Menu Element menu { menu get Component set Font item Font for Menu Element child menu get Sub Elements { update Font child } } add J Menu Item item { get Popup Menu add item item set Font item Font } add Separator { get Popup Menu add Separator } set Popup Menu J Popup Menu popup Menu { this popup Menu = popup Menu } J Popup Menu get Popup Menu { if popup Menu == { popup Menu = new J Popup Menu popup Menu set Layout new Vertical Grid Layout 0 get Column Count } popup Menu } private init Components { Form Listener form Listener = new Form Listener add Mouse Listener form Listener } private Form Listener implements awt event Mouse Listener { mouse Clicked awt event Mouse Event evt { } mouse Entered awt event Mouse Event evt { } mouse Exited awt event Mouse Event evt { } mouse Pressed awt event Mouse Event evt { if evt get Source == J Popup Button this { J Popup Button this show Popup evt } } mouse Released awt event Mouse Event evt { if evt get Source == J Popup Button this { J Popup Button this perform Action evt } } } private perform Action awt event Mouse Event evt { if action Area != action Area contains evt get X -get Insets left evt get Y -get Insets top { action action Performed new Action Event this Action Event ACTION_PERFORMED evt get When evt get Modifiers } } private show Popup awt event Mouse Event evt { if popup Menu != action Area == || ! action Area contains evt get X -get Insets left evt get Y -get Insets top { = 0 = get Height if get Parent instanceof J Tool Bar { J Tool Bar toolbar = J Tool Bar get Parent if toolbar get Orientation == J Tool Bar V E R T I C A L { = 0 if toolbar get X > toolbar get Parent get Insets left { = -popup Menu get Preferred Size width } else { = get Width } } else { if toolbar get Y > toolbar get Parent get Insets top { = -popup Menu get Preferred Size height } } } popup Menu show this } } } 