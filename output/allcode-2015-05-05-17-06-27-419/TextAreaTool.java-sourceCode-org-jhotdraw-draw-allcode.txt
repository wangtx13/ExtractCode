org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import awt event * import javax swing event * import util * import org jhotdraw geom * Text Area Tool Creation Tool implements Action Listener { private Floating Text Area text Area private Text Holder typing Target Text Area Tool Text Holder prototype { super prototype } deactivate Drawing Editor editor { Edit super deactivate editor } mouse Pressed Mouse Event { Text Holder text Holder = Figure pressed Figure = get Drawing find Figure Inside get View view To Drawing new Point get X get Y if pressed Figure instanceof Text Holder { text Holder = Text Holder pressed Figure if !text Holder Editable text Holder = } if text Holder != { created Figure = begin Edit text Holder } if typing Target != { Edit fire Tool Done } else { super mouse Pressed } } begin Edit Text Holder text Holder { if text Area == { text Area = new Floating Text Area } if text Holder != typing Target typing Target != { Edit } text Area create Overlay get View text Holder text Area set Bounds get Field Bounds text Holder text Holder get Text text Area request Focus typing Target = text Holder } private Rectangle2 get Field Bounds Text Holder figure { Rectangle2 = figure get Bounds Insets2 insets = figure get Insets = new Rectangle2 + insets left + insets top width - insets left - insets right height - insets top - insets bottom -= 1 -= 2 width += 18 height += 4 } mouse Released Mouse Event evt { if created Figure != { Text Holder text Holder = Text Holder created Figure Rectangle2 bounds = created Figure get Bounds if bounds width == 0 bounds height == 0 { get Drawing remove created Figure } else { if bounds width < 5 bounds height < 5 { created Figure will Change created Figure basic Set Bounds new Point2 bounds bounds new Point2 bounds + 100 bounds + 100 created Figure changed } get View add To Selection created Figure } if created Figure instanceof Composite Figure { Composite Figure created Figure layout } created Figure = get Drawing fire Undoable Edit Happened creation Edit begin Edit text Holder } } Edit { if typing Target != { if text Area get Text length > 0 { typing Target set Text text Area get Text if created Figure != { get Drawing fire Undoable Edit Happened creation Edit created Figure = } } else { if created Figure != { get Drawing remove Figure get Added Figure } else { typing Target set Text } } typing Target = text Area Overlay } } action Performed Action Event event { Edit fire Tool Done } } 