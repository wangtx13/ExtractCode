org jhotdraw samples pert import util prefs * import org jhotdraw gui * import org jhotdraw * import org jhotdraw undo * import org jhotdraw util * import awt * import beans * import * import lang reflect * import javax swing * import javax swing border * import org jhotdraw app * import org jhotdraw app action * import org jhotdraw draw * import org jhotdraw draw action * import org jhotdraw xml * import org jhotdraw samples pert figures * Pert Project Abstract Project { private Undo Redo Manager undo private Drawing Editor editor private Grid Constrainer visible Constrainer = new Grid Constrainer 10 10 private Grid Constrainer invisible Constrainer = new Grid Constrainer 1 1 private Preferences prefs Pert Project { } init { super init init Components J Panel zoom Button Panel = new J Panel new Border Layout scroll Pane set Layout new Placard Scroll Pane Layout scroll Pane set Border new Empty Border 0 0 0 0 set Editor new Default Drawing Editor view set Dom Factory new Pert Factory undo = new Undo Redo Manager view set Drawing new Default Drawing view get Drawing add Undoable Edit Listener undo init Actions undo add Property Change Listener new Property Change Listener { property Change Property Change Event evt { set Has Unsaved Changes undo has Significant Edits } } Resource Bundle Util labels = Resource Bundle Util get L A F Bundle org jhotdraw draw Labels J Panel placard Panel = new J Panel new Border Layout javax swing Abstract Button Button Button = Tool Bar Button Factory create Zoom Button view Button put Client Property Quaqua Button style placard Button put Client Property Quaqua Component visual Margin new Insets 0 0 0 0 Button set Font U I Manager get Font Small System Font placard Panel add Button Border Layout W E S T Button = Tool Bar Button Factory create Toggle Grid Button view Button put Client Property Quaqua Button style placard Button put Client Property Quaqua Component visual Margin new Insets 0 0 0 0 Button set Font U I Manager get Font Small System Font labels configure Tool Bar Button Button align Grid Small placard Panel add Button Border Layout E A S T scroll Pane add placard Panel J Scroll Pane LOWER_LEFT_CORNER prefs = Preferences user Node For Package get Class set Grid Visible prefs get Boolean project grid Visible set Scale Factor prefs get project scale Factor 1d } Drawing Editor get Editor { editor } set Editor Drawing Editor new Value { Drawing Editor old Value = editor if old Value != { old Value remove view } editor = new Value if new Value != { new Value add view } } set Grid Visible new Value { old Value = Grid Visible Constrainer = new Value ? visible Constrainer invisible Constrainer view set Constrainer fire Property Change grid Visible old Value new Value prefs put Boolean project grid Visible new Value } Grid Visible { view get Constrainer == visible Constrainer } get Scale Factor { view get Scale Factor } set Scale Factor new Value { old Value = get Scale Factor view set Scale Factor new Value fire Property Change scale Factor old Value new Value prefs put project scale Factor new Value } private init Actions { put Action Undo Action undo get Undo Action put Action Redo Action undo get Redo Action } set Has Unsaved Changes new Value { super set Has Unsaved Changes new Value undo set Has Significant Edits new Value } write File I O Exception { Output Stream out = try { out = new Buffered Output Stream new File Output Stream Nano Xml Lite Dom Output domo = new Nano Xml Lite Dom Output view get Dom Factory domo open Element Pert Diagram domo write Object view get Drawing domo close Element domo save out } finally { if out != try { out close } catch I O Exception {} } } read File I O Exception { Input Stream = try { = new Buffered Input Stream new File Input Stream Nano Xml Lite Dom Input domi = new Nano Xml Lite Dom Input view get Dom Factory domi open Element Pert Diagram Drawing drawing = Drawing domi read Object domi close Element Swing Utilities invoke And Wait new Runnable { run { view get Drawing remove Undoable Edit Listener undo view set Drawing drawing view get Drawing add Undoable Edit Listener undo undo discard All Edits }} } catch Interrupted Exception { Internal Error error = new Internal Error init Cause error } catch Invocation Target Exception { Internal Error error = new Internal Error init Cause error } finally { if != try { close } catch I O Exception {} } } set Drawing Editor Drawing Editor new Value { if editor != { editor remove view } editor = new Value if editor != { editor add view } } Drawing Editor get Drawing Editor { editor } clear { view set Drawing new Default Drawing undo discard All Edits } @ Override J File Chooser create Open Chooser { J File Chooser = super create Open Chooser add Choosable File Filter new Extension File Filter Pert Diagram xml } @ Override J File Chooser create Save Chooser { J File Chooser = super create Save Chooser add Choosable File Filter new Extension File Filter Pert Diagram xml } private init Components { scroll Pane = new javax swing J Scroll Pane view = new org jhotdraw draw Default Drawing View set Layout new awt Border Layout scroll Pane set Horizontal Scroll Bar Policy javax swing Scroll Pane Constants HORIZONTAL_SCROLLBAR_ALWAYS scroll Pane set Vertical Scroll Bar Policy javax swing Scroll Pane Constants VERTICAL_SCROLLBAR_ALWAYS scroll Pane set Viewport View view add scroll Pane awt Border Layout C E N T E R } private javax swing J Scroll Pane scroll Pane private org jhotdraw draw Default Drawing View view } 