org jhotdraw draw import awt * import awt geom * import awt event * import util * Drag Tracker Abstract Tool { Figure anchor Figure Point2 old Point Point2 anchor Point private Dragging Drag Tracker Figure figure { anchor Figure = figure } mouse Moved Mouse Event evt { update Cursor editor find View Container evt get Source new Point evt get X evt get Y } mouse Pressed Mouse Event evt { super mouse Pressed evt Drawing View view = get View if evt Shift Down { view set Handle Detail Level 0 view toggle Selection anchor Figure if ! view Figure Selected anchor Figure { anchor Figure = } } else if ! view Figure Selected anchor Figure { view set Handle Detail Level 0 view clear Selection view add To Selection anchor Figure } Point2 origin = new Point2 MAX_VALUE MAX_VALUE for Figure view get Selected Figures { Rectangle2 = get Bounds origin = Math min origin origin = Math min origin } Point2 constrained Origin = view get Constrainer constrain Point new Point2 origin origin old Point = view get Constrainer constrain Point view view To Drawing new Point evt get X evt get Y old Point += origin - constrained Origin old Point += origin - constrained Origin anchor Point = old Point } mouse Dragged Mouse Event evt { Drawing View view = get View if Dragging = { Dragging = update Cursor editor find View Container evt get Source new Point evt get X evt get Y } Point2 new Point = view get Constrainer constrain Point view view To Drawing new Point evt get X evt get Y Affine Transform tx = new Affine Transform tx translate new Point - old Point new Point - old Point for Figure view get Selected Figures { will Change basic Transform tx changed } old Point = new Point } mouse Released Mouse Event evt { super mouse Released evt Dragging = = evt get X = evt get Y update Cursor editor find View Container evt get Source new Point evt get X evt get Y Point2 = get View get Constrainer constrain Point get View view To Drawing new Point Collection< Figure> dragged Figures = new Linked List get View get Selected Figures Figure drop Target = get Drawing find Figure Except dragged Figures if drop Target != { snap Back = drop Target handle Drop dragged Figures get View if snap Back { Affine Transform tx = new Affine Transform tx translate anchor Point - old Point anchor Point - old Point for Figure dragged Figures { will Change basic Transform tx changed } } else { Affine Transform tx = new Affine Transform tx translate -anchor Point + old Point -anchor Point + old Point if ! tx Identity { get Drawing fire Undoable Edit Happened new Transform Edit dragged Figures tx } } } else { Affine Transform tx = new Affine Transform tx translate -anchor Point + old Point -anchor Point + old Point if ! tx Identity { get Drawing fire Undoable Edit Happened new Transform Edit dragged Figures tx } } fire Tool Done } } 