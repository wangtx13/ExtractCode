org jhotdraw app action import org jhotdraw * import org jhotdraw gui * import org jhotdraw gui event * import org jhotdraw util * import awt * import awt event * import javax swing * import * import org jhotdraw app application import org jhotdraw app project save before action project action { private component old focus owner save before action application app { super app } action performed action event evt { project = get current project if enabled { resource bundle util labels = resource bundle util get bundle org jhotdraw app labels window ancestor = swing utilities get window ancestor get component old focus owner = ancestor == ? ancestor get focus owner set enabled if has unsaved changes { option pane pane = new option pane <html> + manager get option pane css + labels get save before message option pane WARNING_MESSAGE options = { labels get save labels get cancel labels get dont save } pane set options options pane set initial value options 0 pane put client property quaqua option pane destructive option new integer 2 sheet show sheet pane get component new sheet listener { option selected sheet event evt { value = evt get value if value == || value equals labels get cancel { set enabled } else if value equals labels get dont save { it set enabled } else if value equals labels get save { save changes } } } } else { it set enabled if old focus owner != { old focus owner request focus } } } } save changes project { if get == { chooser chooser = get save chooser sheet show save sheet chooser get component new sheet listener { option selected sheet event evt { if evt get option == chooser APPROVE_OPTION { if evt get chooser get filter instanceof extension filter { = extension filter evt get chooser get filter make acceptable evt get chooser get selected } else { = evt get chooser get selected } save to } else { set enabled if old focus owner != { old focus owner request focus } } } } } else { save to get } } save to project { execute new worker { construct { try { write } catch { } } finished value { saved value } } } saved project value { if value == { set mark changes saved it } else { resource bundle util labels = resource bundle util get bundle org jhotdraw app labels sheet show message sheet get component <html> + manager get option pane css + labels get formatted couldnt save value option pane ERROR_MESSAGE } set enabled if old focus owner != { old focus owner request focus } } it project } 