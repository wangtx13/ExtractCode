org jhotdraw draw import org jhotdraw util * import org jhotdraw undo * import awt * import awt geom * import awt event * import util * import org jhotdraw geom * bezier tool tool { private finish when mouse released map< attribute key object> attributes private bezier figure prototype bezier figure created figure private composite edit creation edit private node count before drag bezier tool bezier figure prototype { this prototype } bezier tool bezier figure prototype map attributes { this prototype = prototype this attributes = attributes } activate drawing editor editor { super activate editor get view clear selection get view set cursor cursor get predefined cursor cursor CROSSHAIR_CURSOR } deactivate drawing editor editor { super deactivate editor get view set cursor cursor get default cursor if created figure != { finish creation created figure created figure = get drawing fire undoable edit happened creation edit } } mouse pressed mouse event evt { super mouse pressed evt if created figure == { finish when mouse released = creation edit = new composite edit figur erstellen get drawing fire undoable edit happened creation edit created figure = create figure created figure add node new bezier path node get view get constrainer constrain point get view view to drawing anchor get drawing add created figure node count before drag = created figure get node count } else { if evt get click count == 1 { add point to figure get view get constrainer constrain point get view view to drawing anchor } node count before drag = created figure get node count } } bezier figure create figure { bezier figure = bezier figure prototype clone get editor apply default attributes to if attributes != { for map entry< attribute key object> entry attributes entry set { set attribute entry get key entry get value } } } figure get created figure { created figure } figure get added figure { created figure } add point to figure point2 new point { point count = created figure get node count created figure will change if point count < 2 { created figure basic add node new bezier path node new point } else { point2 point = created figure get point point2 second last point = point count <= 1 ? point created figure get point point count - 2 0 if new point equals point { } else if point count > 1 geom line contains point new point new point second last point second last point point point 0 9f / get view get scale factor { created figure basic set point point count - 1 0 new point } else { created figure basic add node new bezier path node new point } } created figure changed } mouse clicked mouse event evt { if created figure != { switch evt get click count { case 1 if created figure get node count > 2 { rectangle = new rectangle get view drawing to view created figure get start point grow 2 2 if contains evt get evt get { created figure set closed finish creation created figure get drawing fire undoable edit happened creation edit created figure = fire tool done } } break case 2 finish when mouse released = finish creation created figure get drawing fire undoable edit happened creation edit created figure = fire tool done break } } } mouse released mouse event evt { if finish when mouse released == { if created figure get node count > 2 { bezier path fitted path = bezier fit bezier curve created figure get bezier path 1 created figure will change created figure basic set bezier path fitted path created figure changed finish creation created figure created figure = get drawing fire undoable edit happened creation edit finish when mouse released = fire tool done } } else if finish when mouse released == { finish when mouse released = } if created figure get node count > node count before drag + 1 { created figure will change bezier path fitted path = new bezier path for i=node count before drag = created figure get node count < i++ { fitted path add created figure get node node count before drag created figure basic remove node node count before drag } fitted path = bezier fit bezier curve fitted path 1 for bezier path node node fitted path { created figure basic add node node } node count before drag = created figure get node count created figure changed } } finish creation bezier figure created figure { get view add to selection created figure } mouse dragged mouse event evt { if created figure != { if finish when mouse released == { finish when mouse released = } = evt get = evt get add point to figure get view view to drawing new point } } mouse moved mouse event evt { } } 