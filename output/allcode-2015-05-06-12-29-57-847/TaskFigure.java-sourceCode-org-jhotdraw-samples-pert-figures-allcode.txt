org jhotdraw samples pert figures import import org jhotdraw samples * import awt geom * import beans * import org jhotdraw draw attribute keys * import util * import org jhotdraw draw * import org jhotdraw geom * import org jhotdraw util * import org jhotdraw xml * task figure graphical composite figure { private hash set< dependency figure> dependencies private start time private adapter figure listener { private task figure target adapter task figure target { this target = target } figure attribute changed figure event { } } private duration adapter figure listener { private task figure target duration adapter task figure target { this target = target } figure attribute changed figure event evt { for task figure succ target get successors { succ update start time } } } task figure { super new rectangle figure set layouter new vertical layouter rectangle figure compartment = new rectangle figure STROKE_COLOR set compartment compartment set attribute enabled STROKE_COLOR FILL_COLOR set compartment compartment set attribute enabled FILL_COLOR list figure compartment = new list figure compartment list figure attribute compartment = new list figure separator line figure separator1 = new separator line figure apply attributes get presentation figure add compartment add separator1 add attribute compartment insets2 insets = new insets2 4 8 4 8 LAYOUT_INSETS set compartment insets LAYOUT_INSETS set attribute compartment insets text figure figure compartment add figure = new text figure FONT_BOLD set figure figure set attribute enabled FONT_BOLD text figure duration figure attribute compartment add duration figure = new text figure FONT_BOLD set duration figure duration figure set text 0 duration figure set attribute enabled FONT_BOLD text figure start time figure attribute compartment add start time figure = new text figure start time figure set editable start time figure set text 0 start time figure set attribute enabled FONT_BOLD apply attributes this set attribute enabled STROKE_DASHES resource bundle util labels = resource bundle util get bundle org jhotdraw samples pert labels set labels get task default set duration 0 start time = 0 dependencies = new hash set< dependency figure> figure add figure listener new adapter this duration figure add figure listener new duration adapter this } collection< handle> create handles detail level { list< handle> handles = new linked list< handle> if detail level == 0 { handles add new move handle this relative locator north west handles add new move handle this relative locator north east handles add new move handle this relative locator south west handles add new move handle this relative locator south east handles add new connection handle this relative locator east new dependency figure } handles } set new value { get figure set text new value } get { get figure get text } set duration new value { old value = get duration get duration figure set text integer to new value if old value != new value { for task figure succ get successors { succ update start time } } } get duration { try { integer value of get duration figure get text } catch number format { 0 } } update start time { old value = get start time new value = 0 for task figure get predecessors { new value = math max new value get start time + get duration } get start time figure set text integer to new value if new value != old value { for task figure succ get successors { if ! this dependent of succ { succ update start time } } } if old value != new value { fire area invalidated } } get start time { try { integer value of get start time figure get text } catch number format { 0 } } private text figure get figure { text figure list figure get child 0 get child 0 } private text figure get duration figure { text figure list figure get child 2 get child 0 } private text figure get start time figure { text figure list figure get child 2 get child 1 } private apply attributes figure { map< attribute key object> attr = attributed figure get presentation figure get attributes for map entry< attribute key object> entry attr entry set { set attribute entry get key entry get value } } task figure clone { task figure that = task figure super clone that dependencies = new hash set< dependency figure> that get figure add figure listener new adapter that that get duration figure add figure listener new duration adapter that that update start time that } read dom input { = get attribute 0d = get attribute 0d = get attribute 0d = get attribute 0d set bounds new point2 new point2 x+w y+h read attributes open element model open element set read close element open element duration set duration integer read close element close element } write dom output out { rectangle2 = get bounds out add attribute out add attribute write attributes out out open element model out open element out write get out close element out open element duration out write get duration out close element out close element } get layer { 0 } set< dependency figure> get dependencies { collections unmodifiable set dependencies } add dependency dependency figure { dependencies add update start time } remove dependency dependency figure { dependencies remove update start time } list< task figure> get successors { linked list< task figure> list = new linked list< task figure> for dependency figure get dependencies { if get start figure == this { list add task figure get figure } } list } list< task figure> get predecessors { linked list< task figure> list = new linked list< task figure> for dependency figure get dependencies { if get figure == this { list add task figure get start figure } } list } dependent of task figure { if this == for task figure get predecessors { if dependent of { } } } to { task figure# +hash + +get + +get duration + +get start time } } 