org jhotdraw draw action import awt * import beans * import javax swing * import javax swing border * import javax swing event * import awt event * popup button javax swing button { private popup menu popup menu private column count = 1 private action action private rectangle action area private font item font font ITEM_FONT = new font dialog font 10 popup button { init components set focusable item font = ITEM_FONT } set item font font new value { item font = new value if popup menu != { update font popup menu } } set action action action rectangle action area { this action = action this action area = action area action add property change listener new property change listener { property change property change event evt { if evt get property equals enabled { set enabled evt get new value value } else { repaint } } } } get column count { column count } set column count count vertical { column count = count get popup menu set layout new vertical grid layout 0 get column count vertical } add action action { menu item item = get popup menu add action if get column count > 1 { item set new palette menu item } item set font item font } add menu submenu { menu item item = get popup menu add submenu update font submenu } private update font menu element menu { menu get component set font item font for menu element child menu get sub elements { update font child } } add menu item item { get popup menu add item item set font item font } add separator { get popup menu add separator } set popup menu popup menu popup menu { this popup menu = popup menu } popup menu get popup menu { if popup menu == { popup menu = new popup menu popup menu set layout new vertical grid layout 0 get column count } popup menu } private init components { form listener form listener = new form listener add mouse listener form listener } private form listener implements awt event mouse listener { mouse clicked awt event mouse event evt { } mouse entered awt event mouse event evt { } mouse exited awt event mouse event evt { } mouse pressed awt event mouse event evt { if evt get source == popup button this { popup button this show popup evt } } mouse released awt event mouse event evt { if evt get source == popup button this { popup button this perform action evt } } } private perform action awt event mouse event evt { if action area != action area contains evt get -get insets left evt get -get insets top { action action performed new action event this action event ACTION_PERFORMED evt get when evt get modifiers } } private show popup awt event mouse event evt { if popup menu != action area == || ! action area contains evt get -get insets left evt get -get insets top { = 0 = get height if get parent instanceof tool bar { tool bar toolbar = tool bar get parent if toolbar get orientation == tool bar { = 0 if toolbar get > toolbar get parent get insets left { = -popup menu get preferred size width } else { = get width } } else { if toolbar get > toolbar get parent get insets top { = -popup menu get preferred size height } } } popup menu show this } } } 