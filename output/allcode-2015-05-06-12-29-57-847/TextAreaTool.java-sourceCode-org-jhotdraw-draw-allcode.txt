org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import awt event * import javax swing event * import util * import org jhotdraw geom * text area tool creation tool implements action listener { private floating text area text area private text holder typing target text area tool text holder prototype { super prototype } deactivate drawing editor editor { edit super deactivate editor } mouse pressed mouse event { text holder text holder = figure pressed figure = get drawing find figure inside get view view to drawing new point get get if pressed figure instanceof text holder { text holder = text holder pressed figure if !text holder editable text holder = } if text holder != { created figure = begin edit text holder } if typing target != { edit fire tool done } else { super mouse pressed } } begin edit text holder text holder { if text area == { text area = new floating text area } if text holder != typing target typing target != { edit } text area create overlay get view text holder text area set bounds get field bounds text holder text holder get text text area request focus typing target = text holder } private rectangle2 get field bounds text holder figure { rectangle2 = figure get bounds insets2 insets = figure get insets = new rectangle2 + insets left + insets top width - insets left - insets right height - insets top - insets bottom -= 1 -= 2 width += 18 height += 4 } mouse released mouse event evt { if created figure != { text holder text holder = text holder created figure rectangle2 bounds = created figure get bounds if bounds width == 0 bounds height == 0 { get drawing remove created figure } else { if bounds width < 5 bounds height < 5 { created figure will change created figure basic set bounds new point2 bounds bounds new point2 bounds + 100 bounds + 100 created figure changed } get view add to selection created figure } if created figure instanceof composite figure { composite figure created figure layout } created figure = get drawing fire undoable edit happened creation edit begin edit text holder } } edit { if typing target != { if text area get text length > 0 { typing target set text text area get text if created figure != { get drawing fire undoable edit happened creation edit created figure = } } else { if created figure != { get drawing remove figure get added figure } else { typing target set text } } typing target = text area overlay } } action performed action event event { edit fire tool done } } 