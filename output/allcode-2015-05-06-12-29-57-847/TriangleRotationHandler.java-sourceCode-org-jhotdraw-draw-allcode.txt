org jhotdraw draw import awt * import awt geom * import org jhotdraw draw attribute keys * import org jhotdraw geom * triangle rotation handler handle { private rectangle center box private attribute keys orientation old value private attribute keys orientation new value triangle rotation handler triangle figure owner { super owner } combinable with handle { } private point2 get location { rectangle2 = get owner get bounds point2 offset = get handlesize switch get get owner { case default = new point2 + width / 2d + offset break case NORTH_EAST = new point2 + width - offset + offset break case = new point2 + width - offset + height / 2d break case SOUTH_EAST = new point2 + width - offset + height - offset break case = new point2 + width / 2d + height - offset break case SOUTH_WEST = new point2 + offset + height - offset break case = new point2 + offset + height / 2d break case NORTH_WEST = new point2 + offset + offset break } } rectangle basic get bounds { point = view drawing to view get location rectangle = new rectangle grow get handlesize / 2 get handlesize / 2 } track start point anchor modifiers { old value = get get owner center box = view drawing to view get owner get bounds center box grow center box width / -3 center box height / -3 } track step point anchor point modifiers { rectangle rect = new rectangle switch geom outcode center box rect { case geom OUT_TOP default new value = attribute keys orientation break case geom OUT_TOP | geom OUT_RIGHT new value = attribute keys orientation NORTH_EAST break case geom OUT_RIGHT new value = attribute keys orientation break case geom OUT_BOTTOM | geom OUT_RIGHT new value = attribute keys orientation SOUTH_EAST break case geom OUT_BOTTOM new value = attribute keys orientation break case geom OUT_BOTTOM | geom OUT_LEFT new value = attribute keys orientation SOUTH_WEST break case geom OUT_LEFT new value = attribute keys orientation break case geom OUT_TOP | geom OUT_LEFT new value = attribute keys orientation NORTH_WEST break } get owner will change basic set get owner new value get owner changed update bounds } draw graphics2 { draw diamond color yellow color black } track point anchor point modifiers { if new value != old value { fire undoable edit happened new attribute change edit get owner old value new value } } } 