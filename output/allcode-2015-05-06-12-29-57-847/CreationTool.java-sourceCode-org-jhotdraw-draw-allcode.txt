org jhotdraw draw import org jhotdraw undo composite edit import awt * import awt geom * import awt event * import util * creation tool tool { private map< attribute key object> attributes private private dimension minimal size treshold = new dimension 10 10 private dimension minimal size = new dimension 40 40 private figure prototype figure created figure composite edit creation edit creation tool prototype { this prototype } creation tool prototype map< attribute key object> attributes { this prototype attributes } creation tool prototype map< attribute key object> attributes { try { this prototype = figure for prototype new instance } catch { internal = new internal unable to create figure from +prototype init cause } this attributes = attributes this = } creation tool figure prototype { this prototype } creation tool figure prototype map< attribute key object> attributes { this prototype attributes } creation tool figure prototype map< attribute key object> attributes { this prototype = prototype this attributes = attributes this = } figure get prototype { prototype } activate drawing editor editor { super activate editor } deactivate drawing editor editor { super deactivate editor if get view != { get view set cursor cursor get default cursor } if created figure != { if created figure instanceof composite figure { composite figure created figure layout } created figure = } } mouse pressed mouse event evt { super mouse pressed evt get view clear selection creation edit = new composite edit figur erstellen get drawing fire undoable edit happened creation edit created figure = create figure point2 = constrain point view to drawing anchor anchor = evt get anchor = evt get created figure will change created figure basic set bounds created figure changed get drawing add created figure } figure create figure { figure = figure prototype clone get editor apply default attributes to if attributes != { for map entry< attribute key object> entry attributes entry set { set attribute entry get key entry get value } } } figure get created figure { created figure } figure get added figure { created figure } mouse dragged mouse event evt { if created figure != { point2 = constrain point new point evt get evt get created figure will change created figure basic set bounds constrain point new point anchor anchor created figure changed } } mouse released mouse event evt { if created figure != { rectangle2 bounds = created figure get bounds if bounds width == 0 bounds height == 0 { get drawing remove created figure } else { if math anchor - evt get < minimal size treshold width math anchor - evt get < minimal size treshold height { created figure basic set bounds constrain point new point anchor anchor constrain point new point anchor + math max bounds width minimal size width anchor + math max bounds height minimal size height } get view add to selection created figure } if created figure instanceof composite figure { composite figure created figure layout } created figure = get drawing fire undoable edit happened creation edit fire tool done } } } 