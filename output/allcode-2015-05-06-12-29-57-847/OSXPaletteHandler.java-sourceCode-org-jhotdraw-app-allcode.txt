org jhotdraw app import awt * import awt event * import util prefs * import javax swing * import util * palette handler { private hash set< window> palettes = new hash set< window> private hash map< window project> windows = new hash map< window project> private palette handler instance private javax swing timer timer private default application app private window focus listener focus handler = new window focus listener { window gained focus window event { timer stop if windows contains key get window { app set current project project windows get get window show palettes } } window lost focus window event { timer restart } } palette handler default application app { this app = app timer = new javax swing timer 60 new action listener { action performed action event evt { maybe hide palettes } } timer set repeats } add window window project project { window add window focus listener focus handler windows put window project } remove window window project project { windows remove window window remove window focus listener focus handler } add palette window palette { palette add window focus listener focus handler palettes add palette } remove palette window palette { palettes remove palette palette remove window focus listener focus handler } set< window> get palettes { collections unmodifiable set palettes } private show palettes { for window palette palettes { if ! palette visible { palette set visible } } } private focused window { if focused window owned windows = get owned windows for i=0 < owned windows length i++ { if focused owned windows { } } } private maybe hide palettes { has focus = for window window windows key set { if focused window { has focus = break } } if ! has focus windows size > 0 { for window palette palettes { if focused palette { has focus = break } } } if ! has focus { for window palette palettes { palette set visible } } } } 