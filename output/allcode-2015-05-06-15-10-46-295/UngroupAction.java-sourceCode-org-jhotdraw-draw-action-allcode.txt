org jhotdraw draw action import org jhotdraw draw * import org jhotdraw undo * import util * import javax swing * import javax swing undo * ungroup action selected action { = selection ungroup private composite figure prototype ungroup action drawing editor editor { this editor new group figure } ungroup action drawing editor editor composite figure prototype { super editor this prototype = prototype labels configure action this } @ override update enabled state { if get view != { set enabled can ungroup } else { set enabled } } can ungroup { get view get selection count == 1 get view get selected figures iterator next get equals prototype get } action performed awt event action event e { if can ungroup { drawing view view = get view composite figure group = composite figure get view get selected figures iterator next linked list< figure> ungrouped figures = new linked list< figure> composite edit edit = new composite edit labels get selection ungroup { redo cannot redo { super redo ungroup figures view group } undo cannot undo { group figures view group ungrouped figures super undo } } fire undoable edit happened edit ungrouped figures add all ungroup figures view group fire undoable edit happened edit } } collection< figure> ungroup figures drawing view view composite figure group { linked list< figure> figures = new linked list< figure> group get children view clear selection group basic remove all children view get drawing basic add all figures view get drawing remove group view add to selection figures figures } group figures drawing view view composite figure group collection< figure> figures { collection< figure> sorted = view get drawing sort figures view get drawing basic remove all figures view clear selection view get drawing add group group will change for figure f sorted { group basic add f } group changed view add to selection group } } 