org jhotdraw app import org jhotdraw util * import org jhotdraw util prefs * import awt * import awt event * import beans * import io * import util * import util prefs * import javax swing * import org jhotdraw app action about action import org jhotdraw app action actions import org jhotdraw app action clear action import org jhotdraw app action clear recent files action import org jhotdraw app action close action import org jhotdraw app action copy action import org jhotdraw app action cut action import org jhotdraw app action delete action import org jhotdraw app action duplicate action import org jhotdraw app action exit action import org jhotdraw app action export action import org jhotdraw app action load action import org jhotdraw app action load recent action import org jhotdraw app action new action import org jhotdraw app action paste action import org jhotdraw app action redo action import org jhotdraw app action save action import org jhotdraw app action save as action import org jhotdraw app action select all action import org jhotdraw app action toggle visible action import org jhotdraw app action undo action default s d i application application { private project current project private preferences prefs default s d i application { } launch args { set property apple awt graphics use quartz super launch args } init { super init prefs = preferences user node for get model == ? get get model get init labels init look and feel init application actions } remove project p { super remove p if projects size == 0 { stop } } init look and feel { set property apple laf use screen menu bar set property com apple macos use screen menu bar set property apple awt graphics use quartz try { laf name = u i manager get look and feel name u i manager set look and feel laf name } catch e { e print stack trace } if u i manager get option pane css == { u i manager put option pane css } } init application actions { resource bundle util app labels = resource bundle util get l a f bundle org jhotdraw app labels application model m = get model m put action about action new about action this m put action exit action new exit action this m put action clear action new clear action this m put action new action new new action this app labels configure action m get action new action new window m put action load action new load action this m put action clear recent files action new clear recent files action this m put action save action new save action this m put action save as action new save as action this m put action close action new close action this m put action undo action new undo action this m put action redo action new redo action this m put action cut action new cut action m put action copy action new copy action m put action paste action new paste action m put action delete action new delete action m put action duplicate action new duplicate action m put action select all action new select all action } init project actions project p { } show project p { if ! p is showing { p set showing = p get j frame f = new j frame title if == { title = labels get unnamed } else { title = get name } if p has unsaved changes { title += * } f set title labels get formatted frame title title get name p get multiple open f set default close operation j frame DO_NOTHING_ON_CLOSE j panel panel = j panel wrap project component p f add panel f set minimum size new dimension 200 200 f set preferred size new dimension 600 400 f set j menu bar create menu bar p util list< action> panel get client property tool bar actions preferences util install frame prefs handler prefs project f point loc = f get location moved do { moved = for iterator i=projects iterator i has next { project a project = project i next if a project != p swing utilities get window ancestor a project get component != swing utilities get window ancestor a project get component get location equals loc { loc x += 22 loc y += 22 moved = break } } } while moved f set location loc f add window listener new window adapter { window closing window event evt { set current project p get model get action close action action performed new action event f action event ACTION_PERFORMED window closing } window activated window event e { set current project p } } p add property change listener new property change listener { property change property change event evt { name = evt get property name if name equals has unsaved changes || name equals || name equals multiple open { = p get title if == { title = labels get unnamed } else { title = get name } if p has unsaved changes { title += * } f set title labels get formatted frame title title get name p get multiple open } } } f set visible } } component wrap project component project p { component c = p get component if get model != { linked list< action> tool bar actions = new linked list id=0 for j tool bar tb new reversed list< j tool bar> get model create tool bars this p { id++ j panel panel = new j panel new border layout panel add tb border layout n o r t h panel add c border layout c e n t e r c = panel preferences util install tool bar prefs handler prefs toolbar +id tb tool bar actions add first new toggle visible action tb tb get name } j tool bar tb = new j tool bar tb set name labels get standard tool bar title add standard actions to tb p id++ j panel panel = new j panel new border layout panel add tb border layout n o r t h panel add c border layout c e n t e r c = panel preferences util install tool bar prefs handler prefs toolbar +id tb tool bar actions add first new toggle visible action tb tb get name panel put client property tool bar actions tool bar actions } c } add standard actions to j tool bar tb project p { j button b application model m = get model b = tb add m get action clear action b set focusable b = tb add m get action load action b set focusable b = tb add m get action save action tb add separator b = tb add m get action undo action b set focusable b = tb add m get action redo action b set focusable tb add separator b = tb add m get action cut action b set focusable b = tb add m get action copy action b set focusable b = tb add m get action paste action b set focusable } hide project p { if p is showing { p set showing j frame f = j frame swing utilities get window ancestor p get component f set visible f remove p get component f dispose } } dispose project p { super dispose p if projects size == 0 { stop } } project get current project { current project } set current project project new value { project old value = current project current project = new value fire property change current project old value new value } j menu bar create menu bar project p util list< action> tool bar actions { application model model = get model resource bundle util labels = resource bundle util get l a f bundle org jhotdraw app labels j menu bar mb = new j menu bar j menu m m2 j menu item mi j check box menu item cbmi j menu open recent menu m = new j menu labels configure menu m labels get m add model get action clear action m add model get action new action m add model get action load action open recent menu = new j menu labels configure menu open recent menu open recent open recent menu add model get action clear recent files action update open recent menu open recent menu m add open recent menu m add separator m add model get action save action m add model get action save as action if model get action export action != { mi = m add model get action export action } m add separator m add model get action exit action mb add m m = new j menu labels configure menu m labels get edit m add model get action undo action m add model get action redo action m add separator m add model get action cut action m add model get action copy action m add model get action paste action m add model get action duplicate action m add model get action delete action m add separator m add model get action select all action mb add m j menu view menu = for j menu mm model create menus this p { mb add mm if mm get text equals labels get view { view menu = mm } } if tool bar actions != tool bar actions size > 0 { m = view menu != ? view menu new j menu m2 = tool bar actions size == 1 ? m new j menu labels get tool bars labels configure menu m labels get view for action a tool bar actions { cbmi = new j check box menu item a actions configure j check box menu item cbmi a m2 add cbmi } if m2 != m { m add m2 } mb add m } m = new j menu labels configure menu m labels get help m add model get action about action mb add m add property change listener new property change listener { property change property change event evt { name = evt get property name if name == project count { if p == || projects contains p { } else { remove property change listener this } } else if name == recent files { update open recent menu open recent menu } } } mb } private update open recent menu j menu open recent menu { if open recent menu get item count > 0 { j menu item clear recent files item = j menu item open recent menu get item open recent menu get item count 1 open recent menu remove all for f recent files { open recent menu add new load recent action default s d i application this f } if recent files size > 0 { open recent menu add separator } open recent menu add clear recent files item } } is sharing tools among projects { } component get component { project p = get current project p == ? p get component } } 