org jhotdraw draw import org jhotdraw beans * import awt * import awt datatransfer * import awt event focus event import awt event focus listener import beans * import util * import io * import org jhotdraw draw attribute keys * default drawing editor bean implements drawing editor tool listener { private hash map< attribute key object> default attributes = new hash map< attribute key object> private tool tool private hash set< drawing view> views private drawing view active view private is enabled = private drawing view focused view private focus listener focus handler = new focus listener { focus gained focus event e { set focused view drawing view find view container e get source } focus lost focus event e { if ! e is temporary { set focused view } } } default drawing editor { set default attribute FILL_COLOR color white set default attribute STROKE_COLOR color black set default attribute TEXT_COLOR color black views = new hash set< drawing view> } set tool tool t { if t == tool if tool != { for drawing view v views { v remove mouse listener tool v remove mouse motion listener tool v remove key listener tool } tool deactivate this tool remove tool listener this } tool = t if tool != { tool activate this for drawing view v views { v add mouse listener tool v add mouse motion listener tool v add key listener tool } tool add tool listener this } } area invalidated tool event evt { rectangle r = evt get invalidated area evt get view get container repaint r x r y r width r height } tool started tool event evt { set view evt get view } set view drawing view new value { drawing view old value = active view active view = new value fire property change view old value new value for drawing view v views { v get container repaint } } tool done tool event evt { drawing view v = get view if v != { container c = v get container c invalidate if c get parent != c get parent validate } } tool get tool { tool } drawing view get view { active view != ? active view views iterator next } private update focused view { for drawing view v views { if v get container has focus { set focused view v } } set focused view } private set focused view drawing view new value { drawing view old value = focused view focused view = new value fire property change focused view old value new value } drawing view get focused view { focused view } apply default attributes to figure f { for map entry< attribute key object> entry default attributes entry set { f set attribute entry get key entry get value } } get default attribute attribute key key { default attributes get key } set default attribute attribute key key new value { old value = default attributes put key new value fire property change key get key old value new value } remove drawing view view { view get container remove focus listener focus handler views remove view if tool != { view remove mouse listener tool view remove mouse motion listener tool view remove key listener tool } view remove notify this if active view == view { view = views size > 0 ? views iterator next } update focused view } add drawing view view { views add view view add notify this view get container add focus listener focus handler if tool != { view add mouse listener tool view add mouse motion listener tool view add key listener tool } update focused view } set cursor cursor c { } collection< drawing view> get drawing views { collections unmodifiable collection views } drawing view find view container c { for drawing view v views { if v get container == c { v } } } set enabled new value { if new value != is enabled { old value = is enabled is enabled = new value fire property change enabled old value new value } } is enabled { is enabled } } 