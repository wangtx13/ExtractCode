org jhotdraw app action import awt * import awt event * import javax swing * import io * import org jhotdraw app * import org jhotdraw io * import org jhotdraw util * import org jhotdraw gui * import org jhotdraw gui event * save action project action { = save private save as private component old focus owner save action application app { this app } save action application app save as { super app this save as = save as resource bundle util labels = resource bundle util get l a f bundle org jhotdraw app labels labels configure action this } action performed action event evt { project project = get current project if project is enabled { old focus owner = swing utilities get window ancestor project get component get focus owner project set enabled save to if !save as project get != { save to project project get } else { j chooser chooser = project get save chooser j sheet show save sheet chooser project get component new sheet listener { option selected sheet event evt { if evt get option == j chooser APPROVE_OPTION { if evt get chooser get filter instanceof extension filter { = extension filter evt get chooser get filter make acceptable evt get chooser get selected } else { = evt get chooser get selected } save to project } else { project set enabled if old focus owner != { old focus owner request focus } } } } } } } save to project project { project execute new worker { construct { try { project write } catch i o e { e } } finished value { saved project value } } } saved project project value { if value == { project set project mark changes as saved multi open = 1 for project p project get application projects { if p != project p get != p get equals { multi open = math max multi open p get multiple open + 1 } } get application add recent project set multiple open multi open } else { j sheet show message sheet project get component <html> + u i manager get option pane css + <b> couldn't save to the \ +file+ \ <p> + reason +value j option pane ERROR_MESSAGE } project set enabled swing utilities get window ancestor project get component to front if old focus owner != { old focus owner request focus } } } 