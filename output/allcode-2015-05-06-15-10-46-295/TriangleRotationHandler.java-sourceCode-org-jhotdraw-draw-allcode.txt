org jhotdraw draw import awt * import awt geom * import org jhotdraw draw attribute keys * import org jhotdraw geom * triangle rotation handler handle { private rectangle center box private attribute keys orientation old value private attribute keys orientation new value triangle rotation handler triangle figure owner { super owner } is combinable with handle h { } private point2 d get location { rectangle2 d r = get owner get bounds point2 d p offset = get handlesize switch o r i e n t a t i o n get get owner { case n o r t h default p = new point2 d r x + r width / 2d r y + offset break case NORTH_EAST p = new point2 d r x + r width offset r y + offset break case e a s t p = new point2 d r x + r width offset r y + r height / 2d break case SOUTH_EAST p = new point2 d r x + r width offset r y + r height offset break case s o u t h p = new point2 d r x + r width / 2d r y + r height offset break case SOUTH_WEST p = new point2 d r x + offset r y + r height offset break case w e s t p = new point2 d r x + offset r y + r height / 2d break case NORTH_WEST p = new point2 d r x + offset r y + offset break } p } rectangle basic get bounds { point p = view drawing to view get location rectangle r = new rectangle p r grow get handlesize / 2 get handlesize / 2 r } track start point anchor modifiers ex { old value = o r i e n t a t i o n get get owner center box = view drawing to view get owner get bounds center box grow center box width / 3 center box height / 3 } track step point anchor point modifiers ex { rectangle rect = new rectangle switch geom outcode center box rect { case geom OUT_TOP default new value = attribute keys orientation n o r t h break case geom OUT_TOP | geom OUT_RIGHT new value = attribute keys orientation NORTH_EAST break case geom OUT_RIGHT new value = attribute keys orientation e a s t break case geom OUT_BOTTOM | geom OUT_RIGHT new value = attribute keys orientation SOUTH_EAST break case geom OUT_BOTTOM new value = attribute keys orientation s o u t h break case geom OUT_BOTTOM | geom OUT_LEFT new value = attribute keys orientation SOUTH_WEST break case geom OUT_LEFT new value = attribute keys orientation w e s t break case geom OUT_TOP | geom OUT_LEFT new value = attribute keys orientation NORTH_WEST break } get owner will change o r i e n t a t i o n basic set get owner new value get owner changed update bounds } draw graphics2 d g { draw diamond g color yellow color black } track end point anchor point modifiers ex { if new value != old value { fire undoable edit happened new attribute change edit get owner o r i e n t a t i o n old value new value } } } 