org jhotdraw draw action import org jhotdraw draw * import org jhotdraw undo * import util * import javax swing * import javax swing undo * group action selected action { = selection group private composite figure prototype group action drawing editor editor { this editor new group figure } group action drawing editor editor composite figure prototype { super editor this prototype = prototype labels configure action this } @ override update enabled state { if get view != { set enabled can group } else { set enabled } } can group { get view get selection count > 1 } action performed awt event action event e { if can group { drawing view view = get view linked list< figure> ungrouped figures = new linked list< figure> view get selected figures composite figure group = composite figure prototype clone composite edit edit = new composite edit labels get selection group { redo cannot redo { super redo group figures view group ungrouped figures } undo cannot undo { ungroup figures view group super undo } add edit undoable edit an edit { super add edit an edit } } fire undoable edit happened edit group figures view group ungrouped figures fire undoable edit happened edit } } collection< figure> ungroup figures drawing view view composite figure group { linked list< figure> figures = new linked list< figure> group get children view clear selection group basic remove all children view get drawing basic add all figures view get drawing remove group view add to selection figures figures } group figures drawing view view composite figure group collection< figure> figures { collection< figure> sorted = view get drawing sort figures view get drawing basic remove all figures view clear selection view get drawing add group group will change for figure f sorted { group basic add f } group changed view add to selection group } } 