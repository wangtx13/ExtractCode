org jhotdraw samples net import util prefs * import org jhotdraw gui * import org jhotdraw io * import org jhotdraw undo * import org jhotdraw util * import awt * import beans * import io * import lang reflect * import javax swing * import javax swing border * import org jhotdraw app * import org jhotdraw app action * import org jhotdraw draw * import org jhotdraw draw action * import org jhotdraw xml * import org jhotdraw samples pert figures * net project project { private undo redo manager undo private drawing editor editor private grid constrainer visible constrainer = new grid constrainer 10 10 private grid constrainer invisible constrainer = new grid constrainer 1 1 private preferences prefs private button toggle grid button net project { } init { super init init components j panel zoom button panel = new j panel new border layout scroll pane set layout new placard scroll pane layout scroll pane set border new empty border 0 0 0 0 set editor new default drawing editor view set dom factory new net factory undo = new undo redo manager view set drawing new default drawing view get drawing add undoable edit listener undo init actions undo add property change listener new property change listener { property change property change event evt { set has unsaved changes undo has significant edits } } resource bundle util labels = resource bundle util get l a f bundle org jhotdraw draw labels j panel placard panel = new j panel new border layout javax swing button p button p button = tool bar button factory create zoom button view p button put client property quaqua button style placard p button put client property quaqua component visual margin new insets 0 0 0 0 p button set font u i manager get font small font placard panel add p button border layout w e s t toggle grid button = p button = tool bar button factory create toggle grid button view p button put client property quaqua button style placard p button put client property quaqua component visual margin new insets 0 0 0 0 p button set font u i manager get font small font labels configure tool bar button p button align grid small placard panel add p button border layout e a s t scroll pane add placard panel j scroll pane LOWER_LEFT_CORNER prefs = preferences user node for get toggle grid button set selected prefs get project grid visible set scale factor prefs get project scale factor 1d view add property change listener new property change listener { property change property change event evt { name = evt get property name if name equals constrainer { prefs put project grid visible constrainer evt get new value is visible fire property change grid visible constrainer evt get old value is visible constrainer evt get new value is visible } else if name equals scale factor { prefs put project scale factor evt get new value fire property change scale factor evt get old value evt get new value } } } } drawing editor get editor { editor } set editor drawing editor new value { drawing editor old value = editor if old value != { old value remove view } editor = new value if new value != { new value add view } } set grid visible new value { toggle grid button set selected new value } is grid visible { view get constrainer is visible } get scale factor { view get scale factor } set scale factor new value { view set scale factor new value } private init actions { put action undo action undo get undo action put action redo action undo get redo action } set has unsaved changes new value { super set has unsaved changes new value undo set has significant edits new value } write f i o { output stream out = try { out = new buffered output stream new output stream f nano xml lite dom output domo = new nano xml lite dom output view get dom factory domo write view get drawing domo save out } finally { if out != try { out close } catch i o e {} } } read f i o { input stream in = try { in = new buffered input stream new input stream f nano xml lite dom input domi = new nano xml lite dom input view get dom factory in drawing drawing = drawing domi read swing utilities and wait new runnable { run { view get drawing remove undoable edit listener undo view set drawing drawing view get drawing add undoable edit listener undo undo discard all edits }} } catch interrupted e { internal = new internal e init cause e throw } catch invocation target e { internal = new internal e init cause e throw } finally { if in != try { in close } catch i o e {} } } set drawing editor drawing editor new value { if editor != { editor remove view } editor = new value if editor != { editor add view } } drawing editor get drawing editor { editor } clear { view set drawing new default drawing undo discard all edits } @ override j chooser create open chooser { j chooser c = super create open chooser c add choosable filter new extension filter net diagram xml c } @ override j chooser create save chooser { j chooser c = super create save chooser c add choosable filter new extension filter net diagram xml c } private init components { scroll pane = new javax swing j scroll pane view = new org jhotdraw draw default drawing view set layout new awt border layout scroll pane set horizontal scroll bar policy javax swing scroll pane constants HORIZONTAL_SCROLLBAR_ALWAYS scroll pane set vertical scroll bar policy javax swing scroll pane constants VERTICAL_SCROLLBAR_ALWAYS scroll pane set viewport view view add scroll pane awt border layout c e n t e r } private javax swing j scroll pane scroll pane private org jhotdraw draw default drawing view view } 