org jhotdraw draw import awt * import awt event * import javax swing event * import util * text tool creation tool implements action listener { private floating text field text field private text holder typing target text tool text holder prototype { super prototype } text tool figure prototype map attributes { super prototype attributes } deactivate drawing editor editor { end edit super deactivate editor } mouse pressed mouse event e { text holder text holder = figure pressed figure = get drawing find figure inside get view view to drawing new point e get x e get y if pressed figure instanceof text holder { text holder = text holder pressed figure get label for if !text holder is editable text holder = } if text holder != { begin edit text holder } if typing target != { end edit fire tool done } else { super mouse pressed e text holder = text holder get created figure begin edit text holder } } mouse dragged awt event mouse event e { } begin edit text holder text holder { if text field == { text field = new floating text field text field add action listener this } if text holder != typing target typing target != { end edit } text field create overlay get view text holder text field set bounds get field bounds text holder text holder get text text field request focus typing target = text holder } private rectangle get field bounds text holder figure { rectangle box = get view drawing to view figure get bounds insets insets = text field get insets new rectangle box x insets left box y insets top box width + insets left + insets right box height + insets top + insets bottom } mouse released mouse event evt { } end edit { if typing target != { if text field get text length > 0 { typing target set text text field get text if created figure != { get drawing fire undoable edit happened creation edit created figure = } } else { if created figure != { get drawing remove figure get added figure } else { typing target set text } } typing target = text field end overlay } } action performed action event event { end edit fire tool done } } 