org jhotdraw draw import org jhotdraw undo composite edit import awt * import awt geom * import awt event * import util * creation tool tool { private map< attribute key object> attributes private name private dimension minimal size treshold = new dimension 10 10 private dimension minimal size = new dimension 40 40 private figure prototype figure created figure composite edit creation edit creation tool prototype name { this prototype name } creation tool prototype name map< attribute key object> attributes { this prototype name attributes } creation tool prototype name map< attribute key object> attributes name { try { this prototype = figure for name prototype name new instance } catch e { internal = new internal unable to create figure from +prototype name init cause e throw } this attributes = attributes this name = name } creation tool figure prototype { this prototype } creation tool figure prototype map< attribute key object> attributes { this prototype attributes } creation tool figure prototype map< attribute key object> attributes name { this prototype = prototype this attributes = attributes this name = name } figure get prototype { prototype } activate drawing editor editor { super activate editor } deactivate drawing editor editor { super deactivate editor if get view != { get view set cursor cursor get default cursor } if created figure != { if created figure instanceof composite figure { composite figure created figure layout } created figure = } } mouse pressed mouse event evt { super mouse pressed evt get view clear selection creation edit = new composite edit figur erstellen get drawing fire undoable edit happened creation edit created figure = create figure point2 d p = constrain point view to drawing anchor anchor x = evt get x anchor y = evt get y created figure will change created figure basic set bounds p p created figure changed get drawing add created figure } figure create figure { figure f = figure prototype clone get editor apply default attributes to f if attributes != { for map entry< attribute key object> entry attributes entry set { f set attribute entry get key entry get value } } f } figure get created figure { created figure } figure get added figure { created figure } mouse dragged mouse event evt { if created figure != { point2 d p = constrain point new point evt get x evt get y created figure will change created figure basic set bounds constrain point new point anchor x anchor y p created figure changed } } mouse released mouse event evt { if created figure != { rectangle2 d bounds = created figure get bounds if bounds width == 0 bounds height == 0 { get drawing remove created figure } else { if math abs anchor x evt get x < minimal size treshold width math abs anchor y evt get y < minimal size treshold height { created figure basic set bounds constrain point new point anchor x anchor y constrain point new point anchor x + math max bounds width minimal size width anchor y + math max bounds height minimal size height } get view add to selection created figure } if created figure instanceof composite figure { composite figure created figure layout } created figure = get drawing fire undoable edit happened creation edit fire tool done } } } 