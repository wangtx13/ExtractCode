org jhotdraw app import org jhotdraw gui * import org jhotdraw util * import org jhotdraw util prefs * import awt * import awt event * import beans * import io * import util * import util prefs * import javax swing * import javax swing event * import org jhotdraw app action * default m d i application application { private j frame parent frame private j scroll pane scroll pane private m didesktop pane desktop pane private preferences prefs private project current project private linked list< action> tool bar actions default m d i application { } init application actions { application model mo = get model mo put action about action new about action this mo put action exit action new exit action this mo put action o s x drop on dock action new o s x drop on dock action this mo put action new action new new action this mo put action open action new open action this mo put action clear recent files action new clear recent files action this mo put action save action new save action this mo put action save as action new save as action this mo put action close action new close action this mo put action undo action new undo action this mo put action redo action new redo action this mo put action cut action new cut action mo put action copy action new copy action mo put action paste action new paste action mo put action delete action new delete action mo put action duplicate action new duplicate action mo put action select all action new select all action mo put action arrange action VERTICAL_ID new arrange action desktop pane arrangeable arrangement v e r t i c a l mo put action arrange action HORIZONTAL_ID new arrange action desktop pane arrangeable arrangement h o r i z o n t a l mo put action arrange action CASCADE_ID new arrange action desktop pane arrangeable arrangement c a s c a d e } init project actions project p { p put action focus action new focus action p } launch args { set property apple awt graphics use quartz super launch args } init { super init prefs = preferences user node for get model == ? get get model get init look and feel init labels parent frame = new j frame get name parent frame set default close operation j frame DO_NOTHING_ON_CLOSE desktop pane = new m didesktop pane scroll pane = new j scroll pane scroll pane set viewport view desktop pane tool bar actions = new linked list< action> init application actions parent frame get content pane add wrap desktop pane scroll pane tool bar actions parent frame add window listener new window adapter { window closing window event evt { get model get action exit action action performed new action event parent frame action event ACTION_PERFORMED window closing } } parent frame set j menu bar create menu bar preferences util install frame prefs handler prefs parent frame parent frame parent frame set visible } init look and feel { if set property apple laf use screen menu bar set property com apple macos use screen menu bar set property apple awt graphics use quartz try { laf name = u i manager get look and feel name u i manager set look and feel laf name } catch e { e print stack trace } if u i manager get option pane css == { u i manager put option pane css } } show project p { if ! p is showing { p set showing = p get j internal frame f = new j internal frame title if == { title = labels get unnamed } else { title = get name } f set title labels get formatted internal frame title title get name p get multiple open f set default close operation j internal frame DO_NOTHING_ON_CLOSE f set closable f set maximizable f set resizable f set iconifiable preferences util install internal frame prefs handler prefs project f desktop pane point loc = f get location moved do { moved = for iterator i=projects iterator i has next { project a project = project i next if a project != p a project is showing swing utilities get root pane a project get component get parent get location equals loc { loc x += 22 loc y += 22 moved = break } } } while moved f set location loc f add internal frame listener new internal frame adapter { @ override internal frame closing internal frame event evt { set current project p get model get action close action action performed new action event f action event ACTION_PERFORMED window closing } } p add property change listener new property change listener { property change property change event evt { name = evt get property name if name equals has unsaved changes { j internal frame f get root pane get parent put client property window modified new p has unsaved changes } else if name equals { f set title p get == ? unnamed p get get name } } } f add property change listener new property change listener { property change property change event evt { name = evt get property name if name equals selected { if evt get new value equals t r u e { set current project p } } } } f get content pane add p get component f set visible desktop pane add f f to front try { f set selected } catch property veto e { } p get component request focus in window } } hide project p { if p is showing { j internal frame f = j internal frame swing utilities get root pane p get component get parent f set visible f remove p get component desktop pane remove f f dispose } } project get current project { current project } set current project project new value { project old value = current project current project = new value fire property change current project old value new value } is sharing tools among projects { } component get component { parent frame } component wrap desktop pane component c linked list< action> tool bar actions { if get model != { id=0 for j tool bar tb new reversed list< j tool bar> get model create tool bars this { id++ j panel panel = new j panel new border layout panel add tb border layout n o r t h panel add c border layout c e n t e r c = panel preferences util install tool bar prefs handler prefs toolbar +id tb tool bar actions add first new toggle tool bar action tb tb get name } j tool bar tb = new j tool bar tb set name labels get standard tool bar title add standard actions to tb id++ j panel panel = new j panel new border layout panel add tb border layout n o r t h panel add c border layout c e n t e r c = panel preferences util install tool bar prefs handler prefs toolbar +id tb tool bar actions add first new toggle tool bar action tb tb get name panel put client property tool bar actions tool bar actions } c } add standard actions to j tool bar tb { j button b application model mo = get model b = tb add mo get action new action b set focusable b = tb add mo get action open action b set focusable b = tb add mo get action save action tb add separator b = tb add mo get action undo action b set focusable b = tb add mo get action redo action b set focusable tb add separator b = tb add mo get action cut action b set focusable b = tb add mo get action copy action b set focusable b = tb add mo get action paste action b set focusable } j menu bar create menu bar { resource bundle util labels = resource bundle util get l a f bundle org jhotdraw app labels application model mo = get model j menu bar mb = new j menu bar j menu m j menu item mi j menu open recent menu m = new j menu labels configure menu m m add mo get action new action m add mo get action open action open recent menu = new j menu labels configure menu open recent menu open recent open recent menu add mo get action clear recent files action update open recent menu open recent menu m add open recent menu m add separator m add mo get action close action m add mo get action save action m add mo get action save as action if mo get action export action != { mi = m add mo get action export action } m add separator m add mo get action exit action mb add m m = new j menu labels configure menu m edit m add mo get action undo action m add mo get action redo action m add separator m add mo get action cut action m add mo get action copy action m add mo get action paste action m add mo get action duplicate action m add mo get action delete action m add separator m add mo get action select all action mb add m for j menu mm mo create menus this { mb add mm } m = new j menu j menu window menu = m labels configure menu m window m add mo get action arrange action CASCADE_ID m add mo get action arrange action VERTICAL_ID m add mo get action arrange action HORIZONTAL_ID m add separator for project pr projects { if pr get action focus action != { window menu add pr get action focus action } } if tool bar actions size > 0 { m add separator for action a tool bar actions { j check box menu item cbmi = new j check box menu item a actions configure j check box menu item cbmi a m add cbmi } } mb add m m = new j menu labels configure menu m labels get help m add mo get action about action mb add m add property change listener new property change listener { property change property change event evt { name = evt get property name application model mo = get model if name == project count { j menu m = window menu m remove all m add mo get action arrange action CASCADE_ID m add mo get action arrange action VERTICAL_ID m add mo get action arrange action HORIZONTAL_ID m add separator for iterator i=projects iterator i has next { project pr = project i next if pr get action focus action != { m add pr get action focus action } } if tool bar actions size > 0 { m add separator for action a tool bar actions { j check box menu item cbmi = new j check box menu item a actions configure j check box menu item cbmi a m add cbmi } } } else if name == recent files { update open recent menu open recent menu } } } mb } private update open recent menu j menu open recent menu { if open recent menu get item count > 0 { j menu item clear recent files item = j menu item open recent menu get item open recent menu get item count 1 open recent menu remove all for f recent files { open recent menu add new open recent action default m d i application this f } if recent files size > 0 { open recent menu add separator } open recent menu add clear recent files item } } } 