org jhotdraw draw action import awt * import beans * import javax swing * import javax swing border * import javax swing event * import awt event * j popup button javax swing j button { private j popup menu popup menu private column count = 1 private action action private rectangle action area private font item font font ITEM_FONT = new font dialog font p l a i n 10 j popup button { init components set focusable item font = ITEM_FONT } set item font font new value { item font = new value if popup menu != { update font popup menu } } set action action action rectangle action area { this action = action this action area = action area action add property change listener new property change listener { property change property change event evt { if evt get property name equals enabled { set enabled evt get new value value } else { repaint } } } } get column count { column count } set column count count is vertical { column count = count get popup menu set layout new vertical grid layout 0 get column count is vertical } add action action { j menu item item = get popup menu add action if get column count > 1 { item set u i new palette menu item u i } item set font item font } add j menu submenu { j menu item item = get popup menu add submenu update font submenu } private update font menu element menu { menu get component set font item font for menu element child menu get sub elements { update font child } } add j menu item item { get popup menu add item item set font item font } add separator { get popup menu add separator } set popup menu j popup menu popup menu { this popup menu = popup menu } j popup menu get popup menu { if popup menu == { popup menu = new j popup menu popup menu set layout new vertical grid layout 0 get column count } popup menu } private init components { form listener form listener = new form listener add mouse listener form listener } private form listener implements awt event mouse listener { mouse clicked awt event mouse event evt { } mouse entered awt event mouse event evt { } mouse exited awt event mouse event evt { } mouse pressed awt event mouse event evt { if evt get source == j popup button this { j popup button this show popup evt } } mouse released awt event mouse event evt { if evt get source == j popup button this { j popup button this perform action evt } } } private perform action awt event mouse event evt { if action area != action area contains evt get x get insets left evt get y get insets top { action action performed new action event this action event ACTION_PERFORMED evt get when evt get modifiers } } private show popup awt event mouse event evt { if popup menu != action area == || ! action area contains evt get x get insets left evt get y get insets top { x y x = 0 y = get height if get parent instanceof j tool bar { j tool bar toolbar = j tool bar get parent if toolbar get orientation == j tool bar v e r t i c a l { y = 0 if toolbar get x > toolbar get parent get insets left { x = popup menu get preferred size width } else { x = get width } } else { if toolbar get y > toolbar get parent get insets top { y = popup menu get preferred size height } } } popup menu show this x y } } } 