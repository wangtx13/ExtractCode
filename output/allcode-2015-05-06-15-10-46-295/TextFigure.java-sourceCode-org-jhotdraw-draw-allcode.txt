org jhotdraw draw import org jhotdraw util * import awt * import awt font * import awt geom * import util * import io * import org jhotdraw draw attribute keys * import org jhotdraw geom * import org jhotdraw xml dom input import org jhotdraw xml dom output text figure attributed figure implements text holder { point2 d origin = new point2 d private editable = transient private text layout text layout text figure { this text } text figure text { set text text } get text { get attribute t e x t } set text new text { set attribute t e x t new text } basic transform affine transform tx { tx transform origin origin } basic set bounds point2 d anchor point2 d { origin = new point2 d anchor x anchor y } contains point2 d p { if get bounds contains p { } if decorator != { update decorator bounds decorator contains p } } draw stroke awt graphics2 d g { } draw fill awt graphics2 d g { } draw text awt graphics2 d g { if get text != || is editable { text layout layout = get text layout layout draw g float origin x float origin y + layout get ascent } } invalidate { super invalidate text layout = } text layout get text layout { if text layout == { text = get text if text == || text length == 0 { text = } font render context frc = get font render context hash map< text attribute object> text attributes = new hash map< text attribute object> text attributes put text attribute f o n t get font if FONT_UNDERLINED get this { text attributes put text attribute u n d e r l i n e text attribute UNDERLINE_LOW_ONE_PIXEL } text layout = new text layout text text attributes frc } text layout } rectangle2 d get bounds { text layout layout = get text layout rectangle2 d r = new rectangle2 d origin x origin y layout get advance layout get ascent + layout get descent r } dimension2 d get preferred size { rectangle2 d b = get bounds new dimension2 d b width b height } rectangle2 d get figure draw bounds { if get text == { get bounds } else { text layout layout = get text layout rectangle2 d r = new rectangle2 d origin x origin y layout get advance layout get ascent rectangle2 d l bounds = layout get bounds if ! l bounds is empty ! is na n l bounds get x { r add new rectangle2 d l bounds get x +origin x l bounds get y +origin y+layout get ascent l bounds get width l bounds get height } geom grow r 2d 2d r } } collection< handle> create handles detail level { linked list< handle> handles = new linked list< handle> if detail level == 0 { handles add new move handle this relative locator north west handles add new move handle this relative locator north east handles add new move handle this relative locator south east handles add new font size handle this } handles } validate { super validate text layout = } is editable { editable } set editable b { this editable = b } get text columns { get text == ? 4 math max get text length 4 } tool get tool point2 d p { is editable contains p ? new text tool this } read dom input in i o { set bounds new point2 d in get attribute x 0d in get attribute y 0d new point2 d 0 0 read attributes in } write dom output out i o { rectangle2 d b = get bounds out add attribute x b x out add attribute y b y write attributes out } get tab size { 8 } text holder get label for { this } insets2 d get insets { new insets2 d 0 0 0 0 } restore to geometry { point2 d p = point2 d geometry origin x = p x origin y = p y } get restore data { origin clone } text figure clone { text figure that = text figure super clone that origin = point2 d this origin clone that text layout = that } font get font { attribute keys get font this } color get text color { TEXT_COLOR get this } color get fill color { FILL_COLOR get this } set font size float size { FONT_SIZE set this new size } float get font size { FONT_SIZE get this float value } } 