net n3 nanoxml import util hashtable import io reader import io reader xml entity resolver implements i xml entity resolver { private hashtable entities xml entity resolver { this entities = new hashtable this entities put amp #38 this entities put #34 this entities put apos #39 this entities put lt #60 this entities put #62 } finalize throwable { this entities clear this entities = super finalize } add internal entity name value { if ! this entities contains key name { this entities put name value } } add external entity name publicid systemid { if ! this entities contains key name { this entities put name new { publicid systemid } } } reader get entity i xml reader xml reader name xml parse { obj = this entities get name if obj == { } else if obj instanceof lang { new reader obj } else { = obj this open external entity xml reader 0 1 } } is external entity name { obj = this entities get name ! obj instanceof lang } reader open external entity i xml reader xml reader publicid systemid xml parse { parent systemid = xml reader get systemid try { xml reader open stream publicid systemid } catch e { throw new xml parse parent systemid xml reader get line nr could not open external entity + at + systemid } } } 