org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import awt event * import javax swing event * import util * import org jhotdraw geom * text area tool creation tool implements action listener { private floating text area text area private text holder typing target text area tool text holder prototype { super prototype } deactivate drawing editor editor { end edit super deactivate editor } mouse pressed mouse event e { text holder text holder = figure pressed figure = get drawing find figure inside get view view to drawing new point e get x e get y if pressed figure instanceof text holder { text holder = text holder pressed figure if !text holder is editable text holder = } if text holder != { created figure = begin edit text holder } if typing target != { end edit fire tool done } else { super mouse pressed e } } begin edit text holder text holder { if text area == { text area = new floating text area } if text holder != typing target typing target != { end edit } text area create overlay get view text holder text area set bounds get field bounds text holder text holder get text text area request focus typing target = text holder } private rectangle2 d get field bounds text holder figure { rectangle2 d r = figure get bounds insets2 d insets = figure get insets r = new rectangle2 d r x + insets left r y + insets top r width insets left insets right r height insets top insets bottom r x = 1 r y = 2 r width += 18 r height += 4 r } mouse released mouse event evt { if created figure != { text holder text holder = text holder created figure rectangle2 d bounds = created figure get bounds if bounds width == 0 bounds height == 0 { get drawing remove created figure } else { if bounds width < 5 bounds height < 5 { created figure will change created figure basic set bounds new point2 d bounds x bounds y new point2 d bounds x + 100 bounds y + 100 created figure changed } get view add to selection created figure } if created figure instanceof composite figure { composite figure created figure layout } created figure = get drawing fire undoable edit happened creation edit begin edit text holder } } end edit { if typing target != { if text area get text length > 0 { typing target set text text area get text if created figure != { get drawing fire undoable edit happened creation edit created figure = } } else { if created figure != { get drawing remove figure get added figure } else { typing target set text } } typing target = text area end overlay } } action performed action event event { end edit fire tool done } } 