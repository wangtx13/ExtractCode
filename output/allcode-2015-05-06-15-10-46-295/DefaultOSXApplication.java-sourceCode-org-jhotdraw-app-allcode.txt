org jhotdraw app import org jhotdraw app action o s x drop on dock action import ch randelshofer quaqua * import org jhotdraw util * import org jhotdraw util prefs * import util * import util prefs * import awt event * import beans * import awt * import javax swing * import io * import org jhotdraw app action about action import org jhotdraw app action actions import org jhotdraw app action clear recent files action import org jhotdraw app action close action import org jhotdraw app action copy action import org jhotdraw app action cut action import org jhotdraw app action delete action import org jhotdraw app action duplicate action import org jhotdraw app action exit action import org jhotdraw app action export action import org jhotdraw app action focus action import org jhotdraw app action maximize action import org jhotdraw app action minimize action import org jhotdraw app action new action import org jhotdraw app action o s x toggle palette action import org jhotdraw app action open action import org jhotdraw app action open recent action import org jhotdraw app action paste action import org jhotdraw app action redo action import org jhotdraw app action save action import org jhotdraw app action save as action import org jhotdraw app action select all action import org jhotdraw app action undo action default o s x application application { private o s x palette handler palette handler private project current project private preferences prefs private linked list< action> palette actions default o s x application { } init { super init prefs = preferences user node for get model == ? get get model get init look and feel palette handler = new o s x palette handler this init labels init application actions palette actions = new linked list< action> init palettes palette actions init screen menu bar } launch args { set property apple awt graphics use quartz super launch args } init look and feel { set property apple laf use screen menu bar set property com apple macos use screen menu bar try { u i manager set look and feel quaqua manager get look and feel name } catch e { e print stack trace } } init application actions { application model mo = get model mo put action about action new about action this mo put action exit action new exit action this mo put action o s x drop on dock action new o s x drop on dock action this mo put action new action new new action this mo put action open action new open action this mo put action clear recent files action new clear recent files action this mo put action save action new save action this mo put action save as action new save as action this mo put action close action new close action this mo put action undo action new undo action this mo put action redo action new redo action this mo put action cut action new cut action mo put action copy action new copy action mo put action paste action new paste action mo put action delete action new delete action mo put action duplicate action new duplicate action mo put action select all action new select all action mo put action maximize action new maximize action this mo put action minimize action new minimize action this } init project actions project p { p put action focus action new focus action p } add palette window palette { palette handler add palette palette } remove palette window palette { palette handler remove palette palette } show project p { if ! p is showing { p set showing = p get j frame f = new j frame title if == { title = labels get unnamed } else { title = get name } f set title labels get formatted frame title title get name p get multiple open f set default close operation j frame DO_NOTHING_ON_CLOSE f set preferred size new dimension 400 400 preferences util install frame prefs handler prefs project f point loc = f get location moved do { moved = for iterator i=projects iterator i has next { project a project = project i next if a project != p a project is showing swing utilities get window ancestor a project get component get location equals loc { loc x += 22 loc y += 22 moved = break } } } while moved f set location loc palette handler add f p f add window listener new window adapter { window closing window event evt { set current project p get model get action close action action performed new action event f action event ACTION_PERFORMED window closing } } p add property change listener new property change listener { property change property change event evt { name = evt get property name if name equals has unsaved changes { f get root pane put client property window modified new p has unsaved changes } else if name equals { f set title p get == ? unnamed p get get name } } } f set j menu bar create menu bar p f get content pane add p get component f set visible } } hide project p { if p is showing { j frame f = j frame swing utilities get window ancestor p get component f set visible f remove p get component palette handler remove f p f dispose } } j menu bar create menu bar project p { resource bundle util labels = resource bundle util get l a f bundle org jhotdraw app labels application model model = get model j menu bar mb = new j menu bar j menu m j menu item mi j menu open recent menu m = new j menu labels configure menu m mi = m add model get action new action mi set icon mi = m add model get action open action mi set icon open recent menu = new j menu labels configure menu open recent menu open recent open recent menu add model get action clear recent files action update open recent menu open recent menu m add open recent menu m add separator mi = m add model get action close action mi set icon mi = m add model get action save action mi set icon mi = m add model get action save as action mi set icon if model get action export action != { mi = m add model get action export action mi set icon } mb add m m = new j menu labels configure menu m edit mi = m add model get action undo action mi set icon mi = m add model get action redo action mi set icon m add separator mi = m add model get action cut action mi set icon mi = m add model get action copy action mi set icon mi = m add model get action paste action mi set icon mi = m add model get action duplicate action mi set icon mi = m add model get action delete action mi set icon m add separator mi = m add model get action select all action mi set icon mb add m for j menu mm model create menus this p { mb add mm } m = new j menu j menu window menu = m labels configure menu m window mi = m add model get action minimize action mi set icon mi = m add model get action maximize action mi set icon m add separator for project pr projects { if pr get action focus action != { window menu add pr get action focus action } } if palette actions size > 0 { m add separator for action a palette actions { j check box menu item cbmi = new j check box menu item a actions configure j check box menu item cbmi a cbmi set icon m add cbmi } } mb add m add property change listener new property change listener { property change property change event evt { name = evt get property name if name == project count { if p == || projects contains p { j menu m = window menu m remove all m add get model get action minimize action m add get model get action maximize action m add separator for iterator i=projects iterator i has next { project pr = project i next if pr get action focus action != { m add pr get action focus action } } if palette actions size > 0 { m add separator for action a palette actions { j check box menu item cbmi = new j check box menu item a actions configure j check box menu item cbmi a cbmi set icon m add cbmi } } } else { remove property change listener this } } else if name == recent files { update open recent menu open recent menu } } } mb } private update open recent menu j menu open recent menu { if open recent menu get item count > 0 { j menu item clear recent files item = j menu item open recent menu get item open recent menu get item count 1 open recent menu remove all for f recent files { open recent menu add new open recent action default o s x application this f } if recent files size > 0 { open recent menu add separator } open recent menu add clear recent files item } } project get current project { current project } set current project project new value { project old value = current project current project = new value fire property change current project old value new value } init screen menu bar { application model model = get model net roydesign app application mrjapp = net roydesign app application get instance mrjapp set frameless j menu bar create menu bar mrjapp get about j menu item set action model get action about action mrjapp get quit j menu item set action model get action exit action mrjapp add open document listener model get action o s x drop on dock action } init palettes linked list< action> palette actions { linked list< j tool bar> tool bars = new linked list< j tool bar> get model create tool bars this j tool bar stb = new j tool bar stb set name labels get standard tool bar title add standard actions to stb tool bars add first stb i=0 x=0 for j tool bar tb tool bars { i++ tb set floatable tb set orientation j tool bar v e r t i c a l tb set focusable j frame d = new j frame d set focusable d set resizable d get content pane set layout new border layout d get content pane add tb border layout c e n t e r d set always on top d set undecorated d get root pane set window decoration style j root pane f r a m e d get root pane set font new font lucida grande font p l a i n 11 d get root pane put client property quaqua root pane is vertical f a l s e d get root pane put client property quaqua root pane is palette t r u e d set j menu bar create menu bar d pack d set focusable window state preferences util install palette prefs handler prefs toolbar +i d x x += d get width palette actions add new o s x toggle palette action this d tb get name add palette d } } add standard actions to j tool bar tb { j button b application model mo = get model b = tb add mo get action new action b set focusable b = tb add mo get action open action b set focusable b = tb add mo get action save action tb add separator b = tb add mo get action undo action b set focusable b = tb add mo get action redo action b set focusable tb add separator b = tb add mo get action cut action b set focusable b = tb add mo get action copy action b set focusable b = tb add mo get action paste action b set focusable } is sharing tools among projects { } component get component { } } 