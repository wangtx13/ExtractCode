org jhotdraw draw import awt * import awt geom * import util * import io * import org jhotdraw draw attribute keys * import org jhotdraw geom * import org jhotdraw xml dom input import org jhotdraw xml dom output attributed composite figure composite figure { private hash map< attribute key object> attributes = new hash map< attribute key object> private hash set< attribute key> forbidden attributes attributed composite figure { } set attribute attribute key key new value { if forbidden attributes == || ! forbidden attributes contains key { old value = attributes get key if ! attributes contains key key || old value != new value || old value != new value != ! old value equals new value { will change basic set attribute key new value fire attribute changed key old value new value fire undoable edit happened new attribute change edit this key old value new value changed } } } set attribute enabled attribute key key b { if forbidden attributes == { forbidden attributes = new hash set< attribute key> } if b { forbidden attributes remove key } else { forbidden attributes add key } } is attribute enabled attribute key key { forbidden attributes == || ! forbidden attributes contains key } set attributes hash map< attribute key object> map { for map entry< attribute key object> entry map entry set { set attribute entry get key entry get value } } map< attribute key object> get attributes { new hash map< attribute key object> attributes } basic set attribute attribute key key new value { if forbidden attributes == || ! forbidden attributes contains key { attributes put key new value } basic set attribute on children key new value } basic set attribute on children attribute key key new value { for figure child get children { child basic set attribute key new value } } get attribute attribute key key { has attribute key ? attributes get key key get default value } draw figure graphics2 d g { draw children g if attribute keys FILL_COLOR get this != { g set color attribute keys FILL_COLOR get this draw fill g } if STROKE_COLOR get this != STROKE_WIDTH get this > 0d { g set stroke attribute keys get stroke this g set color STROKE_COLOR get this draw stroke g } if TEXT_COLOR get this != { if TEXT_SHADOW_COLOR get this != TEXT_SHADOW_OFFSET get this != { dimension2 d d = TEXT_SHADOW_OFFSET get this g translate d width d height g set color TEXT_SHADOW_COLOR get this draw text g g translate d width d height } g set color TEXT_COLOR get this draw text g } if is connectors visible { draw connectors g } } draw children graphics2 d g { for figure child get children { child draw g } } draw connectors graphics2 d g { } stroke get stroke { attribute keys get stroke this } get stroke miter limit factor { number value = number get attribute attribute keys STROKE_MITER_LIMIT_FACTOR value != ? value value 10f } rectangle2 d get figure draw bounds { width = attribute keys get stroke total width this / 2d if STROKE_JOIN get this == basic stroke JOIN_MITER { width *= STROKE_MITER_LIMIT_FACTOR get this } width++ rectangle2 d r = get bounds geom grow r width width r } draw fill awt graphics2 d g draw stroke awt graphics2 d g draw text awt graphics2 d g { } attributed composite figure clone { attributed composite figure that = attributed composite figure super clone that attributes = new hash map< attribute key object> this attributes if this forbidden attributes != { that forbidden attributes = new hash set< attribute key> this forbidden attributes } that } write attributes dom output out i o { figure prototype = figure out get prototype is element open = for map entry< attribute key object> entry attributes entry set { attribute key key = entry get key if forbidden attributes == || ! forbidden attributes contains key { prototype value = key get prototype attribute value = key get this if prototype value != attribute value || prototype value != attribute value != ! prototype value equals attribute value { if ! is element open { out open element a is element open = } out open element key get key out write entry get value out close element } } } if is element open { out close element } } read attributes dom input in i o { if in get element count a > 0 { in open element a for i=in get element count 1 i >= 0 i { in open element i name = in get tag name value = in read attribute key key = get attribute key name if key != key is assignable value { if forbidden attributes == || ! forbidden attributes contains key { set attribute key value } } in close element } in close element } } attribute key get attribute key name { attribute keys supported attribute map get name } apply attributes to figure that { for map entry< attribute key object> entry attributes entry set { that set attribute entry get key entry get value } } write dom output out i o { super write out write attributes out } read dom input in i o { super read in read attributes in } remove attribute attribute key key { if has attribute key { old value = get attribute key attributes remove key fire attribute changed key old value key get default value } } has attribute attribute key key { attributes contains key key } } 