org jhotdraw app import org jhotdraw app action osxdropondockaction o s x drop on dock action import ch randelshofer quaqua * import org jhotdraw util * import org jhotdraw util prefs * import util * import util prefs * import awt event * import beans * import awt * import javax swing * import io * import org jhotdraw app action aboutaction about action import org jhotdraw app action actions import org jhotdraw app action clearrecentfilesaction clear recent files action import org jhotdraw app action closeaction close action import org jhotdraw app action copyaction copy action import org jhotdraw app action cutaction cut action import org jhotdraw app action deleteaction delete action import org jhotdraw app action duplicateaction duplicate action import org jhotdraw app action exitaction exit action import org jhotdraw app action exportaction export action import org jhotdraw app action focusaction focus action import org jhotdraw app action maximizeaction maximize action import org jhotdraw app action minimizeaction minimize action import org jhotdraw app action newaction new action import org jhotdraw app action osxtogglepaletteaction o s x toggle palette action import org jhotdraw app action openaction open action import org jhotdraw app action openrecentaction open recent action import org jhotdraw app action pasteaction paste action import org jhotdraw app action redoaction redo action import org jhotdraw app action saveaction save action import org jhotdraw app action saveasaction save as action import org jhotdraw app action selectallaction select all action import org jhotdraw app action undoaction undo action defaultosxapplication default o s x application abstractapplication application { private osxpalettehandler o s x palette handler palettehandler palette handler private project currentproject current project private preferences prefs private linkedlist<action> linked list< action> paletteactions palette actions defaultosxapplication default o s x application { } init { super init prefs = preferences usernodeforpackage user node for getmodel get model == ? getclass get getmodel get model getclass get initlookandfeel init look and feel palettehandler palette handler = new osxpalettehandler o s x palette handler this initlabels init labels initapplicationactions init application actions paletteactions palette actions = new linkedlist<action> linked list< action> initpalettes init palettes paletteactions palette actions initscreenmenubar init screen menu bar } launch args { setproperty set property apple awt graphics usequartz use quartz super launch args } initlookandfeel init look and feel { setproperty set property apple laf usescreenmenubar use screen menu bar setproperty set property com apple macos usescreenmenubar use screen menu bar try { uimanager u i manager setlookandfeel set look and feel quaquamanager quaqua manager getlookandfeelclassname get look and feel name } catch e { e printstacktrace print stack trace } } initapplicationactions init application actions { applicationmodel application model mo = getmodel get model mo putaction put action aboutaction about action new aboutaction about action this mo putaction put action exitaction exit action new exitaction exit action this mo putaction put action osxdropondockaction o s x drop on dock action new osxdropondockaction o s x drop on dock action this mo putaction put action newaction new action new newaction new action this mo putaction put action openaction open action new openaction open action this mo putaction put action clearrecentfilesaction clear recent files action new clearrecentfilesaction clear recent files action this mo putaction put action saveaction save action new saveaction save action this mo putaction put action saveasaction save as action new saveasaction save as action this mo putaction put action closeaction close action new closeaction close action this mo putaction put action undoaction undo action new undoaction undo action this mo putaction put action redoaction redo action new redoaction redo action this mo putaction put action cutaction cut action new cutaction cut action mo putaction put action copyaction copy action new copyaction copy action mo putaction put action pasteaction paste action new pasteaction paste action mo putaction put action deleteaction delete action new deleteaction delete action mo putaction put action duplicateaction duplicate action new duplicateaction duplicate action mo putaction put action selectallaction select all action new selectallaction select all action mo putaction put action maximizeaction maximize action new maximizeaction maximize action this mo putaction put action minimizeaction minimize action new minimizeaction minimize action this } initprojectactions init project actions project p { p putaction put action focusaction focus action new focusaction focus action p } addpalette add palette window palette { palettehandler palette handler addpalette add palette palette } removepalette remove palette window palette { palettehandler palette handler removepalette remove palette palette } show project p { if ! p isshowing is showing { p setshowing set showing = p getfile get jframe j frame f = new jframe j frame title if == { title = labels getstring get unnamedfile unnamed } else { title = getname get name } f settitle set title labels getformatted get formatted frametitle frame title title getname get name p getmultipleopenid get multiple open f setdefaultcloseoperation set default close operation jframe j frame DO_NOTHING_ON_CLOSE f setpreferredsize set preferred size new dimension 400 400 preferencesutil preferences util installframeprefshandler install frame prefs handler prefs project f point loc = f getlocation get location moved do { moved = for iterator i=projects iterator i hasnext has next { project aproject a project = project i next if aproject a project != p aproject a project isshowing is showing swingutilities swing utilities getwindowancestor get window ancestor aproject a project getcomponent get component getlocation get location equals loc { loc x += 22 loc y += 22 moved = break } } } while moved f setlocation set location loc palettehandler palette handler add f p f addwindowlistener add window listener new windowadapter window adapter { windowclosing window closing windowevent window event evt { setcurrentproject set current project p getmodel get model getaction get action closeaction close action actionperformed action performed new actionevent action event f actionevent action event ACTION_PERFORMED windowclosing window closing } } p addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name if name equals hasunsavedchanges has unsaved changes { f getrootpane get root pane putclientproperty put client property windowmodified window modified new p hasunsavedchanges has unsaved changes } else if name equals { f settitle set title p getfile get == ? unnamed p getfile get getname get name } } } f setjmenubar set j menu bar createmenubar create menu bar p f getcontentpane get content pane add p getcomponent get component f setvisible set visible } } hide project p { if p isshowing is showing { jframe j frame f = jframe j frame swingutilities swing utilities getwindowancestor get window ancestor p getcomponent get component f setvisible set visible f remove p getcomponent get component palettehandler palette handler remove f p f dispose } } jmenubar j menu bar createmenubar create menu bar project p { resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw app labels applicationmodel application model model = getmodel get model jmenubar j menu bar mb = new jmenubar j menu bar jmenu j menu m jmenuitem j menu item mi jmenu j menu openrecentmenu open recent menu m = new jmenu j menu labels configuremenu configure menu m mi = m add model getaction get action newaction new action mi seticon set icon mi = m add model getaction get action openaction open action mi seticon set icon openrecentmenu open recent menu = new jmenu j menu labels configuremenu configure menu openrecentmenu open recent menu openrecent open recent openrecentmenu open recent menu add model getaction get action clearrecentfilesaction clear recent files action updateopenrecentmenu update open recent menu openrecentmenu open recent menu m add openrecentmenu open recent menu m addseparator add separator mi = m add model getaction get action closeaction close action mi seticon set icon mi = m add model getaction get action saveaction save action mi seticon set icon mi = m add model getaction get action saveasaction save as action mi seticon set icon if model getaction get action exportaction export action != { mi = m add model getaction get action exportaction export action mi seticon set icon } mb add m m = new jmenu j menu labels configuremenu configure menu m edit mi = m add model getaction get action undoaction undo action mi seticon set icon mi = m add model getaction get action redoaction redo action mi seticon set icon m addseparator add separator mi = m add model getaction get action cutaction cut action mi seticon set icon mi = m add model getaction get action copyaction copy action mi seticon set icon mi = m add model getaction get action pasteaction paste action mi seticon set icon mi = m add model getaction get action duplicateaction duplicate action mi seticon set icon mi = m add model getaction get action deleteaction delete action mi seticon set icon m addseparator add separator mi = m add model getaction get action selectallaction select all action mi seticon set icon mb add m for jmenu j menu mm model createmenus create menus this p { mb add mm } m = new jmenu j menu jmenu j menu windowmenu window menu = m labels configuremenu configure menu m window mi = m add model getaction get action minimizeaction minimize action mi seticon set icon mi = m add model getaction get action maximizeaction maximize action mi seticon set icon m addseparator add separator for project pr projects { if pr getaction get action focusaction focus action != { windowmenu window menu add pr getaction get action focusaction focus action } } if paletteactions palette actions size > 0 { m addseparator add separator for action a paletteactions palette actions { jcheckboxmenuitem j check box menu item cbmi = new jcheckboxmenuitem j check box menu item a actions configurejcheckboxmenuitem configure j check box menu item cbmi a cbmi seticon set icon m add cbmi } } mb add m addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name if name == projectcount project count { if p == || projects contains p { jmenu j menu m = windowmenu window menu m removeall remove all m add getmodel get model getaction get action minimizeaction minimize action m add getmodel get model getaction get action maximizeaction maximize action m addseparator add separator for iterator i=projects iterator i hasnext has next { project pr = project i next if pr getaction get action focusaction focus action != { m add pr getaction get action focusaction focus action } } if paletteactions palette actions size > 0 { m addseparator add separator for action a paletteactions palette actions { jcheckboxmenuitem j check box menu item cbmi = new jcheckboxmenuitem j check box menu item a actions configurejcheckboxmenuitem configure j check box menu item cbmi a cbmi seticon set icon m add cbmi } } } else { removepropertychangelistener remove property change listener this } } else if name == recentfiles recent files { updateopenrecentmenu update open recent menu openrecentmenu open recent menu } } } mb } private updateopenrecentmenu update open recent menu jmenu j menu openrecentmenu open recent menu { if openrecentmenu open recent menu getitemcount get item count > 0 { jmenuitem j menu item clearrecentfilesitem clear recent files item = jmenuitem j menu item openrecentmenu open recent menu getitem get item openrecentmenu open recent menu getitemcount get item count 1 openrecentmenu open recent menu removeall remove all for f recentfiles recent files { openrecentmenu open recent menu add new openrecentaction open recent action defaultosxapplication default o s x application this f } if recentfiles recent files size > 0 { openrecentmenu open recent menu addseparator add separator } openrecentmenu open recent menu add clearrecentfilesitem clear recent files item } } project getcurrentproject get current project { currentproject current project } setcurrentproject set current project project newvalue new value { project oldvalue old value = currentproject current project currentproject current project = newvalue new value firepropertychange fire property change currentproject current project oldvalue old value newvalue new value } initscreenmenubar init screen menu bar { applicationmodel application model model = getmodel get model net roydesign app application mrjapp = net roydesign app application getinstance get instance mrjapp setframelessjmenubar set frameless j menu bar createmenubar create menu bar mrjapp getaboutjmenuitem get about j menu item setaction set action model getaction get action aboutaction about action mrjapp getquitjmenuitem get quit j menu item setaction set action model getaction get action exitaction exit action mrjapp addopendocumentlistener add open document listener model getaction get action osxdropondockaction o s x drop on dock action } initpalettes init palettes linkedlist<action> linked list< action> paletteactions palette actions { linkedlist<jtoolbar> linked list< j tool bar> toolbars tool bars = new linkedlist<jtoolbar> linked list< j tool bar> getmodel get model createtoolbars create tool bars this jtoolbar j tool bar stb = new jtoolbar j tool bar stb setname set name labels getstring get standardtoolbartitle standard tool bar title addstandardactionsto add standard actions to stb toolbars tool bars addfirst add first stb i=0 x=0 for jtoolbar j tool bar tb toolbars tool bars { i++ tb setfloatable set floatable tb setorientation set orientation jtoolbar j tool bar vertical v e r t i c a l tb setfocusable set focusable jframe j frame d = new jframe j frame d setfocusable set focusable d setresizable set resizable d getcontentpane get content pane setlayout set layout new borderlayout border layout d getcontentpane get content pane add tb borderlayout border layout center c e n t e r d setalwaysontop set always on top d setundecorated set undecorated d getrootpane get root pane setwindowdecorationstyle set window decoration style jrootpane j root pane frame f r a m e d getrootpane get root pane setfont set font new font lucida grande font plain p l a i n 11 d getrootpane get root pane putclientproperty put client property quaqua rootpane root pane isvertical is vertical false f a l s e d getrootpane get root pane putclientproperty put client property quaqua rootpane root pane ispalette is palette true t r u e d setjmenubar set j menu bar createmenubar create menu bar d pack d setfocusablewindowstate set focusable window state preferencesutil preferences util installpaletteprefshandler install palette prefs handler prefs toolbar +i d x x += d getwidth get width paletteactions palette actions add new osxtogglepaletteaction o s x toggle palette action this d tb getname get name addpalette add palette d } } addstandardactionsto add standard actions to jtoolbar j tool bar tb { jbutton j button b applicationmodel application model mo = getmodel get model b = tb add mo getaction get action newaction new action b setfocusable set focusable b = tb add mo getaction get action openaction open action b setfocusable set focusable b = tb add mo getaction get action saveaction save action tb addseparator add separator b = tb add mo getaction get action undoaction undo action b setfocusable set focusable b = tb add mo getaction get action redoaction redo action b setfocusable set focusable tb addseparator add separator b = tb add mo getaction get action cutaction cut action b setfocusable set focusable b = tb add mo getaction get action copyaction copy action b setfocusable set focusable b = tb add mo getaction get action pasteaction paste action b setfocusable set focusable } issharingtoolsamongprojects is sharing tools among projects { } component getcomponent get component { } } 