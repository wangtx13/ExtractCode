org jhotdraw draw import org jhotdraw geom dimension2ddouble dimension2 d import org jhotdraw geom geom import org jhotdraw util * import awt * import awt geom * import org jhotdraw xml dominput dom input import org jhotdraw xml domoutput dom output import org jhotdraw xml domstorable dom storable bezierlabellocator bezier label locator implements locator domstorable dom storable { private relativeposition relative position private angle private distance bezierlabellocator bezier label locator { } bezierlabellocator bezier label locator relativeposition relative position angle distance { this relativeposition relative position = relativeposition relative position this angle = angle this distance = distance } point2d point2 d locate figure owner { getrelativepoint get relative point bezierfigure bezier figure owner } point2d point2 d locate figure owner figure label { point2d point2 d relativepoint relative point = getrelativelabelpoint get relative label point bezierfigure bezier figure owner label relativepoint relative point } point2d point2 d getrelativepoint get relative point bezierfigure bezier figure owner { point2d point2 d point = owner getpointonpath get point on path float relativeposition relative position 3 point2d point2 d nextpoint next point = owner getpointonpath get point on path relativeposition relative position < 0 5 ? float relativeposition relative position + 0 1f float relativeposition relative position 0 1f 3 dir = math atan2 nextpoint next point y point y nextpoint next point x point x if relativeposition relative position >= 0 5 { dir += math pi p i } alpha = dir + angle point2d point2 d p = new point2d point2 d point x + distance * math cos alpha point y + distance * math sin alpha if isnan is na n p x p = point p } point2d point2 d getrelativelabelpoint get relative label point bezierfigure bezier figure owner figure label { point2d point2 d point = owner getpointonpath get point on path float relativeposition relative position 3 if point == { new point2d point2 d 0 0 } point2d point2 d nextpoint next point = owner getpointonpath get point on path relativeposition relative position < 0 5 ? float relativeposition relative position + 0 1f float relativeposition relative position 0 1f 3 dir = math atan2 nextpoint next point y point y nextpoint next point x point x if relativeposition relative position >= 0 5 { dir += math pi p i } alpha = dir + angle point2d point2 d p = new point2d point2 d point x + distance * math cos alpha point y + distance * math sin alpha if isnan is na n p x p = point dimension2ddouble dimension2 d labeldim label dim = label getpreferredsize get preferred size if relativeposition relative position == 0 5 p x >= point x distance / 2 p x <= point x + distance / 2 { if p y >= point y { new point2d point2 d p x labeldim label dim width / 2 p y } else { new point2d point2 d p x labeldim label dim width / 2 p y labeldim label dim height } } else { if p x >= point x { if p y >= point y { new point2d point2 d p x p y } else { new point2d point2 d p x p y labeldim label dim height } } else { if p y >= point y { new point2d point2 d p x labeldim label dim width p y } else { new point2d point2 d p x labeldim label dim width p y labeldim label dim height } } } } read dominput dom input in { relativeposition relative position = in getattribute get attribute relativeposition relative position 0d angle = in getattribute get attribute angle 0d distance = in getattribute get attribute distance 0 } write domoutput dom output out { out addattribute add attribute relativeposition relative position relativeposition relative position out addattribute add attribute angle angle out addattribute add attribute distance distance } } 