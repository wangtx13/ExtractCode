org jhotdraw app action import awt * import awt event * import javax swing * import io * import org jhotdraw app * import org jhotdraw io * import org jhotdraw util * import org jhotdraw gui * import org jhotdraw gui event * saveaction save action abstractprojectaction project action { = save private saveas save as private component oldfocusowner old focus owner saveaction save action application app { this app } saveaction save action application app saveas save as { super app this saveas save as = saveas save as resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw app labels labels configureaction configure action this } actionperformed action performed actionevent action event evt { project project = getcurrentproject get current project if project isenabled is enabled { oldfocusowner old focus owner = swingutilities swing utilities getwindowancestor get window ancestor project getcomponent get component getfocusowner get focus owner project setenabled set enabled savetofile save to if !saveas !save as project getfile get != { savetofile save to project project getfile get } else { jfilechooser j chooser filechooser chooser = project getsavechooser get save chooser jsheet j sheet showsavesheet show save sheet filechooser chooser project getcomponent get component new sheetlistener sheet listener { optionselected option selected sheetevent sheet event evt { if evt getoption get option == jfilechooser j chooser APPROVE_OPTION { if evt getfilechooser get chooser getfilefilter get filter instanceof extensionfilefilter extension filter { = extensionfilefilter extension filter evt getfilechooser get chooser getfilefilter get filter makeacceptable make acceptable evt getfilechooser get chooser getselectedfile get selected } else { = evt getfilechooser get chooser getselectedfile get selected } savetofile save to project } else { project setenabled set enabled if oldfocusowner old focus owner != { oldfocusowner old focus owner requestfocus request focus } } } } } } } savetofile save to project project { project execute new worker { construct { try { project write } catch ioexception i o e { e } } finished value { filesaved saved project value } } } filesaved saved project project value { if value == { project setfile set project markchangesassaved mark changes as saved multiopenid multi open = 1 for project p project getapplication get application projects { if p != project p getfile get != p getfile get equals { multiopenid multi open = math max multiopenid multi open p getmultipleopenid get multiple open + 1 } } getapplication get application addrecentfile add recent project setmultipleopenid set multiple open multiopenid multi open } else { jsheet j sheet showmessagesheet show message sheet project getcomponent get component <html> +uimanager + u i manager getstring get optionpane option pane css + <b>couldn't <b> couldn't save to the \ +file+ \ <p> + reason +value joptionpane j option pane ERROR_MESSAGE } project setenabled set enabled swingutilities swing utilities getwindowancestor get window ancestor project getcomponent get component tofront to front if oldfocusowner old focus owner != { oldfocusowner old focus owner requestfocus request focus } } } 