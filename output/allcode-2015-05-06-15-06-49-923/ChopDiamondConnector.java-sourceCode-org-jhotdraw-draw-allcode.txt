org jhotdraw draw import awt * import awt geom * import org jhotdraw draw attributekeys attribute keys * import org jhotdraw geom * chopdiamondconnector chop diamond connector chopboxconnector chop box connector { chopdiamondconnector chop diamond connector { } chopdiamondconnector chop diamond connector figure owner { super owner } point2d point2 d chop figure target point2d point2 d from { target = getconnectortarget get connector target target rectangle2d rectangle2 d r = target getbounds get bounds if diamondfigure diamond figure IS_QUADRATIC get target { side = math max r width r height r x = side r width / 2 r y = side r height / 2 r width = r height = side } growx growy switch STROKE_PLACEMENT get target { case inside i n sid e { growx = growy = 0f break } case outside o u t sid e { linelength line length = math sqrt r width * r width + r height * r height scale = getstroketotalwidth get stroke total width target * 2d / linelength line length growx = scale * r height growy = scale * r width break } case center c e n t e r default linelength line length = math sqrt r width * r width + r height * r height scale = getstroketotalwidth get stroke total width target / linelength line length growx = scale * r height growy = scale * r width break } geom grow r growx growy point2d point2 d c1 = new point2d point2 d r x + r width/2 r y + r height/2 point2d point2 d p2 = new point2d point2 d r x + r width/2 r y + r height point2d point2 d p4 = new point2d point2 d r x + r width/2 r y if r contains from { if from y > r y from y < r y +r height/2 { p2 } else { p4 } } ang = geom pointtoangle point to angle r from point2d point2 d p1 = new point2d point2 d r x + r width r y + r height/2 point2d point2 d p3 = new point2d point2 d r x r y + r height/2 point2d point2 d rp = if ang > 0 ang < 1 57 { rp = geom intersect p1 x p1 y p2 x p2 y c1 x c1 y from x from y } else if ang > 1 575 ang < 3 14 { rp = geom intersect p2 x p2 y p3 x p3 y c1 x c1 y from x from y } else if ang > 3 14 ang < 1 575 { rp = geom intersect p3 x p3 y p4 x p4 y c1 x c1 y from x from y } else if ang > 1 57 ang < 0 { rp = geom intersect p4 x p4 y p1 x p1 y c1 x c1 y from x from y } if rp == { rp = geom angletopoint angle to point r ang } rp } } 