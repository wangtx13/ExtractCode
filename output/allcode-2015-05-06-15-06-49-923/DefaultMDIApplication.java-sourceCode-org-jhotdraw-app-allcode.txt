org jhotdraw app import org jhotdraw gui * import org jhotdraw util * import org jhotdraw util prefs * import awt * import awt event * import beans * import io * import util * import util prefs * import javax swing * import javax swing event * import org jhotdraw app action * defaultmdiapplication default m d i application abstractapplication application { private jframe j frame parentframe parent frame private jscrollpane j scroll pane scrollpane scroll pane private mdidesktoppane m didesktop pane desktoppane desktop pane private preferences prefs private project currentproject current project private linkedlist<action> linked list< action> toolbaractions tool bar actions defaultmdiapplication default m d i application { } initapplicationactions init application actions { applicationmodel application model mo = getmodel get model mo putaction put action aboutaction about action new aboutaction about action this mo putaction put action exitaction exit action new exitaction exit action this mo putaction put action osxdropondockaction o s x drop on dock action new osxdropondockaction o s x drop on dock action this mo putaction put action newaction new action new newaction new action this mo putaction put action openaction open action new openaction open action this mo putaction put action clearrecentfilesaction clear recent files action new clearrecentfilesaction clear recent files action this mo putaction put action saveaction save action new saveaction save action this mo putaction put action saveasaction save as action new saveasaction save as action this mo putaction put action closeaction close action new closeaction close action this mo putaction put action undoaction undo action new undoaction undo action this mo putaction put action redoaction redo action new redoaction redo action this mo putaction put action cutaction cut action new cutaction cut action mo putaction put action copyaction copy action new copyaction copy action mo putaction put action pasteaction paste action new pasteaction paste action mo putaction put action deleteaction delete action new deleteaction delete action mo putaction put action duplicateaction duplicate action new duplicateaction duplicate action mo putaction put action selectallaction select all action new selectallaction select all action mo putaction put action arrangeaction arrange action VERTICAL_ID new arrangeaction arrange action desktoppane desktop pane arrangeable arrangement vertical v e r t i c a l mo putaction put action arrangeaction arrange action HORIZONTAL_ID new arrangeaction arrange action desktoppane desktop pane arrangeable arrangement horizontal h o r i z o n t a l mo putaction put action arrangeaction arrange action CASCADE_ID new arrangeaction arrange action desktoppane desktop pane arrangeable arrangement cascade c a s c a d e } initprojectactions init project actions project p { p putaction put action focusaction focus action new focusaction focus action p } launch args { setproperty set property apple awt graphics usequartz use quartz super launch args } init { super init prefs = preferences usernodeforpackage user node for getmodel get model == ? getclass get getmodel get model getclass get initlookandfeel init look and feel initlabels init labels parentframe parent frame = new jframe j frame getname get name parentframe parent frame setdefaultcloseoperation set default close operation jframe j frame DO_NOTHING_ON_CLOSE desktoppane desktop pane = new mdidesktoppane m didesktop pane scrollpane scroll pane = new jscrollpane j scroll pane scrollpane scroll pane setviewportview set viewport view desktoppane desktop pane toolbaractions tool bar actions = new linkedlist<action> linked list< action> initapplicationactions init application actions parentframe parent frame getcontentpane get content pane add wrapdesktoppane wrap desktop pane scrollpane scroll pane toolbaractions tool bar actions parentframe parent frame addwindowlistener add window listener new windowadapter window adapter { windowclosing window closing windowevent window event evt { getmodel get model getaction get action exitaction exit action actionperformed action performed new actionevent action event parentframe parent frame actionevent action event ACTION_PERFORMED windowclosing window closing } } parentframe parent frame setjmenubar set j menu bar createmenubar create menu bar preferencesutil preferences util installframeprefshandler install frame prefs handler prefs parentframe parent frame parentframe parent frame parentframe parent frame setvisible set visible } initlookandfeel init look and feel { if setproperty set property apple laf usescreenmenubar use screen menu bar setproperty set property com apple macos usescreenmenubar use screen menu bar setproperty set property apple awt graphics usequartz use quartz try { lafname laf name = uimanager u i manager getsystemlookandfeelclassname get look and feel name uimanager u i manager setlookandfeel set look and feel lafname laf name } catch e { e printstacktrace print stack trace } if uimanager u i manager getstring get optionpane option pane css == { uimanager u i manager put optionpane option pane css } } show project p { if ! p isshowing is showing { p setshowing set showing = p getfile get jinternalframe j internal frame f = new jinternalframe j internal frame title if == { title = labels getstring get unnamedfile unnamed } else { title = getname get name } f settitle set title labels getformatted get formatted internalframetitle internal frame title title getname get name p getmultipleopenid get multiple open f setdefaultcloseoperation set default close operation jinternalframe j internal frame DO_NOTHING_ON_CLOSE f setclosable set closable f setmaximizable set maximizable f setresizable set resizable f seticonifiable set iconifiable preferencesutil preferences util installinternalframeprefshandler install internal frame prefs handler prefs project f desktoppane desktop pane point loc = f getlocation get location moved do { moved = for iterator i=projects iterator i hasnext has next { project aproject a project = project i next if aproject a project != p aproject a project isshowing is showing swingutilities swing utilities getrootpane get root pane aproject a project getcomponent get component getparent get parent getlocation get location equals loc { loc x += 22 loc y += 22 moved = break } } } while moved f setlocation set location loc f addinternalframelistener add internal frame listener new internalframeadapter internal frame adapter { @override @ override internalframeclosing internal frame closing internalframeevent internal frame event evt { setcurrentproject set current project p getmodel get model getaction get action closeaction close action actionperformed action performed new actionevent action event f actionevent action event ACTION_PERFORMED windowclosing window closing } } p addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name if name equals hasunsavedchanges has unsaved changes { jinternalframe j internal frame f getrootpane get root pane getparent get parent putclientproperty put client property windowmodified window modified new p hasunsavedchanges has unsaved changes } else if name equals { f settitle set title p getfile get == ? unnamed p getfile get getname get name } } } f addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name if name equals selected { if evt getnewvalue get new value equals true t r u e { setcurrentproject set current project p } } } } f getcontentpane get content pane add p getcomponent get component f setvisible set visible desktoppane desktop pane add f f tofront to front try { f setselected set selected } catch propertyvetoexception property veto e { } p getcomponent get component requestfocusinwindow request focus in window } } hide project p { if p isshowing is showing { jinternalframe j internal frame f = jinternalframe j internal frame swingutilities swing utilities getrootpane get root pane p getcomponent get component getparent get parent f setvisible set visible f remove p getcomponent get component desktoppane desktop pane remove f f dispose } } project getcurrentproject get current project { currentproject current project } setcurrentproject set current project project newvalue new value { project oldvalue old value = currentproject current project currentproject current project = newvalue new value firepropertychange fire property change currentproject current project oldvalue old value newvalue new value } issharingtoolsamongprojects is sharing tools among projects { } component getcomponent get component { parentframe parent frame } component wrapdesktoppane wrap desktop pane component c linkedlist<action> linked list< action> toolbaractions tool bar actions { if getmodel get model != { id=0 for jtoolbar j tool bar tb new reversedlist<jtoolbar> reversed list< j tool bar> getmodel get model createtoolbars create tool bars this { id++ jpanel j panel panel = new jpanel j panel new borderlayout border layout panel add tb borderlayout border layout north n o r t h panel add c borderlayout border layout center c e n t e r c = panel preferencesutil preferences util installtoolbarprefshandler install tool bar prefs handler prefs toolbar +id tb toolbaractions tool bar actions addfirst add first new toggletoolbaraction toggle tool bar action tb tb getname get name } jtoolbar j tool bar tb = new jtoolbar j tool bar tb setname set name labels getstring get standardtoolbartitle standard tool bar title addstandardactionsto add standard actions to tb id++ jpanel j panel panel = new jpanel j panel new borderlayout border layout panel add tb borderlayout border layout north n o r t h panel add c borderlayout border layout center c e n t e r c = panel preferencesutil preferences util installtoolbarprefshandler install tool bar prefs handler prefs toolbar +id tb toolbaractions tool bar actions addfirst add first new toggletoolbaraction toggle tool bar action tb tb getname get name panel putclientproperty put client property toolbaractions tool bar actions toolbaractions tool bar actions } c } addstandardactionsto add standard actions to jtoolbar j tool bar tb { jbutton j button b applicationmodel application model mo = getmodel get model b = tb add mo getaction get action newaction new action b setfocusable set focusable b = tb add mo getaction get action openaction open action b setfocusable set focusable b = tb add mo getaction get action saveaction save action tb addseparator add separator b = tb add mo getaction get action undoaction undo action b setfocusable set focusable b = tb add mo getaction get action redoaction redo action b setfocusable set focusable tb addseparator add separator b = tb add mo getaction get action cutaction cut action b setfocusable set focusable b = tb add mo getaction get action copyaction copy action b setfocusable set focusable b = tb add mo getaction get action pasteaction paste action b setfocusable set focusable } jmenubar j menu bar createmenubar create menu bar { resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw app labels applicationmodel application model mo = getmodel get model jmenubar j menu bar mb = new jmenubar j menu bar jmenu j menu m jmenuitem j menu item mi jmenu j menu openrecentmenu open recent menu m = new jmenu j menu labels configuremenu configure menu m m add mo getaction get action newaction new action m add mo getaction get action openaction open action openrecentmenu open recent menu = new jmenu j menu labels configuremenu configure menu openrecentmenu open recent menu openrecent open recent openrecentmenu open recent menu add mo getaction get action clearrecentfilesaction clear recent files action updateopenrecentmenu update open recent menu openrecentmenu open recent menu m add openrecentmenu open recent menu m addseparator add separator m add mo getaction get action closeaction close action m add mo getaction get action saveaction save action m add mo getaction get action saveasaction save as action if mo getaction get action exportaction export action != { mi = m add mo getaction get action exportaction export action } m addseparator add separator m add mo getaction get action exitaction exit action mb add m m = new jmenu j menu labels configuremenu configure menu m edit m add mo getaction get action undoaction undo action m add mo getaction get action redoaction redo action m addseparator add separator m add mo getaction get action cutaction cut action m add mo getaction get action copyaction copy action m add mo getaction get action pasteaction paste action m add mo getaction get action duplicateaction duplicate action m add mo getaction get action deleteaction delete action m addseparator add separator m add mo getaction get action selectallaction select all action mb add m for jmenu j menu mm mo createmenus create menus this { mb add mm } m = new jmenu j menu jmenu j menu windowmenu window menu = m labels configuremenu configure menu m window m add mo getaction get action arrangeaction arrange action CASCADE_ID m add mo getaction get action arrangeaction arrange action VERTICAL_ID m add mo getaction get action arrangeaction arrange action HORIZONTAL_ID m addseparator add separator for project pr projects { if pr getaction get action focusaction focus action != { windowmenu window menu add pr getaction get action focusaction focus action } } if toolbaractions tool bar actions size > 0 { m addseparator add separator for action a toolbaractions tool bar actions { jcheckboxmenuitem j check box menu item cbmi = new jcheckboxmenuitem j check box menu item a actions configurejcheckboxmenuitem configure j check box menu item cbmi a m add cbmi } } mb add m m = new jmenu j menu labels configuremenu configure menu m labels getstring get help m add mo getaction get action aboutaction about action mb add m addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name applicationmodel application model mo = getmodel get model if name == projectcount project count { jmenu j menu m = windowmenu window menu m removeall remove all m add mo getaction get action arrangeaction arrange action CASCADE_ID m add mo getaction get action arrangeaction arrange action VERTICAL_ID m add mo getaction get action arrangeaction arrange action HORIZONTAL_ID m addseparator add separator for iterator i=projects iterator i hasnext has next { project pr = project i next if pr getaction get action focusaction focus action != { m add pr getaction get action focusaction focus action } } if toolbaractions tool bar actions size > 0 { m addseparator add separator for action a toolbaractions tool bar actions { jcheckboxmenuitem j check box menu item cbmi = new jcheckboxmenuitem j check box menu item a actions configurejcheckboxmenuitem configure j check box menu item cbmi a m add cbmi } } } else if name == recentfiles recent files { updateopenrecentmenu update open recent menu openrecentmenu open recent menu } } } mb } private updateopenrecentmenu update open recent menu jmenu j menu openrecentmenu open recent menu { if openrecentmenu open recent menu getitemcount get item count > 0 { jmenuitem j menu item clearrecentfilesitem clear recent files item = jmenuitem j menu item openrecentmenu open recent menu getitem get item openrecentmenu open recent menu getitemcount get item count 1 openrecentmenu open recent menu removeall remove all for f recentfiles recent files { openrecentmenu open recent menu add new openrecentaction open recent action defaultmdiapplication default m d i application this f } if recentfiles recent files size > 0 { openrecentmenu open recent menu addseparator add separator } openrecentmenu open recent menu add clearrecentfilesitem clear recent files item } } } 