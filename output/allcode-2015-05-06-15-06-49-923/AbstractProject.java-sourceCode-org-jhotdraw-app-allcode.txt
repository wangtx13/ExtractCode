org jhotdraw app import org jhotdraw app action selectallaction select all action import io * import util * import org jhotdraw util * import javax swing * import util concurrent * import util prefs * abstractproject project jpanel j panel implements project { private application application jfilechooser j chooser savechooser save chooser jfilechooser j chooser openchooser open chooser executor executor private hashmap hash map actions private hasunsavedchanges has unsaved changes private preferences prefs private multipleopenid multiple open = 1 private isshowing is showing abstractproject project { } init { prefs = preferences usernodeforpackage user node for getclass get initcomponents init components } private initcomponents init components { setlayout set layout new awt borderlayout border layout } setapplication set application application newvalue new value { application oldvalue old value = application application = newvalue new value firepropertychange fire property change application oldvalue old value newvalue new value } application getapplication get application { application } jcomponent j component getcomponent get component { this } getfile get { } setfile set newvalue new value { oldvalue old value = = newvalue new value if prefs != newvalue new value != { prefs put projectfile project newvalue new value getpath get path } firepropertychange fire property change oldvalue old value newvalue new value } jfilechooser j chooser getopenchooser get open chooser { if openchooser open chooser == { openchooser open chooser = createopenchooser create open chooser } openchooser open chooser } jfilechooser j chooser createopenchooser create open chooser { jfilechooser j chooser c = new jfilechooser j chooser if prefs != { c setselectedfile set selected new prefs get projectfile project getproperty get property user home } c } jfilechooser j chooser getsavechooser get save chooser { if savechooser save chooser == { savechooser save chooser = createsavechooser create save chooser } savechooser save chooser } jfilechooser j chooser createsavechooser create save chooser { jfilechooser j chooser c = new jfilechooser j chooser if prefs != { c setcurrentdirectory set current directory new prefs get projectfile project getproperty get property user home } c } hasunsavedchanges has unsaved changes { hasunsavedchanges has unsaved changes } sethasunsavedchanges set has unsaved changes newvalue new value { oldvalue old value = hasunsavedchanges has unsaved changes hasunsavedchanges has unsaved changes = newvalue new value firepropertychange fire property change hasunsavedchanges has unsaved changes oldvalue old value newvalue new value } dispose { } action getaction get action { actions == ? action actions get } putaction put action action action { if actions == { actions = new hashmap hash map } if action == { actions remove } else { actions put action } } execute runnable worker { if executor == { executor = executors newsinglethreadexecutor new single thread executor } executor execute worker } setmultipleopenid set multiple open newvalue new value { oldvalue old value = multipleopenid multiple open multipleopenid multiple open = newvalue new value firepropertychange fire property change multipleopenid multiple open oldvalue old value newvalue new value } getmultipleopenid get multiple open { multipleopenid multiple open } setshowing set showing newvalue new value { oldvalue old value = isshowing is showing isshowing is showing = newvalue new value firepropertychange fire property change showing oldvalue old value newvalue new value } isshowing is showing { isshowing is showing } markchangesassaved mark changes as saved { sethasunsavedchanges set has unsaved changes } } 