org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import awt event * import javax swing event * import util * import org jhotdraw geom * textareatool text area tool creationtool creation tool implements actionlistener action listener { private floatingtextarea floating text area textarea text area private textholder text holder typingtarget typing target textareatool text area tool textholder text holder prototype { super prototype } deactivate drawingeditor drawing editor editor { endedit end edit super deactivate editor } mousepressed mouse pressed mouseevent mouse event e { textholder text holder textholder text holder = figure pressedfigure pressed figure = getdrawing get drawing findfigureinside find figure inside getview get view viewtodrawing view to drawing new point e getx get x e gety get y if pressedfigure pressed figure instanceof textholder text holder { textholder text holder = textholder text holder pressedfigure pressed figure if !textholder !text holder iseditable is editable textholder text holder = } if textholder text holder != { createdfigure created figure = beginedit begin edit textholder text holder } if typingtarget typing target != { endedit end edit firetooldone fire tool done } else { super mousepressed mouse pressed e } } beginedit begin edit textholder text holder textholder text holder { if textarea text area == { textarea text area = new floatingtextarea floating text area } if textholder text holder != typingtarget typing target typingtarget typing target != { endedit end edit } textarea text area createoverlay create overlay getview get view textholder text holder textarea text area setbounds set bounds getfieldbounds get field bounds textholder text holder textholder text holder gettext get text textarea text area requestfocus request focus typingtarget typing target = textholder text holder } private rectangle2d rectangle2 d getfieldbounds get field bounds textholder text holder figure { rectangle2d rectangle2 d r = figure getbounds get bounds insets2ddouble insets2 d insets = figure getinsets get insets r = new rectangle2d rectangle2 d r x + insets left r y + insets top r width insets left insets right r height insets top insets bottom r x = 1 r y = 2 r width += 18 r height += 4 r } mousereleased mouse released mouseevent mouse event evt { if createdfigure created figure != { textholder text holder textholder text holder = textholder text holder createdfigure created figure rectangle2d rectangle2 d bounds = createdfigure created figure getbounds get bounds if bounds width == 0 bounds height == 0 { getdrawing get drawing remove createdfigure created figure } else { if bounds width < 5 bounds height < 5 { createdfigure created figure willchange will change createdfigure created figure basicsetbounds basic set bounds new point2d point2 d bounds x bounds y new point2d point2 d bounds x + 100 bounds y + 100 createdfigure created figure changed } getview get view addtoselection add to selection createdfigure created figure } if createdfigure created figure instanceof compositefigure composite figure { compositefigure composite figure createdfigure created figure layout } createdfigure created figure = getdrawing get drawing fireundoableedithappened fire undoable edit happened creationedit creation edit beginedit begin edit textholder text holder } } endedit end edit { if typingtarget typing target != { if textarea text area gettext get text length > 0 { typingtarget typing target settext set text textarea text area gettext get text if createdfigure created figure != { getdrawing get drawing fireundoableedithappened fire undoable edit happened creationedit creation edit createdfigure created figure = } } else { if createdfigure created figure != { getdrawing get drawing remove figure getaddedfigure get added figure } else { typingtarget typing target settext set text } } typingtarget typing target = textarea text area endoverlay end overlay } } actionperformed action performed actionevent action event event { endedit end edit firetooldone fire tool done } } 