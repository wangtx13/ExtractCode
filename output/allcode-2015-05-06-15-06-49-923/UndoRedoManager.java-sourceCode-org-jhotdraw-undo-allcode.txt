org jhotdraw undo import awt event * import beans * import javax swing * import javax swing event * import javax swing undo * import util * import org jhotdraw util * undoredomanager undo redo manager undomanager undo manager { propertychangesupport property change support propertysupport property support = new propertychangesupport property change support this private debug d e b u g = private resourcebundleutil resource bundle util labels private hassignificantedits has significant edits = private undoorredoinprogress undo or redo in progress undoableedit undoable edit DISCARD_ALL_EDITS = new abstractundoableedit undoable edit { canundo can undo { } canredo can redo { } } private undoaction undo action abstractaction action { undoaction undo action { labels configureaction configure action this undo setenabled set enabled } actionperformed action performed actionevent action event evt { try { undo } catch cannotundoexception cannot undo e { err cannot undo +e e printstacktrace print stack trace } } } private redoaction redo action abstractaction action { redoaction redo action { labels configureaction configure action this redo setenabled set enabled } actionperformed action performed actionevent action event evt { try { redo } catch cannotredoexception cannot redo e { out cannot redo +e } } } private undoaction undo action undoaction undo action private redoaction redo action redoaction redo action resourcebundleutil resource bundle util getlabels get labels { if labels == { labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw undo labels } labels } undoredomanager undo redo manager { getlabels get labels undoaction undo action = new undoaction undo action redoaction redo action = new redoaction redo action } setlocale set locale locale l { labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw undo labels l } discardalledits discard all edits { super discardalledits discard all edits updateactions update actions sethassignificantedits set has significant edits } sethassignificantedits set has significant edits newvalue new value { oldvalue old value = hassignificantedits has significant edits hassignificantedits has significant edits = newvalue new value firepropertychange fire property change hassignificantedits has significant edits oldvalue old value newvalue new value } hassignificantedits has significant edits { hassignificantedits has significant edits } addedit add edit undoableedit undoable edit anedit an edit { if debug d e b u g out undoredomanager undo redo manager add +anedit +an edit if undoorredoinprogress undo or redo in progress { anedit an edit die } success = super addedit add edit anedit an edit updateactions update actions if success anedit an edit issignificant is significant edittobeundone edit to be undone == anedit an edit { sethassignificantedits set has significant edits } success } action getundoaction get undo action { undoaction undo action } action getredoaction get redo action { redoaction redo action } private updateactions update actions { label if debug d e b u g out undomanager undo manager updateactions update actions + edittobeundone edit to be undone + canundo= can undo= +canundo +can undo + canredo= can redo= +canredo +can redo if canundo can undo { undoaction undo action setenabled set enabled label = getundopresentationname get undo presentation name } else { undoaction undo action setenabled set enabled label = labels getstring get undo } undoaction undo action putvalue put value action name n a m e label undoaction undo action putvalue put value action SHORT_DESCRIPTION label if canredo can redo { redoaction redo action setenabled set enabled label = getredopresentationname get redo presentation name } else { redoaction redo action setenabled set enabled label = labels getstring get redo } redoaction redo action putvalue put value action name n a m e label redoaction redo action putvalue put value action SHORT_DESCRIPTION label } undo cannotundoexception cannot undo { undoorredoinprogress undo or redo in progress = try { super undo } finally { undoorredoinprogress undo or redo in progress = updateactions update actions } } redo cannotundoexception cannot undo { undoorredoinprogress undo or redo in progress = try { super redo } finally { undoorredoinprogress undo or redo in progress = updateactions update actions } } undoorredo undo or redo cannotundoexception cannot undo cannotredoexception cannot redo { undoorredoinprogress undo or redo in progress = try { super undoorredo undo or redo } finally { undoorredoinprogress undo or redo in progress = updateactions update actions } } addpropertychangelistener add property change listener propertychangelistener property change listener listener { propertysupport property support addpropertychangelistener add property change listener listener } addpropertychangelistener add property change listener propertyname property name propertychangelistener property change listener listener { propertysupport property support addpropertychangelistener add property change listener propertyname property name listener } removepropertychangelistener remove property change listener propertychangelistener property change listener listener { propertysupport property support removepropertychangelistener remove property change listener listener } removepropertychangelistener remove property change listener propertyname property name propertychangelistener property change listener listener { propertysupport property support removepropertychangelistener remove property change listener propertyname property name listener } firepropertychange fire property change propertyname property name oldvalue old value newvalue new value { propertysupport property support firepropertychange fire property change propertyname property name oldvalue old value newvalue new value } firepropertychange fire property change propertyname property name oldvalue old value newvalue new value { propertysupport property support firepropertychange fire property change propertyname property name oldvalue old value newvalue new value } firepropertychange fire property change propertyname property name oldvalue old value newvalue new value { propertysupport property support firepropertychange fire property change propertyname property name oldvalue old value newvalue new value } } 