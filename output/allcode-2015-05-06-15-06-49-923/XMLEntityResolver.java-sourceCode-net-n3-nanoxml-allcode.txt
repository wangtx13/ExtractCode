net n3 nanoxml import util hashtable import io reader import io stringreader reader xmlentityresolver xml entity resolver implements ixmlentityresolver i xml entity resolver { private hashtable entities xmlentityresolver xml entity resolver { this entities = new hashtable this entities put amp #38 this entities put #34 this entities put apos #39 this entities put lt #60 this entities put #62 } finalize throwable { this entities clear this entities = super finalize } addinternalentity add internal entity name value { if ! this entities containskey contains key name { this entities put name value } } addexternalentity add external entity name publicid systemid { if ! this entities containskey contains key name { this entities put name new { publicid systemid } } } reader getentity get entity ixmlreader i xml reader xmlreader xml reader name xmlparseexception xml parse { obj = this entities get name if obj == { } else if obj instanceof lang { new stringreader reader obj } else { = obj this openexternalentity open external entity xmlreader xml reader 0 1 } } isexternalentity is external entity name { obj = this entities get name ! obj instanceof lang } reader openexternalentity open external entity ixmlreader i xml reader xmlreader xml reader publicid systemid xmlparseexception xml parse { parentsystemid parent systemid = xmlreader xml reader getsystemid get systemid try { xmlreader xml reader openstream open stream publicid systemid } catch e { throw new xmlparseexception xml parse parentsystemid parent systemid xmlreader xml reader getlinenr get line nr could not open external entity + at + systemid } } } 