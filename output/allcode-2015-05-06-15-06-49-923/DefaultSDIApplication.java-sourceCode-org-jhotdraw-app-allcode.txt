org jhotdraw app import org jhotdraw util * import org jhotdraw util prefs * import awt * import awt event * import beans * import io * import util * import util prefs * import javax swing * import org jhotdraw app action aboutaction about action import org jhotdraw app action actions import org jhotdraw app action clearaction clear action import org jhotdraw app action clearrecentfilesaction clear recent files action import org jhotdraw app action closeaction close action import org jhotdraw app action copyaction copy action import org jhotdraw app action cutaction cut action import org jhotdraw app action deleteaction delete action import org jhotdraw app action duplicateaction duplicate action import org jhotdraw app action exitaction exit action import org jhotdraw app action exportaction export action import org jhotdraw app action loadaction load action import org jhotdraw app action loadrecentaction load recent action import org jhotdraw app action newaction new action import org jhotdraw app action pasteaction paste action import org jhotdraw app action redoaction redo action import org jhotdraw app action saveaction save action import org jhotdraw app action saveasaction save as action import org jhotdraw app action selectallaction select all action import org jhotdraw app action togglevisibleaction toggle visible action import org jhotdraw app action undoaction undo action defaultsdiapplication default s d i application abstractapplication application { private project currentproject current project private preferences prefs defaultsdiapplication default s d i application { } launch args { setproperty set property apple awt graphics usequartz use quartz super launch args } init { super init prefs = preferences usernodeforpackage user node for getmodel get model == ? getclass get getmodel get model getclass get initlabels init labels initlookandfeel init look and feel initapplicationactions init application actions } remove project p { super remove p if projects size == 0 { stop } } initlookandfeel init look and feel { setproperty set property apple laf usescreenmenubar use screen menu bar setproperty set property com apple macos usescreenmenubar use screen menu bar setproperty set property apple awt graphics usequartz use quartz try { lafname laf name = uimanager u i manager getsystemlookandfeelclassname get look and feel name uimanager u i manager setlookandfeel set look and feel lafname laf name } catch e { e printstacktrace print stack trace } if uimanager u i manager getstring get optionpane option pane css == { uimanager u i manager put optionpane option pane css } } initapplicationactions init application actions { resourcebundleutil resource bundle util applabels app labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw app labels applicationmodel application model m = getmodel get model m putaction put action aboutaction about action new aboutaction about action this m putaction put action exitaction exit action new exitaction exit action this m putaction put action clearaction clear action new clearaction clear action this m putaction put action newaction new action new newaction new action this applabels app labels configureaction configure action m getaction get action newaction new action newwindow new window m putaction put action loadaction load action new loadaction load action this m putaction put action clearrecentfilesaction clear recent files action new clearrecentfilesaction clear recent files action this m putaction put action saveaction save action new saveaction save action this m putaction put action saveasaction save as action new saveasaction save as action this m putaction put action closeaction close action new closeaction close action this m putaction put action undoaction undo action new undoaction undo action this m putaction put action redoaction redo action new redoaction redo action this m putaction put action cutaction cut action new cutaction cut action m putaction put action copyaction copy action new copyaction copy action m putaction put action pasteaction paste action new pasteaction paste action m putaction put action deleteaction delete action new deleteaction delete action m putaction put action duplicateaction duplicate action new duplicateaction duplicate action m putaction put action selectallaction select all action new selectallaction select all action } initprojectactions init project actions project p { } show project p { if ! p isshowing is showing { p setshowing set showing = p getfile get jframe j frame f = new jframe j frame title if == { title = labels getstring get unnamedfile unnamed } else { title = getname get name } if p hasunsavedchanges has unsaved changes { title += * } f settitle set title labels getformatted get formatted frametitle frame title title getname get name p getmultipleopenid get multiple open f setdefaultcloseoperation set default close operation jframe j frame DO_NOTHING_ON_CLOSE jpanel j panel panel = jpanel j panel wrapprojectcomponent wrap project component p f add panel f setminimumsize set minimum size new dimension 200 200 f setpreferredsize set preferred size new dimension 600 400 f setjmenubar set j menu bar createmenubar create menu bar p util list<action> list< action> panel getclientproperty get client property toolbaractions tool bar actions preferencesutil preferences util installframeprefshandler install frame prefs handler prefs project f point loc = f getlocation get location moved do { moved = for iterator i=projects iterator i hasnext has next { project aproject a project = project i next if aproject a project != p swingutilities swing utilities getwindowancestor get window ancestor aproject a project getcomponent get component != swingutilities swing utilities getwindowancestor get window ancestor aproject a project getcomponent get component getlocation get location equals loc { loc x += 22 loc y += 22 moved = break } } } while moved f setlocation set location loc f addwindowlistener add window listener new windowadapter window adapter { windowclosing window closing windowevent window event evt { setcurrentproject set current project p getmodel get model getaction get action closeaction close action actionperformed action performed new actionevent action event f actionevent action event ACTION_PERFORMED windowclosing window closing } windowactivated window activated windowevent window event e { setcurrentproject set current project p } } p addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name if name equals hasunsavedchanges has unsaved changes || name equals || name equals multipleopenid multiple open { = p getfile get title if == { title = labels getstring get unnamedfile unnamed } else { title = getname get name } if p hasunsavedchanges has unsaved changes { title += * } f settitle set title labels getformatted get formatted frametitle frame title title getname get name p getmultipleopenid get multiple open } } } f setvisible set visible } } component wrapprojectcomponent wrap project component project p { component c = p getcomponent get component if getmodel get model != { linkedlist<action> linked list< action> toolbaractions tool bar actions = new linkedlist linked list id=0 for jtoolbar j tool bar tb new reversedlist<jtoolbar> reversed list< j tool bar> getmodel get model createtoolbars create tool bars this p { id++ jpanel j panel panel = new jpanel j panel new borderlayout border layout panel add tb borderlayout border layout north n o r t h panel add c borderlayout border layout center c e n t e r c = panel preferencesutil preferences util installtoolbarprefshandler install tool bar prefs handler prefs toolbar +id tb toolbaractions tool bar actions addfirst add first new togglevisibleaction toggle visible action tb tb getname get name } jtoolbar j tool bar tb = new jtoolbar j tool bar tb setname set name labels getstring get standardtoolbartitle standard tool bar title addstandardactionsto add standard actions to tb p id++ jpanel j panel panel = new jpanel j panel new borderlayout border layout panel add tb borderlayout border layout north n o r t h panel add c borderlayout border layout center c e n t e r c = panel preferencesutil preferences util installtoolbarprefshandler install tool bar prefs handler prefs toolbar +id tb toolbaractions tool bar actions addfirst add first new togglevisibleaction toggle visible action tb tb getname get name panel putclientproperty put client property toolbaractions tool bar actions toolbaractions tool bar actions } c } addstandardactionsto add standard actions to jtoolbar j tool bar tb project p { jbutton j button b applicationmodel application model m = getmodel get model b = tb add m getaction get action clearaction clear action b setfocusable set focusable b = tb add m getaction get action loadaction load action b setfocusable set focusable b = tb add m getaction get action saveaction save action tb addseparator add separator b = tb add m getaction get action undoaction undo action b setfocusable set focusable b = tb add m getaction get action redoaction redo action b setfocusable set focusable tb addseparator add separator b = tb add m getaction get action cutaction cut action b setfocusable set focusable b = tb add m getaction get action copyaction copy action b setfocusable set focusable b = tb add m getaction get action pasteaction paste action b setfocusable set focusable } hide project p { if p isshowing is showing { p setshowing set showing jframe j frame f = jframe j frame swingutilities swing utilities getwindowancestor get window ancestor p getcomponent get component f setvisible set visible f remove p getcomponent get component f dispose } } dispose project p { super dispose p if projects size == 0 { stop } } project getcurrentproject get current project { currentproject current project } setcurrentproject set current project project newvalue new value { project oldvalue old value = currentproject current project currentproject current project = newvalue new value firepropertychange fire property change currentproject current project oldvalue old value newvalue new value } jmenubar j menu bar createmenubar create menu bar project p util list<action> list< action> toolbaractions tool bar actions { applicationmodel application model model = getmodel get model resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw app labels jmenubar j menu bar mb = new jmenubar j menu bar jmenu j menu m m2 jmenuitem j menu item mi jcheckboxmenuitem j check box menu item cbmi jmenu j menu openrecentmenu open recent menu m = new jmenu j menu labels configuremenu configure menu m labels getstring get m add model getaction get action clearaction clear action m add model getaction get action newaction new action m add model getaction get action loadaction load action openrecentmenu open recent menu = new jmenu j menu labels configuremenu configure menu openrecentmenu open recent menu openrecent open recent openrecentmenu open recent menu add model getaction get action clearrecentfilesaction clear recent files action updateopenrecentmenu update open recent menu openrecentmenu open recent menu m add openrecentmenu open recent menu m addseparator add separator m add model getaction get action saveaction save action m add model getaction get action saveasaction save as action if model getaction get action exportaction export action != { mi = m add model getaction get action exportaction export action } m addseparator add separator m add model getaction get action exitaction exit action mb add m m = new jmenu j menu labels configuremenu configure menu m labels getstring get edit m add model getaction get action undoaction undo action m add model getaction get action redoaction redo action m addseparator add separator m add model getaction get action cutaction cut action m add model getaction get action copyaction copy action m add model getaction get action pasteaction paste action m add model getaction get action duplicateaction duplicate action m add model getaction get action deleteaction delete action m addseparator add separator m add model getaction get action selectallaction select all action mb add m jmenu j menu viewmenu view menu = for jmenu j menu mm model createmenus create menus this p { mb add mm if mm gettext get text equals labels getstring get view { viewmenu view menu = mm } } if toolbaractions tool bar actions != toolbaractions tool bar actions size > 0 { m = viewmenu view menu != ? viewmenu view menu new jmenu j menu m2 = toolbaractions tool bar actions size == 1 ? m new jmenu j menu labels getstring get toolbars tool bars labels configuremenu configure menu m labels getstring get view for action a toolbaractions tool bar actions { cbmi = new jcheckboxmenuitem j check box menu item a actions configurejcheckboxmenuitem configure j check box menu item cbmi a m2 add cbmi } if m2 != m { m add m2 } mb add m } m = new jmenu j menu labels configuremenu configure menu m labels getstring get help m add model getaction get action aboutaction about action mb add m addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { name = evt getpropertyname get property name if name == projectcount project count { if p == || projects contains p { } else { removepropertychangelistener remove property change listener this } } else if name == recentfiles recent files { updateopenrecentmenu update open recent menu openrecentmenu open recent menu } } } mb } private updateopenrecentmenu update open recent menu jmenu j menu openrecentmenu open recent menu { if openrecentmenu open recent menu getitemcount get item count > 0 { jmenuitem j menu item clearrecentfilesitem clear recent files item = jmenuitem j menu item openrecentmenu open recent menu getitem get item openrecentmenu open recent menu getitemcount get item count 1 openrecentmenu open recent menu removeall remove all for f recentfiles recent files { openrecentmenu open recent menu add new loadrecentaction load recent action defaultsdiapplication default s d i application this f } if recentfiles recent files size > 0 { openrecentmenu open recent menu addseparator add separator } openrecentmenu open recent menu add clearrecentfilesitem clear recent files item } } issharingtoolsamongprojects is sharing tools among projects { } component getcomponent get component { project p = getcurrentproject get current project p == ? p getcomponent get component } } 