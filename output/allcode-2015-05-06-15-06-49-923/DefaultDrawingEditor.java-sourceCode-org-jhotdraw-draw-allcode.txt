org jhotdraw draw import org jhotdraw beans * import awt * import awt datatransfer * import awt event focusevent focus event import awt event focuslistener focus listener import beans * import util * import io * import org jhotdraw draw attributekeys attribute keys * defaultdrawingeditor default drawing editor abstractbean bean implements drawingeditor drawing editor toollistener tool listener { private hashmap<attributekey hash map< attribute key object> defaultattributes default attributes = new hashmap<attributekey hash map< attribute key object> private tool tool private hashset<drawingview> hash set< drawing view> views private drawingview drawing view activeview active view private isenabled is enabled = private drawingview drawing view focusedview focused view private focuslistener focus listener focushandler focus handler = new focuslistener focus listener { focusgained focus gained focusevent focus event e { setfocusedview set focused view drawingview drawing view findview find view container e getsource get source } focuslost focus lost focusevent focus event e { if ! e istemporary is temporary { setfocusedview set focused view } } } defaultdrawingeditor default drawing editor { setdefaultattribute set default attribute FILL_COLOR color white setdefaultattribute set default attribute STROKE_COLOR color black setdefaultattribute set default attribute TEXT_COLOR color black views = new hashset<drawingview> hash set< drawing view> } settool set tool tool t { if t == tool if tool != { for drawingview drawing view v views { v removemouselistener remove mouse listener tool v removemousemotionlistener remove mouse motion listener tool v removekeylistener remove key listener tool } tool deactivate this tool removetoollistener remove tool listener this } tool = t if tool != { tool activate this for drawingview drawing view v views { v addmouselistener add mouse listener tool v addmousemotionlistener add mouse motion listener tool v addkeylistener add key listener tool } tool addtoollistener add tool listener this } } areainvalidated area invalidated toolevent tool event evt { rectangle r = evt getinvalidatedarea get invalidated area evt getview get view getcontainer get container repaint r x r y r width r height } toolstarted tool started toolevent tool event evt { setview set view evt getview get view } setview set view drawingview drawing view newvalue new value { drawingview drawing view oldvalue old value = activeview active view activeview active view = newvalue new value firepropertychange fire property change view oldvalue old value newvalue new value for drawingview drawing view v views { v getcontainer get container repaint } } tooldone tool done toolevent tool event evt { drawingview drawing view v = getview get view if v != { container c = v getcontainer get container c invalidate if c getparent get parent != c getparent get parent validate } } tool gettool get tool { tool } drawingview drawing view getview get view { activeview active view != ? activeview active view views iterator next } private updatefocusedview update focused view { for drawingview drawing view v views { if v getcontainer get container hasfocus has focus { setfocusedview set focused view v } } setfocusedview set focused view } private setfocusedview set focused view drawingview drawing view newvalue new value { drawingview drawing view oldvalue old value = focusedview focused view focusedview focused view = newvalue new value firepropertychange fire property change focusedview focused view oldvalue old value newvalue new value } drawingview drawing view getfocusedview get focused view { focusedview focused view } applydefaultattributesto apply default attributes to figure f { for map entry<attributekey entry< attribute key object> entry defaultattributes default attributes entryset entry set { f setattribute set attribute entry getkey get key entry getvalue get value } } getdefaultattribute get default attribute attributekey attribute key key { defaultattributes default attributes get key } setdefaultattribute set default attribute attributekey attribute key key newvalue new value { oldvalue old value = defaultattributes default attributes put key newvalue new value firepropertychange fire property change key getkey get key oldvalue old value newvalue new value } remove drawingview drawing view view { view getcontainer get container removefocuslistener remove focus listener focushandler focus handler views remove view if tool != { view removemouselistener remove mouse listener tool view removemousemotionlistener remove mouse motion listener tool view removekeylistener remove key listener tool } view removenotify remove notify this if activeview active view == view { view = views size > 0 ? views iterator next } updatefocusedview update focused view } add drawingview drawing view view { views add view view addnotify add notify this view getcontainer get container addfocuslistener add focus listener focushandler focus handler if tool != { view addmouselistener add mouse listener tool view addmousemotionlistener add mouse motion listener tool view addkeylistener add key listener tool } updatefocusedview update focused view } setcursor set cursor cursor c { } collection<drawingview> collection< drawing view> getdrawingviews get drawing views { collections unmodifiablecollection unmodifiable collection views } drawingview drawing view findview find view container c { for drawingview drawing view v views { if v getcontainer get container == c { v } } } setenabled set enabled newvalue new value { if newvalue new value != isenabled is enabled { oldvalue old value = isenabled is enabled isenabled is enabled = newvalue new value firepropertychange fire property change enabled oldvalue old value newvalue new value } } isenabled is enabled { isenabled is enabled } } 