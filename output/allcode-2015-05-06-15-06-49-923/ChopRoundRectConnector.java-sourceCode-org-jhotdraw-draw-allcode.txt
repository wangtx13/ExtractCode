org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import org jhotdraw draw attributekeys attribute keys * import org jhotdraw geom * choproundrectconnector chop round rect connector chopboxconnector chop box connector { choproundrectconnector chop round rect connector { } choproundrectconnector chop round rect connector figure owner { super owner } point2d point2 d chop figure target point2d point2 d from { target = getconnectortarget get connector target target roundrectanglefigure round rectangle figure rrf = roundrectanglefigure round rectangle figure target rectangle2d rectangle2 d outer = rrf getbounds get bounds grow switch STROKE_PLACEMENT get target { case center c e n t e r default grow = attributekeys attribute keys getstroketotalwidth get stroke total width target / 2d break case outside o u t sid e grow = attributekeys attribute keys getstroketotalwidth get stroke total width target break case inside i n sid e grow = 0 break } geom grow outer grow grow rectangle2d rectangle2 d inner = rectangle2d rectangle2 d outer clone gw = rrf getarcwidth get arc width + grow * 2 / 2 gh = rrf getarcheight get arc height + grow *2 / 2 inner x = gw inner y = gh inner width += gw * 2 inner height += gh * 2 angle = geom pointtoangle point to angle outer from point2d point2 d p = geom angletopoint angle to point outer geom pointtoangle point to angle outer from if p x == outer x || p x == outer x + outer width { p y = math min math max p y inner y inner y + inner height } else { p x = math min math max p x inner x inner x + inner width } p } } 