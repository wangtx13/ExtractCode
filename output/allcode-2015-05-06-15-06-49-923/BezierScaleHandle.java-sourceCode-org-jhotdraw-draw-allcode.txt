org jhotdraw draw import org jhotdraw util * import org jhotdraw undo * import awt * import awt event * import awt geom * import util * import org jhotdraw geom * bezierscalehandle bezier scale handle abstracthandle handle { private point location private restoredata restore data private affinetransform affine transform transform private point2d point2 d center private starttheta start theta private startlength start length bezierscalehandle bezier scale handle bezierfigure bezier figure owner { super owner } iscombinablewith is combinable with handle h { } draw graphics2d graphics2 d g { drawcircle draw circle g color yellow color black } rectangle basicgetbounds basic get bounds { rectangle r = new rectangle getlocation get location r grow gethandlesize get handlesize / 2 gethandlesize get handlesize / 2 r } point getlocation get location { if location == { view drawingtoview drawing to view getorigin get origin } location } private bezierfigure bezier figure getbezierfigure get bezier figure { bezierfigure bezier figure getowner get owner } private point2d point2 d getorigin get origin { handlesize = gethandlesize get handlesize point2d point2 d outer = getbezierfigure get bezier figure getoutermostpoint get outermost point point2d point2 d ctr = getbezierfigure get bezier figure getcenter get center len = geom length outer x outer y ctr x ctr y if len == 0 { new point2d point2 d outer x handlesize/2 outer y + handlesize/2 } u = handlesize / len if u > 1 0 { new point2d point2 d outer x * 3 + ctr x /4 outer y * 3 + ctr y /4 } else { new point2d point2 d outer x * 1 0 u + ctr x * u outer y * 1 0 u + ctr y * u } } trackstart track start point anchor modifiersex modifiers ex { location = new point anchor x anchor y restoredata restore data = getbezierfigure get bezier figure getrestoredata get restore data transform = new affinetransform affine transform center = getbezierfigure get bezier figure getcenter get center point2d point2 d anchorpoint anchor point = view viewtodrawing view to drawing anchor starttheta start theta = geom angle center x center y anchorpoint anchor point x anchorpoint anchor point y startlength start length = geom length center x center y anchorpoint anchor point x anchorpoint anchor point y } trackstep track step point anchor point modifiersex modifiers ex { location = new point x y point2d point2 d leadpoint point = view viewtodrawing view to drawing steptheta step theta = geom angle center x center y leadpoint point x leadpoint point y steplength step length = geom length center x center y leadpoint point x leadpoint point y scalefactor scale factor = modifiersex modifiers ex inputevent input event ALT_DOWN_MASK | inputevent input event SHIFT_DOWN_MASK != 0 ? 1d steplength step length / startlength start length transform settoidentity set to identity transform translate center x center y transform scale scalefactor scale factor scalefactor scale factor transform rotate steptheta step theta starttheta start theta transform translate center x center y getowner get owner willchange will change getowner get owner restoreto restore to restoredata restore data getowner get owner basictransform basic transform transform getowner get owner changed } trackend track end point anchor point modifiersex modifiers ex { view getdrawing get drawing fireundoableedithappened fire undoable edit happened new restoredataedit restore data edit getowner get owner restoredata restore data location = } } 