org jhotdraw samples pert figures import io ioexception i o import org jhotdraw samples * import awt geom * import beans * import org jhotdraw draw attributekeys attribute keys * import util * import org jhotdraw draw * import org jhotdraw geom * import org jhotdraw util * import org jhotdraw xml * taskfigure task figure graphicalcompositefigure graphical composite figure { private hashset<dependencyfigure> hash set< dependency figure> dependencies private starttime start time private nameadapter name adapter abstractfigurelistener figure listener { private taskfigure task figure target nameadapter name adapter taskfigure task figure target { this target = target } figureattributechanged figure attribute changed figureevent figure event e { } } private durationadapter duration adapter abstractfigurelistener figure listener { private taskfigure task figure target durationadapter duration adapter taskfigure task figure target { this target = target } figureattributechanged figure attribute changed figureevent figure event evt { for taskfigure task figure succ target getsuccessors get successors { succ updatestarttime update start time } } } taskfigure task figure { super new rectanglefigure rectangle figure setlayouter set layouter new verticallayouter vertical layouter rectanglefigure rectangle figure namecompartmentpf name compartment p f = new rectanglefigure rectangle figure STROKE_COLOR set namecompartmentpf name compartment p f namecompartmentpf name compartment p f setattributeenabled set attribute enabled STROKE_COLOR FILL_COLOR set namecompartmentpf name compartment p f namecompartmentpf name compartment p f setattributeenabled set attribute enabled FILL_COLOR listfigure list figure namecompartment name compartment = new listfigure list figure namecompartmentpf name compartment p f listfigure list figure attributecompartment attribute compartment = new listfigure list figure separatorlinefigure separator line figure separator1 = new separatorlinefigure separator line figure applyattributes apply attributes getpresentationfigure get presentation figure add namecompartment name compartment add separator1 add attributecompartment attribute compartment insets2ddouble insets2 d insets = new insets2ddouble insets2 d 4 8 4 8 LAYOUT_INSETS set namecompartment name compartment insets LAYOUT_INSETS set attributecompartment attribute compartment insets textfigure text figure namefigure name figure namecompartment name compartment add namefigure name figure = new textfigure text figure FONT_BOLD set namefigure name figure namefigure name figure setattributeenabled set attribute enabled FONT_BOLD textfigure text figure durationfigure duration figure attributecompartment attribute compartment add durationfigure duration figure = new textfigure text figure FONT_BOLD set durationfigure duration figure durationfigure duration figure settext set text 0 durationfigure duration figure setattributeenabled set attribute enabled FONT_BOLD textfigure text figure starttimefigure start time figure attributecompartment attribute compartment add starttimefigure start time figure = new textfigure text figure starttimefigure start time figure seteditable set editable starttimefigure start time figure settext set text 0 starttimefigure start time figure setattributeenabled set attribute enabled FONT_BOLD applyattributes apply attributes this setattributeenabled set attribute enabled STROKE_DASHES resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw samples pert labels setname set name labels getstring get taskdefaultname task default name setduration set duration 0 starttime start time = 0 dependencies = new hashset<dependencyfigure> hash set< dependency figure> namefigure name figure addfigurelistener add figure listener new nameadapter name adapter this durationfigure duration figure addfigurelistener add figure listener new durationadapter duration adapter this } collection<handle> collection< handle> createhandles create handles detaillevel detail level { list<handle> list< handle> handles = new linkedlist<handle> linked list< handle> if detaillevel detail level == 0 { handles add new movehandle move handle this relativelocator relative locator northwest north west handles add new movehandle move handle this relativelocator relative locator northeast north east handles add new movehandle move handle this relativelocator relative locator southwest south west handles add new movehandle move handle this relativelocator relative locator southeast south east handles add new connectionhandle connection handle this relativelocator relative locator east new dependencyfigure dependency figure } handles } setname set name newvalue new value { getnamefigure get name figure settext set text newvalue new value } getname get name { getnamefigure get name figure gettext get text } setduration set duration newvalue new value { oldvalue old value = getduration get duration getdurationfigure get duration figure settext set text integer tostring to newvalue new value if oldvalue old value != newvalue new value { for taskfigure task figure succ getsuccessors get successors { succ updatestarttime update start time } } } getduration get duration { try { integer valueof value of getdurationfigure get duration figure gettext get text } catch numberformatexception number format e { 0 } } updatestarttime update start time { oldvalue old value = getstarttime get start time newvalue new value = 0 for taskfigure task figure pre getpredecessors get predecessors { newvalue new value = math max newvalue new value pre getstarttime get start time + pre getduration get duration } getstarttimefigure get start time figure settext set text integer tostring to newvalue new value if newvalue new value != oldvalue old value { for taskfigure task figure succ getsuccessors get successors { if ! this isdependentof is dependent of succ { succ updatestarttime update start time } } } if oldvalue old value != newvalue new value { fireareainvalidated fire area invalidated } } getstarttime get start time { try { integer valueof value of getstarttimefigure get start time figure gettext get text } catch numberformatexception number format e { 0 } } private textfigure text figure getnamefigure get name figure { textfigure text figure listfigure list figure getchild get child 0 getchild get child 0 } private textfigure text figure getdurationfigure get duration figure { textfigure text figure listfigure list figure getchild get child 2 getchild get child 0 } private textfigure text figure getstarttimefigure get start time figure { textfigure text figure listfigure list figure getchild get child 2 getchild get child 1 } private applyattributes apply attributes figure f { map<attributekey map< attribute key object> attr = attributedfigure attributed figure getpresentationfigure get presentation figure getattributes get attributes for map entry<attributekey entry< attribute key object> entry attr entryset entry set { f setattribute set attribute entry getkey get key entry getvalue get value } } taskfigure task figure clone { taskfigure task figure that = taskfigure task figure super clone that dependencies = new hashset<dependencyfigure> hash set< dependency figure> that getnamefigure get name figure addfigurelistener add figure listener new nameadapter name adapter that that getdurationfigure get duration figure addfigurelistener add figure listener new durationadapter duration adapter that that updatestarttime update start time that } read dominput dom input in ioexception i o { x = in getattribute get attribute x 0d y = in getattribute get attribute y 0d w = in getattribute get attribute w 0d h = in getattribute get attribute h 0d setbounds set bounds new point2d point2 d x y new point2d point2 d x+w y+h readattributes read attributes in in openelement open element model in openelement open element name setname set name in readobject read in closeelement close element in openelement open element duration setduration set duration integer in readobject read in closeelement close element in closeelement close element } write domoutput dom output out ioexception i o { rectangle2d rectangle2 d r = getbounds get bounds out addattribute add attribute x r x out addattribute add attribute y r y writeattributes write attributes out out openelement open element model out openelement open element name out writeobject write getname get name out closeelement close element out openelement open element duration out writeobject write getduration get duration out closeelement close element out closeelement close element } getlayer get layer { 0 } set<dependencyfigure> set< dependency figure> getdependencies get dependencies { collections unmodifiableset unmodifiable set dependencies } adddependency add dependency dependencyfigure dependency figure f { dependencies add f updatestarttime update start time } removedependency remove dependency dependencyfigure dependency figure f { dependencies remove f updatestarttime update start time } list<taskfigure> list< task figure> getsuccessors get successors { linkedlist<taskfigure> linked list< task figure> list = new linkedlist<taskfigure> linked list< task figure> for dependencyfigure dependency figure c getdependencies get dependencies { if c getstartfigure get start figure == this { list add taskfigure task figure c getendfigure get end figure } } list } list<taskfigure> list< task figure> getpredecessors get predecessors { linkedlist<taskfigure> linked list< task figure> list = new linkedlist<taskfigure> linked list< task figure> for dependencyfigure dependency figure c getdependencies get dependencies { if c getendfigure get end figure == this { list add taskfigure task figure c getstartfigure get start figure } } list } isdependentof is dependent of taskfigure task figure t { if this == t for taskfigure task figure pre getpredecessors get predecessors { if pre isdependentof is dependent of t { } } } tostring to { taskfigure# task figure# +hashcode +hash + +getname +get name + +getduration +get duration + +getstarttime +get start time } } 