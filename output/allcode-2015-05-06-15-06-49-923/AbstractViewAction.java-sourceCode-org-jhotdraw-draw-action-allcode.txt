org jhotdraw draw action import org jhotdraw draw drawing import org jhotdraw draw drawingeditor drawing editor import org jhotdraw draw drawingview drawing view import org jhotdraw util * import beans * import javax swing * import javax swing undo * import util * abstractviewaction view action abstractaction action { private drawingeditor drawing editor editor private drawingview drawing view view resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw draw labels locale getdefault get default private propertychangelistener property change listener propertychangehandler property change handler = new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { if evt getpropertyname get property name equals enabled { updateenabledstate update enabled state } } } abstractviewaction view action drawingeditor drawing editor editor { this editor = editor editor addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { if evt getpropertyname get property name equals view { if evt getoldvalue get old value != { drawingview drawing view view = drawingview drawing view evt getoldvalue get old value view removepropertychangelistener remove property change listener propertychangehandler property change handler } if evt getnewvalue get new value != { drawingview drawing view view = drawingview drawing view evt getoldvalue get old value view addpropertychangelistener add property change listener propertychangehandler property change handler updateenabledstate update enabled state } } } } } abstractviewaction view action drawingview drawing view view { this view = view } seteditor set editor drawingeditor drawing editor newvalue new value { editor = newvalue new value } drawingview drawing view getview get view { view != ? view editor getview get view } drawing getdrawing get drawing { getview get view getdrawing get drawing } fireundoableedithappened fire undoable edit happened undoableedit undoable edit edit { getdrawing get drawing fireundoableedithappened fire undoable edit happened edit } viewchanged view changed { } updateenabledstate update enabled state { if getview get view != { setenabled set enabled getview get view isenabled is enabled getview get view getselectioncount get selection count > 0 } else { setenabled set enabled } } } 