org jhotdraw util prefs import awt * import awt event * import util prefs * import javax swing * import javax swing plaf basic * import javax swing event * toolbarprefshandler tool bar prefs handler implements componentlistener component listener ancestorlistener ancestor listener { private jtoolbar j tool bar toolbar private prefsprefix prefs prefix private preferences prefs private firsttimeshown first time shown toolbarprefshandler tool bar prefs handler jtoolbar j tool bar toolbar prefsprefix prefs prefix preferences prefs { this toolbar = toolbar this prefsprefix prefs prefix = prefsprefix prefs prefix this prefs = prefs constraint = prefs get prefsprefix+ prefs prefix+ constraint borderlayout border layout north n o r t h orientation = constraint equals borderlayout border layout north n o r t h || constraint equals borderlayout border layout south s o u t h ? jtoolbar j tool bar horizontal h o r i z o n t a l jtoolbar j tool bar vertical v e r t i c a l toolbar setorientation set orientation orientation toolbar getparent get parent add constraint toolbar toolbar setvisible set visible prefs getboolean get prefsprefix+ prefs prefix+ visible toolbar addcomponentlistener add component listener this toolbar addancestorlistener add ancestor listener this } componenthidden component hidden componentevent component event e { prefs putboolean put prefsprefix+ prefs prefix+ visible } componentmoved component moved componentevent component event e { locationchanged location changed } private locationchanged location changed { if toolbar getui get u i instanceof basictoolbarui basic tool bar u i { basictoolbarui basic tool bar u i ui = basictoolbarui basic tool bar u i toolbar getui get u i floating = ui isfloating is floating prefs putboolean put prefsprefix+ prefs prefix+ isfloating is floating floating if floating { window window = swingutilities swing utilities getwindowancestor get window ancestor toolbar prefs putint put prefsprefix+ prefs prefix+ floatingx floating x window getx get x prefs putint put prefsprefix+ prefs prefix+ floatingy floating y window gety get y } else if toolbar getparent get parent != { x = toolbar getx get x y = toolbar gety get y insets insets = toolbar getparent get parent getinsets get insets constraint if x == insets left y == insets top { constraint = toolbar getorientation get orientation == jtoolbar j tool bar horizontal h o r i z o n t a l ? borderlayout border layout north n o r t h borderlayout border layout west w e s t } else { constraint = toolbar getorientation get orientation == jtoolbar j tool bar horizontal h o r i z o n t a l ? borderlayout border layout south s o u t h borderlayout border layout east e a s t } prefs put prefsprefix+ prefs prefix+ constraint constraint } } else { if toolbar getparent get parent != { x = toolbar getx get x y = toolbar gety get y insets insets = toolbar getparent get parent getinsets get insets constraint if x == insets left y == insets top { constraint = toolbar getorientation get orientation == jtoolbar j tool bar horizontal h o r i z o n t a l ? borderlayout border layout north n o r t h borderlayout border layout west w e s t } else { constraint = toolbar getorientation get orientation == jtoolbar j tool bar horizontal h o r i z o n t a l ? borderlayout border layout south s o u t h borderlayout border layout east e a s t } prefs put prefsprefix+ prefs prefix+ constraint constraint } } } componentresized component resized componentevent component event e { locationchanged location changed } componentshown component shown componentevent component event e { prefs putboolean put prefsprefix+ prefs prefix+ visible } ancestoradded ancestor added ancestorevent ancestor event event { locationchanged location changed } ancestormoved ancestor moved ancestorevent ancestor event event { if toolbar getui get u i instanceof basictoolbarui basic tool bar u i { if basictoolbarui basic tool bar u i toolbar getui get u i isfloating is floating { locationchanged location changed } } } ancestorremoved ancestor removed ancestorevent ancestor event event { if toolbar getui get u i instanceof basictoolbarui basic tool bar u i { if basictoolbarui basic tool bar u i toolbar getui get u i isfloating is floating { locationchanged location changed } } } } 