org jhotdraw draw import awt * import awt geom * import org jhotdraw draw attributekeys attribute keys * import org jhotdraw geom * trianglerotationhandler triangle rotation handler abstracthandle handle { private rectangle centerbox center box private attributekeys attribute keys orientation oldvalue old value private attributekeys attribute keys orientation newvalue new value trianglerotationhandler triangle rotation handler trianglefigure triangle figure owner { super owner } iscombinablewith is combinable with handle h { } private point2d point2 d getlocation get location { rectangle2d rectangle2 d r = getowner get owner getbounds get bounds point2d point2 d p offset = gethandlesize get handlesize switch orientation o r i e n t a t i o n get getowner get owner { case north n o r t h default p = new point2d point2 d r x + r width / 2d r y + offset break case NORTH_EAST p = new point2d point2 d r x + r width offset r y + offset break case east e a s t p = new point2d point2 d r x + r width offset r y + r height / 2d break case SOUTH_EAST p = new point2d point2 d r x + r width offset r y + r height offset break case south s o u t h p = new point2d point2 d r x + r width / 2d r y + r height offset break case SOUTH_WEST p = new point2d point2 d r x + offset r y + r height offset break case west w e s t p = new point2d point2 d r x + offset r y + r height / 2d break case NORTH_WEST p = new point2d point2 d r x + offset r y + offset break } p } rectangle basicgetbounds basic get bounds { point p = view drawingtoview drawing to view getlocation get location rectangle r = new rectangle p r grow gethandlesize get handlesize / 2 gethandlesize get handlesize / 2 r } trackstart track start point anchor modifiersex modifiers ex { oldvalue old value = orientation o r i e n t a t i o n get getowner get owner centerbox center box = view drawingtoview drawing to view getowner get owner getbounds get bounds centerbox center box grow centerbox center box width / 3 centerbox center box height / 3 } trackstep track step point anchor point modifiersex modifiers ex { rectangle leadrect rect = new rectangle switch geom outcode centerbox center box leadrect rect { case geom OUT_TOP default newvalue new value = attributekeys attribute keys orientation north n o r t h break case geom OUT_TOP | geom OUT_RIGHT newvalue new value = attributekeys attribute keys orientation NORTH_EAST break case geom OUT_RIGHT newvalue new value = attributekeys attribute keys orientation east e a s t break case geom OUT_BOTTOM | geom OUT_RIGHT newvalue new value = attributekeys attribute keys orientation SOUTH_EAST break case geom OUT_BOTTOM newvalue new value = attributekeys attribute keys orientation south s o u t h break case geom OUT_BOTTOM | geom OUT_LEFT newvalue new value = attributekeys attribute keys orientation SOUTH_WEST break case geom OUT_LEFT newvalue new value = attributekeys attribute keys orientation west w e s t break case geom OUT_TOP | geom OUT_LEFT newvalue new value = attributekeys attribute keys orientation NORTH_WEST break } getowner get owner willchange will change orientation o r i e n t a t i o n basicset basic set getowner get owner newvalue new value getowner get owner changed updatebounds update bounds } draw graphics2d graphics2 d g { drawdiamond draw diamond g color yellow color black } trackend track end point anchor point modifiersex modifiers ex { if newvalue new value != oldvalue old value { fireundoableedithappened fire undoable edit happened new attributechangeedit attribute change edit getowner get owner orientation o r i e n t a t i o n oldvalue old value newvalue new value } } } 