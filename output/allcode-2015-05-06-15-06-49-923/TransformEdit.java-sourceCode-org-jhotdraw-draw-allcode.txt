org jhotdraw draw import org jhotdraw util * import javax swing undo * import awt geom * import util * transformedit transform edit abstractundoableedit undoable edit { private collection<figure> collection< figure> figures private affinetransform affine transform tx transformedit transform edit figure figure affinetransform affine transform tx { figures = new linkedlist<figure> linked list< figure> linkedlist<figure> linked list< figure> figures add figure this tx = affinetransform affine transform tx clone } transformedit transform edit collection<figure> collection< figure> figures affinetransform affine transform tx { this figures = figures this tx = affinetransform affine transform tx clone } getpresentationname get presentation name { resourcebundleutil resource bundle util labels = resourcebundleutil resource bundle util getlafbundle get l a f bundle org jhotdraw draw labels locale getdefault get default labels getstring get transformfigure transform figure } addedit add edit undoableedit undoable edit anedit an edit { if anedit an edit instanceof transformedit transform edit { transformedit transform edit that = transformedit transform edit anedit an edit if that figures == this figures { this tx concatenate that tx that die } } } replaceedit replace edit undoableedit undoable edit anedit an edit { if anedit an edit instanceof transformedit transform edit { transformedit transform edit that = transformedit transform edit anedit an edit if that figures == this figures { this tx preconcatenate pre concatenate that tx that die } } } redo cannotredoexception cannot redo { super redo for figure f figures { f willchange will change f basictransform basic transform tx f changed } } undo cannotundoexception cannot undo { super undo try { affinetransform affine transform inverse = tx createinverse create inverse for figure f figures { f willchange will change f basictransform basic transform inverse f changed } } catch noninvertibletransformexception noninvertible transform e { e printstacktrace print stack trace } } tostring to { getclass get getname get name +'@'+hashcode +'@'+hash + tx +tx } } 