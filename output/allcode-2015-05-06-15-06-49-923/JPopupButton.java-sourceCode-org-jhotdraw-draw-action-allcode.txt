org jhotdraw draw action import awt * import beans * import javax swing * import javax swing border * import javax swing event * import awt event * jpopupbutton j popup button javax swing jbutton j button { private jpopupmenu j popup menu popupmenu popup menu private columncount column count = 1 private action action private rectangle actionarea action area private font itemfont item font font ITEM_FONT = new font dialog font plain p l a i n 10 jpopupbutton j popup button { initcomponents init components setfocusable set focusable itemfont item font = ITEM_FONT } setitemfont set item font font newvalue new value { itemfont item font = newvalue new value if popupmenu popup menu != { updatefont update font popupmenu popup menu } } setaction set action action action rectangle actionarea action area { this action = action this actionarea action area = actionarea action area action addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event evt { if evt getpropertyname get property name equals enabled { setenabled set enabled evt getnewvalue get new value booleanvalue value } else { repaint } } } } getcolumncount get column count { columncount column count } setcolumncount set column count count isvertical is vertical { columncount column count = count getpopupmenu get popup menu setlayout set layout new verticalgridlayout vertical grid layout 0 getcolumncount get column count isvertical is vertical } add action action { jmenuitem j menu item item = getpopupmenu get popup menu add action if getcolumncount get column count > 1 { item setui set u i new palettemenuitemui palette menu item u i } item setfont set font itemfont item font } add jmenu j menu submenu { jmenuitem j menu item item = getpopupmenu get popup menu add submenu updatefont update font submenu } private updatefont update font menuelement menu element menu { menu getcomponent get component setfont set font itemfont item font for menuelement menu element child menu getsubelements get sub elements { updatefont update font child } } add jmenuitem j menu item item { getpopupmenu get popup menu add item item setfont set font itemfont item font } addseparator add separator { getpopupmenu get popup menu addseparator add separator } setpopupmenu set popup menu jpopupmenu j popup menu popupmenu popup menu { this popupmenu popup menu = popupmenu popup menu } jpopupmenu j popup menu getpopupmenu get popup menu { if popupmenu popup menu == { popupmenu popup menu = new jpopupmenu j popup menu popupmenu popup menu setlayout set layout new verticalgridlayout vertical grid layout 0 getcolumncount get column count } popupmenu popup menu } private initcomponents init components { formlistener form listener formlistener form listener = new formlistener form listener addmouselistener add mouse listener formlistener form listener } private formlistener form listener implements awt event mouselistener mouse listener { mouseclicked mouse clicked awt event mouseevent mouse event evt { } mouseentered mouse entered awt event mouseevent mouse event evt { } mouseexited mouse exited awt event mouseevent mouse event evt { } mousepressed mouse pressed awt event mouseevent mouse event evt { if evt getsource get source == jpopupbutton j popup button this { jpopupbutton j popup button this showpopup show popup evt } } mousereleased mouse released awt event mouseevent mouse event evt { if evt getsource get source == jpopupbutton j popup button this { jpopupbutton j popup button this performaction perform action evt } } } private performaction perform action awt event mouseevent mouse event evt { if actionarea action area != actionarea action area contains evt getx get x getinsets get insets left evt gety get y getinsets get insets top { action actionperformed action performed new actionevent action event this actionevent action event ACTION_PERFORMED evt getwhen get when evt getmodifiers get modifiers } } private showpopup show popup awt event mouseevent mouse event evt { if popupmenu popup menu != actionarea action area == || ! actionarea action area contains evt getx get x getinsets get insets left evt gety get y getinsets get insets top { x y x = 0 y = getheight get height if getparent get parent instanceof jtoolbar j tool bar { jtoolbar j tool bar toolbar = jtoolbar j tool bar getparent get parent if toolbar getorientation get orientation == jtoolbar j tool bar vertical v e r t i c a l { y = 0 if toolbar getx get x > toolbar getparent get parent getinsets get insets left { x = popupmenu popup menu getpreferredsize get preferred size width } else { x = getwidth get width } } else { if toolbar gety get y > toolbar getparent get parent getinsets get insets top { y = popupmenu popup menu getpreferredsize get preferred size height } } } popupmenu popup menu show this x y } } } 