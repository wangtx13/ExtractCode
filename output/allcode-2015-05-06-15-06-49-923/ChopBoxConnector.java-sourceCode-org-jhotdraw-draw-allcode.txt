org jhotdraw draw import org jhotdraw util * import awt * import awt geom * import org jhotdraw draw attributekeys attribute keys * import org jhotdraw geom * chopboxconnector chop box connector abstractconnector connector { chopboxconnector chop box connector { } chopboxconnector chop box connector figure owner { super owner } point2d point2 d findstart find start connectionfigure connection figure connection { figure startfigure start figure = connection getstartconnector get start connector getowner get owner point2d point2 d from if connection getpointcount get point count <= 2 || connection getliner get liner != { if connection getendconnector get end connector == { from = connection getendpoint get end point } else { rectangle2d rectangle2 d r1 = getconnectortarget get connector target connection getendconnector get end connector getowner get owner getbounds get bounds from = new point2d point2 d r1 x + r1 width/2 r1 y + r1 height/2 } } else { from = connection getpoint get point 1 } chop startfigure start figure from } point2d point2 d findend find end connectionfigure connection figure connection { figure endfigure end figure = connection getendconnector get end connector getowner get owner point2d point2 d from if connection getpointcount get point count <= 2 || connection getliner get liner != { if connection getstartconnector get start connector == { from = connection getstartpoint get start point } else { rectangle2d rectangle2 d r1 = getconnectortarget get connector target connection getstartconnector get start connector getowner get owner getbounds get bounds from = new point2d point2 d r1 x + r1 width/2 r1 y + r1 height/2 } } else { from = connection getpoint get point connection getpointcount get point count 2 } chop endfigure end figure from } point2d point2 d chop figure target point2d point2 d from { target = getconnectortarget get connector target target rectangle2d rectangle2 d r = target getbounds get bounds if STROKE_COLOR get target != { grow switch STROKE_PLACEMENT get target { case center c e n t e r default grow = attributekeys attribute keys getstroketotalwidth get stroke total width target / 2d break case outside o u t sid e grow = attributekeys attribute keys getstroketotalwidth get stroke total width target break case inside i n sid e grow = 0d break } geom grow r grow grow } geom angletopoint angle to point r geom pointtoangle point to angle r from } } 