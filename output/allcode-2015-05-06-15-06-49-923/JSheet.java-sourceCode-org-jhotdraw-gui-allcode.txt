org jhotdraw gui import awt * import awt event * import awt peer * import beans * import lang reflect * import javax swing * import javax swing event * import javax swing plaf * import org jhotdraw gui event * import org jhotdraw util * jsheet j sheet jdialog j dialog { eventlistenerlist event listener list listenerlist listener list = new eventlistenerlist event listener list private componentlistener component listener ownermovementhandler owner movement handler private point shiftbacklocation shift back location private point oldlocation old location private component oldfocusowner old focus owner private isinstalled is installed private isanimated is animated = jsheet j sheet frame owner { super owner init } jsheet j sheet dialog owner { super owner init } private init { if getowner get owner != isshowassheet is show as sheet { setundecorated set undecorated getrootpane get root pane setwindowdecorationstyle set window decoration style jrootpane j root pane none n o n e getrootpane get root pane setborder set border uimanager u i manager getborder get border sheet border } ownermovementhandler owner movement handler = new componentadapter component adapter { componentmoved component moved componentevent component event evt { window owner = getowner get owner point newlocation new location = owner getlocation get location if ! newlocation new location equals oldlocation old location { setlocation set location newlocation new location x + owner getwidth get width getwidth get width / 2 newlocation new location y + owner getinsets get insets top shiftbacklocation shift back location = oldlocation old location = newlocation new location } } } } isshowassheet is show as sheet { uimanager u i manager getboolean get sheet showassheet show as sheet } installsheet install sheet { if ! isinstalled is installed { window owner = getowner get owner if owner != { point ownerloc owner loc = owner getlocation get location point sheetloc sheet loc if isshowassheet is show as sheet { if owner instanceof jframe j frame { sheetloc sheet loc = new point ownerloc owner loc x + owner getwidth get width getwidth get width / 2 ownerloc owner loc y + owner getinsets get insets top + jframe j frame owner getrootpane get root pane getcontentpane get content pane gety get y } else if owner instanceof jdialog j dialog { sheetloc sheet loc = new point ownerloc owner loc x + owner getwidth get width getwidth get width / 2 ownerloc owner loc y + owner getinsets get insets top + jdialog j dialog owner getrootpane get root pane getcontentpane get content pane gety get y } else { sheetloc sheet loc = new point ownerloc owner loc x + owner getwidth get width getwidth get width / 2 ownerloc owner loc y + owner getinsets get insets top } if sheetloc sheet loc x < 0 { owner setlocation set location ownerloc owner loc x sheetloc sheet loc x ownerloc owner loc y sheetloc sheet loc x = 0 shiftbacklocation shift back location = ownerloc owner loc oldlocation old location = owner getlocation get location } else { shiftbacklocation shift back location = oldlocation old location = ownerloc owner loc } } else { sheetloc sheet loc = new point ownerloc owner loc x + owner getwidth get width getwidth get width / 2 ownerloc owner loc y + owner getheight get height getheight get height / 2 } setlocation set location sheetloc sheet loc oldfocusowner old focus owner = owner getfocusowner get focus owner owner setfocusablewindowstate set focusable window state owner setenabled set enabled if uimanager u i manager getboolean get sheet showassheet show as sheet { owner addcomponentlistener add component listener ownermovementhandler owner movement handler } else { if owner instanceof frame { settitle set title frame owner gettitle get title } } } isinstalled is installed = } } uninstallsheet uninstall sheet { if isinstalled is installed { window owner = getowner get owner if owner != { owner setfocusablewindowstate set focusable window state owner setenabled set enabled owner removecomponentlistener remove component listener ownermovementhandler owner movement handler if shiftbacklocation shift back location != { owner setlocation set location shiftbacklocation shift back location } if oldfocusowner old focus owner != { owner tofront to front oldfocusowner old focus owner requestfocus request focus } } isinstalled is installed = } } addnotify add notify { super addnotify add notify if uimanager u i manager getboolean get sheet showassheet show as sheet { invokestatic ch randelshofer quaqua quaquautilities quaqua utilities setwindowalpha set window alpha new {window { window integer type t y p e } new {this 240} } } setanimated set animated newvalue new value { oldvalue old value = isanimated is animated isanimated is animated = newvalue new value firepropertychange fire property change animated oldvalue old value newvalue new value } isanimated is animated { isanimated is animated } dispose { super dispose uninstallsheet uninstall sheet } hide0 { super hide } show0 { super show } hide { if isanimated is animated isshowassheet is show as sheet { getcontentpane get content pane setvisible set visible rectangle startbounds start bounds = getbounds get bounds parentwidth parent width = getparent get parent getwidth get width rectangle endbounds end bounds = new rectangle parentwidth parent width < startbounds start bounds width ? startbounds start bounds x + startbounds start bounds width parentwidth parent width / 2 startbounds start bounds x startbounds start bounds y math min startbounds start bounds width parentwidth parent width 0 timer timer = new timer 20 timer addactionlistener add action listener new actionlistener action listener { long starttime start time long endtime end time actionperformed action performed actionevent action event evt { long now = currenttimemillis current time millis if starttime start time == 0 { starttime start time = now endtime end time = starttime start time + 200 } if now > endtime end time { timer stop hide0 setbounds set bounds startbounds start bounds getcontentpane get content pane setvisible set visible uninstallsheet uninstall sheet } else { float ratio = now starttime start time / float endtime end time starttime start time setbounds set bounds startbounds start bounds x * 1f ratio + endbounds end bounds x * ratio startbounds start bounds y * 1f ratio + endbounds end bounds y * ratio startbounds start bounds width * 1f ratio + endbounds end bounds width * ratio startbounds start bounds height * 1f ratio + endbounds end bounds height * ratio } } } timer setrepeats set repeats timer setinitialdelay set initial delay 5 timer start } else { hide0 uninstallsheet uninstall sheet } } show { if isanimated is animated isshowassheet is show as sheet { installsheet install sheet getcontentpane get content pane setvisible set visible long starttime start time = currenttimemillis current time millis long endtime end time = starttime start time + 300 rectangle endbounds end bounds = getbounds get bounds parentwidth parent width = getparent get parent getwidth get width rectangle startbounds start bounds = new rectangle parentwidth parent width < endbounds end bounds width ? endbounds end bounds x + endbounds end bounds width parentwidth parent width / 2 endbounds end bounds x endbounds end bounds y math min endbounds end bounds width parentwidth parent width 0 setbounds set bounds startbounds start bounds show0 timer timer = new timer 20 timer addactionlistener add action listener new actionlistener action listener { long starttime start time long endtime end time actionperformed action performed actionevent action event evt { long now = currenttimemillis current time millis if starttime start time == 0 { starttime start time = now endtime end time = starttime start time + 200 } if now > endtime end time { timer stop setbounds set bounds endbounds end bounds getcontentpane get content pane setvisible set visible requestfocus request focus window getparent get parent tofront to front } else { float ratio = now starttime start time / float endtime end time starttime start time setbounds set bounds startbounds start bounds x * 1f ratio + endbounds end bounds x * ratio startbounds start bounds y * 1f ratio + endbounds end bounds y * ratio startbounds start bounds width * 1f ratio + endbounds end bounds width * ratio startbounds start bounds height * 1f ratio + endbounds end bounds height * ratio } } } timer setrepeats set repeats timer setinitialdelay set initial delay 5 timer start } else { installsheet install sheet show0 } } addsheetlistener add sheet listener sheetlistener sheet listener l { listenerlist listener list add sheetlistener sheet listener l } removesheetlistener remove sheet listener sheetlistener sheet listener l { listenerlist listener list remove sheetlistener sheet listener l } fireoptionselected fire option selected joptionpane j option pane pane { value = pane getvalue get value option if value == { option = joptionpane j option pane CLOSED_OPTION } else { if pane getoptions get options == { if value instanceof integer { option = integer value intvalue value } else { option = joptionpane j option pane CLOSED_OPTION } } else { option = joptionpane j option pane CLOSED_OPTION options = pane getoptions get options for i = 0 n = options length i < n i++ { if options i equals value { option = i break } } if option == joptionpane j option pane CLOSED_OPTION { value = } } } fireoptionselected fire option selected pane option value pane getinputvalue get input value } fireoptionselected fire option selected joptionpane j option pane pane option value inputvalue input value { sheetevent sheet event sheetevent sheet event = listeners = listenerlist listener list getlistenerlist get listener list for i = listeners length 2 i>=0 i =2 { if listeners i ==sheetlistener == sheet listener { if sheetevent sheet event == sheetevent sheet event = new sheetevent sheet event this pane option value inputvalue input value sheetlistener sheet listener listeners i+1 optionselected option selected sheetevent sheet event } } } fireoptionselected fire option selected jfilechooser j chooser pane option { sheetevent sheet event sheetevent sheet event = listeners = listenerlist listener list getlistenerlist get listener list for i = listeners length 2 i>=0 i =2 { if listeners i ==sheetlistener == sheet listener { if sheetevent sheet event == sheetevent sheet event = new sheetevent sheet event this pane option sheetlistener sheet listener listeners i+1 optionselected option selected sheetevent sheet event } } } showsheet show sheet joptionpane j option pane pane component parentcomponent parent component sheetlistener sheet listener listener { jsheet j sheet sheet = createsheet create sheet pane parentcomponent parent component stylefrommessagetype style from message type pane getmessagetype get message type sheet addsheetlistener add sheet listener listener sheet show } showconfirmsheet show confirm sheet component parentcomponent parent component message sheetlistener sheet listener listener { showconfirmsheet show confirm sheet parentcomponent parent component message joptionpane j option pane YES_NO_CANCEL_OPTION listener } showconfirmsheet show confirm sheet component parentcomponent parent component message optiontype option type sheetlistener sheet listener listener { showconfirmsheet show confirm sheet parentcomponent parent component message optiontype option type joptionpane j option pane QUESTION_MESSAGE listener } showconfirmsheet show confirm sheet component parentcomponent parent component message optiontype option type messagetype message type sheetlistener sheet listener listener { showconfirmsheet show confirm sheet parentcomponent parent component message optiontype option type messagetype message type listener } showconfirmsheet show confirm sheet component parentcomponent parent component message optiontype option type messagetype message type icon icon sheetlistener sheet listener listener { showoptionsheet show option sheet parentcomponent parent component message optiontype option type messagetype message type icon listener } showinputsheet show input sheet component parentcomponent parent component message sheetlistener sheet listener listener { showinputsheet show input sheet parentcomponent parent component message joptionpane j option pane QUESTION_MESSAGE listener } showinputsheet show input sheet component parentcomponent parent component message initialselectionvalue initial selection value sheetlistener sheet listener listener { showinputsheet show input sheet parentcomponent parent component message joptionpane j option pane QUESTION_MESSAGE initialselectionvalue initial selection value listener } showinputsheet show input sheet component parentcomponent parent component message messagetype message type sheetlistener sheet listener listener { showinputsheet show input sheet parentcomponent parent component message messagetype message type listener } showinputsheet show input sheet component parentcomponent parent component message messagetype message type icon icon selectionvalues selection values initialselectionvalue initial selection value sheetlistener sheet listener listener { joptionpane j option pane pane = new joptionpane j option pane message messagetype message type joptionpane j option pane OK_CANCEL_OPTION icon pane setwantsinput set wants input pane setselectionvalues set selection values selectionvalues selection values pane setinitialselectionvalue set initial selection value initialselectionvalue initial selection value pane setcomponentorientation set component orientation parentcomponent parent component == ? joptionpane j option pane getrootframe get root frame parentcomponent parent component getcomponentorientation get component orientation style = stylefrommessagetype style from message type messagetype message type jsheet j sheet sheet = createsheet create sheet pane parentcomponent parent component style pane selectinitialvalue select initial value sheet addsheetlistener add sheet listener listener sheet show sheet tofront to front } showmessagesheet show message sheet component parentcomponent parent component message { showmessagesheet show message sheet parentcomponent parent component message joptionpane j option pane INFORMATION_MESSAGE } showmessagesheet show message sheet component parentcomponent parent component message sheetlistener sheet listener listener { showmessagesheet show message sheet parentcomponent parent component message joptionpane j option pane INFORMATION_MESSAGE listener } showmessagesheet show message sheet component parentcomponent parent component message messagetype message type { showmessagesheet show message sheet parentcomponent parent component message messagetype message type } showmessagesheet show message sheet component parentcomponent parent component message messagetype message type sheetlistener sheet listener listener { showmessagesheet show message sheet parentcomponent parent component message messagetype message type listener } showmessagesheet show message sheet component parentcomponent parent component message messagetype message type icon icon sheetlistener sheet listener listener { showoptionsheet show option sheet parentcomponent parent component message joptionpane j option pane DEFAULT_OPTION messagetype message type icon listener } showoptionsheet show option sheet component parentcomponent parent component message optiontype option type messagetype message type icon icon options initialvalue initial value sheetlistener sheet listener listener { joptionpane j option pane pane = new joptionpane j option pane message messagetype message type optiontype option type icon options initialvalue initial value pane setinitialvalue set initial value initialvalue initial value pane setcomponentorientation set component orientation parentcomponent parent component == ? joptionpane j option pane getrootframe get root frame parentcomponent parent component getcomponentorientation get component orientation style = stylefrommessagetype style from message type messagetype message type jsheet j sheet sheet = createsheet create sheet pane parentcomponent parent component style pane selectinitialvalue select initial value sheet addsheetlistener add sheet listener listener sheet show sheet tofront to front } private stylefrommessagetype style from message type messagetype message type { switch messagetype message type { case joptionpane j option pane ERROR_MESSAGE jrootpane j root pane ERROR_DIALOG case joptionpane j option pane QUESTION_MESSAGE jrootpane j root pane QUESTION_DIALOG case joptionpane j option pane WARNING_MESSAGE jrootpane j root pane WARNING_DIALOG case joptionpane j option pane INFORMATION_MESSAGE jrootpane j root pane INFORMATION_DIALOG case joptionpane j option pane PLAIN_MESSAGE default jrootpane j root pane PLAIN_DIALOG } } private jsheet j sheet createsheet create sheet joptionpane j option pane pane component parentcomponent parent component style { window window = getwindowforcomponent get window for component parentcomponent parent component jsheet j sheet sheet if window instanceof frame { sheet = new jsheet j sheet frame window } else { sheet = new jsheet j sheet dialog window } container contentpane content pane = sheet getcontentpane get content pane contentpane content pane setlayout set layout new borderlayout border layout contentpane content pane add pane borderlayout border layout center c e n t e r sheet setresizable set resizable sheet addwindowlistener add window listener new windowadapter window adapter { private gotfocus got focus = count windowclosing window closing windowevent window event we { pane setvalue set value } windowclosed window closed windowevent window event we { if pane getvalue get value == joptionpane j option pane UNINITIALIZED_VALUE { sheet fireoptionselected fire option selected pane } } windowgainedfocus window gained focus windowevent window event we { if !gotfocus !got focus { optionpaneui option pane u i ui = pane getui get u i if ui != { ui selectinitialvalue select initial value pane } gotfocus got focus = } } } sheet addcomponentlistener add component listener new componentadapter component adapter { componentshown component shown componentevent component event ce { pane setvalue set value joptionpane j option pane UNINITIALIZED_VALUE } } pane addpropertychangelistener add property change listener new propertychangelistener property change listener { propertychange property change propertychangeevent property change event event { if sheet isvisible is visible event getsource get source == pane event getpropertyname get property name equals joptionpane j option pane VALUE_PROPERTY event getnewvalue get new value != event getnewvalue get new value != joptionpane j option pane UNINITIALIZED_VALUE { sheet setvisible set visible sheet fireoptionselected fire option selected pane } } } sheet pack sheet } window getwindowforcomponent get window for component component parentcomponent parent component { if parentcomponent parent component == joptionpane j option pane getrootframe get root frame if parentcomponent parent component instanceof frame || parentcomponent parent component instanceof dialog window parentcomponent parent component getwindowforcomponent get window for component parentcomponent parent component getparent get parent } showsavesheet show save sheet jfilechooser j chooser chooser component parent sheetlistener sheet listener listener { chooser setdialogtype set dialog type jfilechooser j chooser SAVE_DIALOG showsheet show sheet chooser parent listener } showopensheet show open sheet jfilechooser j chooser chooser component parent sheetlistener sheet listener listener { chooser setdialogtype set dialog type jfilechooser j chooser OPEN_DIALOG showsheet show sheet chooser parent listener } showsheet show sheet jfilechooser j chooser chooser component parent approvebuttontext approve button text sheetlistener sheet listener listener { if approvebuttontext approve button text != { chooser setapprovebuttontext set approve button text approvebuttontext approve button text chooser setdialogtype set dialog type jfilechooser j chooser CUSTOM_DIALOG } frame frame = parent instanceof frame ? frame parent frame swingutilities swing utilities getancestorofclass get ancestor of frame parent title = chooser getui get u i getdialogtitle get dialog title chooser chooser getaccessiblecontext get accessible context setaccessibledescription set accessible description title jsheet j sheet sheet = new jsheet j sheet frame sheet addsheetlistener add sheet listener listener container contentpane content pane = sheet getcontentpane get content pane contentpane content pane setlayout set layout new borderlayout border layout contentpane content pane add chooser borderlayout border layout center c e n t e r actionlistener action listener actionlistener action listener = new actionlistener action listener { actionperformed action performed actionevent action event evt { option if evt getactioncommand get action command equals approveselection approve selection { option = jfilechooser j chooser APPROVE_OPTION } else { option = jfilechooser j chooser CANCEL_OPTION } sheet hide sheet fireoptionselected fire option selected chooser option chooser removeactionlistener remove action listener this } } chooser addactionlistener add action listener actionlistener action listener sheet addwindowlistener add window listener new windowadapter window adapter { windowclosing window closing windowevent window event e { sheet fireoptionselected fire option selected chooser jfilechooser j chooser CANCEL_OPTION chooser removeactionlistener remove action listener actionlistener action listener } } chooser rescancurrentdirectory rescan current directory sheet pack sheet show sheet tofront to front } } 