org jhotdraw draw import org jhotdraw undo compositeedit composite edit import awt * import awt geom * import awt event * import util * creationtool creation tool abstracttool tool { private map<attributekey map< attribute key object> attributes private name private dimension minimalsizetreshold minimal size treshold = new dimension 10 10 private dimension minimalsize minimal size = new dimension 40 40 private figure prototype figure createdfigure created figure compositeedit composite edit creationedit creation edit creationtool creation tool prototypeclassname prototype name { this prototypeclassname prototype name } creationtool creation tool prototypeclassname prototype name map<attributekey map< attribute key object> attributes { this prototypeclassname prototype name attributes } creationtool creation tool prototypeclassname prototype name map<attributekey map< attribute key object> attributes name { try { this prototype = figure forname for name prototypeclassname prototype name newinstance new instance } catch e { internalerror internal = new internalerror internal unable to create figure from +prototypeclassname +prototype name initcause init cause e throw } this attributes = attributes this name = name } creationtool creation tool figure prototype { this prototype } creationtool creation tool figure prototype map<attributekey map< attribute key object> attributes { this prototype attributes } creationtool creation tool figure prototype map<attributekey map< attribute key object> attributes name { this prototype = prototype this attributes = attributes this name = name } figure getprototype get prototype { prototype } activate drawingeditor drawing editor editor { super activate editor } deactivate drawingeditor drawing editor editor { super deactivate editor if getview get view != { getview get view setcursor set cursor cursor getdefaultcursor get default cursor } if createdfigure created figure != { if createdfigure created figure instanceof compositefigure composite figure { compositefigure composite figure createdfigure created figure layout } createdfigure created figure = } } mousepressed mouse pressed mouseevent mouse event evt { super mousepressed mouse pressed evt getview get view clearselection clear selection creationedit creation edit = new compositeedit composite edit figur erstellen getdrawing get drawing fireundoableedithappened fire undoable edit happened creationedit creation edit createdfigure created figure = createfigure create figure point2d point2 d p = constrainpoint constrain point viewtodrawing view to drawing anchor anchor x = evt getx get x anchor y = evt gety get y createdfigure created figure willchange will change createdfigure created figure basicsetbounds basic set bounds p p createdfigure created figure changed getdrawing get drawing add createdfigure created figure } figure createfigure create figure { figure f = figure prototype clone geteditor get editor applydefaultattributesto apply default attributes to f if attributes != { for map entry<attributekey entry< attribute key object> entry attributes entryset entry set { f setattribute set attribute entry getkey get key entry getvalue get value } } f } figure getcreatedfigure get created figure { createdfigure created figure } figure getaddedfigure get added figure { createdfigure created figure } mousedragged mouse dragged mouseevent mouse event evt { if createdfigure created figure != { point2d point2 d p = constrainpoint constrain point new point evt getx get x evt gety get y createdfigure created figure willchange will change createdfigure created figure basicsetbounds basic set bounds constrainpoint constrain point new point anchor x anchor y p createdfigure created figure changed } } mousereleased mouse released mouseevent mouse event evt { if createdfigure created figure != { rectangle2d rectangle2 d bounds = createdfigure created figure getbounds get bounds if bounds width == 0 bounds height == 0 { getdrawing get drawing remove createdfigure created figure } else { if math abs anchor x evt getx get x < minimalsizetreshold minimal size treshold width math abs anchor y evt gety get y < minimalsizetreshold minimal size treshold height { createdfigure created figure basicsetbounds basic set bounds constrainpoint constrain point new point anchor x anchor y constrainpoint constrain point new point anchor x + math max bounds width minimalsize minimal size width anchor y + math max bounds height minimalsize minimal size height } getview get view addtoselection add to selection createdfigure created figure } if createdfigure created figure instanceof compositefigure composite figure { compositefigure composite figure createdfigure created figure layout } createdfigure created figure = getdrawing get drawing fireundoableedithappened fire undoable edit happened creationedit creation edit firetooldone fire tool done } } } 