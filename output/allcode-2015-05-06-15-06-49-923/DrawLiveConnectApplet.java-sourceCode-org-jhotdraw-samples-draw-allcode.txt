org jhotdraw samples draw import org jhotdraw draw drawing import org jhotdraw draw textfigure text figure import org jhotdraw draw action swingworker swing worker import org jhotdraw util * import awt * import awt geom * import awt event * import io * import net * import util * import javax swing * import javax swing event * import netscape javascript * import org jhotdraw xml * drawliveconnectapplet draw live connect applet japplet j applet { private version v e r s i o n = 0 44 private name n a m e = plasmadraw plasma draw init { try { uimanager u i manager setlookandfeel set look and feel uimanager u i manager getsystemlookandfeelclassname get look and feel name } catch throwable e { } container c = getcontentpane get content pane c setlayout set layout new boxlayout box layout c boxlayout box layout Y_AXIS lines = getappletinfo get applet info split \n for i=0 i < lines length i++ { c add new jlabel j label lines i } new swingworker swing worker { construct { result try { if getparameter get parameter data != getparameter get parameter data length > 0 { nanoxmllitedominput nano xml lite dom input domi = new nanoxmllitedominput nano xml lite dom input new drawfigurefactory draw figure factory new stringreader reader getparameter get parameter data domi openelement open element plasmadraw plasma draw result = domi readobject read 0 } else if getparameter get parameter datafile != { inputstream input stream in = try { url u r l url = new url u r l getdocumentbase get document base getparameter get parameter datafile in = url openconnection open connection getinputstream get input stream nanoxmllitedominput nano xml lite dom input domi = new nanoxmllitedominput nano xml lite dom input new drawfigurefactory draw figure factory in domi openelement open element plasmadraw plasma draw result = domi readobject read 0 } finally { if in != in close } } else { result = } } catch throwable t { result = t } result } finished { container c = getcontentpane get content pane c setlayout set layout new borderlayout border layout c removeall remove all result = getvalue get value initcomponents init components if result != { if result instanceof drawing { setdrawing set drawing drawing result } else if result instanceof throwable { getdrawing get drawing add new textfigure text figure result tostring to throwable result printstacktrace print stack trace } } isliveconnect is live connect try { forname for name netscape javascript jsobject j s isliveconnect is live connect = } catch throwable t { isliveconnect is live connect = } loadbutton load button setenabled set enabled isliveconnect is live connect getparameter get parameter dataread != savebutton save button setenabled set enabled isliveconnect is live connect getparameter get parameter datawrite != if isliveconnect is live connect { methodname name = getparameter get parameter dataread if methodname name indexof index of ' ' > 0 { methodname name = methodname name substring 0 methodname name indexof index of ' ' 1 } jsobject j s win = jsobject j s getwindow get window drawliveconnectapplet draw live connect applet this data = win call methodname name new 0 if data instanceof { setdata set data data } } c validate } } start } private setdrawing set drawing drawing d { drawingpanel drawing panel setdrawing set drawing d } private drawing getdrawing get drawing { drawingpanel drawing panel getdrawing get drawing } setdata set data text { if text != text length > 0 { stringreader reader in = new stringreader reader text try { nanoxmllitedominput nano xml lite dom input domi = new nanoxmllitedominput nano xml lite dom input new drawfigurefactory draw figure factory in domi openelement open element plasmadraw plasma draw setdrawing set drawing drawing domi readobject read 0 } catch throwable e { getdrawing get drawing clear textfigure text figure tf = new textfigure text figure tf settext set text e getmessage get message tf setbounds set bounds new point2d point2 d 10 10 new point2d point2 d 100 100 getdrawing get drawing add tf e printstacktrace print stack trace } finally { if in != in close } } } getdata get data { chararraywriter char writer out = new chararraywriter char writer try { nanoxmllitedomoutput nano xml lite dom output domo = new nanoxmllitedomoutput nano xml lite dom output new drawfigurefactory draw figure factory domo openelement open element plasmadraw plasma draw domo writeobject write getdrawing get drawing domo closeelement close element domo save out } catch ioexception i o e { textfigure text figure tf = new textfigure text figure tf settext set text e getmessage get message tf setbounds set bounds new point2d point2 d 10 10 new point2d point2 d 100 100 getdrawing get drawing add tf e printstacktrace print stack trace } finally { if out != out close } out tostring to } getparameterinfo get parameter info { new { { data the data to be displayed by this applet } { datafile url u r l an url u r l to a containing the data to be displayed by this applet } { dataread function the name of a javascript script function which can be used to read the data } { datawrite function the name of a javascript script function which can be used to write the data } } } getappletinfo get applet info { name+ n a m e+ \nversion \n +version + v e r s i o n + \n\ncopyright \n\n copyright 2004 \u00a9 werner randelshofer + \nalle \n alle rechte vorbehalten + \n\ndiese \n\n diese software basiert auf + \njhotdraw \n jhotdraw \u00a9 1996 1997 ifa i f a informatik und erich gamma } private initcomponents init components { toolbuttongroup tool button group = new javax swing buttongroup button group drawingpanel drawing panel = new org jhotdraw samples draw drawingpanel drawing panel jtoolbar1 j tool bar1 = new javax swing jtoolbar j tool bar loadbutton load button = new javax swing jbutton j button savebutton save button = new javax swing jbutton j button formlistener form listener formlistener form listener = new formlistener form listener getcontentpane get content pane add drawingpanel drawing panel awt borderlayout border layout center c e n t e r jtoolbar1 j tool bar1 setfloatable set floatable loadbutton load button settext set text laden loadbutton load button addactionlistener add action listener formlistener form listener jtoolbar1 j tool bar1 add loadbutton load button savebutton save button settext set text speichern savebutton save button addactionlistener add action listener formlistener form listener jtoolbar1 j tool bar1 add savebutton save button getcontentpane get content pane add jtoolbar1 j tool bar1 awt borderlayout border layout south s o u t h } private formlistener form listener implements awt event actionlistener action listener { actionperformed action performed awt event actionevent action event evt { if evt getsource get source == loadbutton load button { drawliveconnectapplet draw live connect applet this load evt } else if evt getsource get source == savebutton save button { drawliveconnectapplet draw live connect applet this save evt } } } private save awt event actionevent action event evt { try { methodname name = getparameter get parameter datawrite if methodname name indexof index of ' ' > 0 { methodname name = methodname name substring 0 methodname name indexof index of ' ' 1 } jsobject j s win = jsobject j s getwindow get window this result = win call methodname name new { getdata get data } } catch throwable t { textfigure text figure tf = new textfigure text figure fehler +t affinetransform affine transform tx = new affinetransform affine transform tx translate 10 20 tf transform tx getdrawing get drawing add tf } } private load awt event actionevent action event evt { try { methodname name = getparameter get parameter dataread if methodname name indexof index of ' ' > 0 { methodname name = methodname name substring 0 methodname name indexof index of ' ' 1 } jsobject j s win = jsobject j s getwindow get window this result = win call methodname name new 0 if result instanceof { setdata set data result } } catch throwable t { textfigure text figure tf = new textfigure text figure fehler +t affinetransform affine transform tx = new affinetransform affine transform tx translate 10 20 tf transform tx getdrawing get drawing add tf } } private org jhotdraw samples draw drawingpanel drawing panel drawingpanel drawing panel private javax swing jtoolbar j tool bar jtoolbar1 j tool bar1 private javax swing jbutton j button loadbutton load button private javax swing jbutton j button savebutton save button private javax swing buttongroup button group toolbuttongroup tool button group } 